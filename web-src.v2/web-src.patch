commit f74492b0e483338305b0840aca2ac27cfaf370b2
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Oct 9 15:50:20 2021 +0100

    [web-src] handle usermark in pages

diff --git a/web-src/src/pages/PagePlaylist.vue b/web-src/src/pages/PagePlaylist.vue
index 9fd59cd6..1542807c 100644
--- a/web-src/src/pages/PagePlaylist.vue
+++ b/web-src/src/pages/PagePlaylist.vue
@@ -15,7 +15,7 @@
     </template>
     <template slot="content">
       <p class="heading has-text-centered-mobile">{{ tracks.length }} tracks</p>
-      <list-tracks :tracks="tracks" :uris="uris"></list-tracks>
+      <list-tracks :tracks="tracks" :uris="uris" @usermark-updated="usermark_upd"></list-tracks>
       <modal-dialog-playlist :show="show_playlist_details_modal" :playlist="playlist" :uris="uris" @close="show_playlist_details_modal = false" />
     </template>
   </content-with-heading>
@@ -66,6 +66,10 @@ export default {
   },
 
   methods: {
+    usermark_upd: function (args) {
+      this.tracks.find(e => e.id === args.track_id).usermark = args.value
+    },
+
     play: function () {
       webapi.player_play_uri(this.uris, true)
     }

commit 34e8c60c528e1c6672831a7d800c331cfa1d3a58
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Oct 9 12:38:18 2021 +0100

    ray: [web-src] handle 404 to remove from queue/now playing

diff --git a/web-src/src/components/ModalDialogQueueItem.vue b/web-src/src/components/ModalDialogQueueItem.vue
index 96ebe748..bf95e121 100644
--- a/web-src/src/components/ModalDialogQueueItem.vue
+++ b/web-src/src/components/ModalDialogQueueItem.vue
@@ -184,8 +184,11 @@ export default {
         } else if (this.item.data_kind === 'file') {
           webapi.library_track(this.item.track_id).then((response) => {
             this.usermark = response.data.usermark
-          }).catch(() => {
+          }).catch((err) => {
             this.usermark = -1
+            if (err.response.status === 404) {
+              webapi.queue_remove(this.item.id)
+            }
           })
         }
       }
diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index f9f9bee6..b34ee631 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -208,13 +208,18 @@ export default {
     },
 
     'now_playing' () {
-      webapi.library_track(this.now_playing.track_id).then((response) => {
-        this.rating = response.data.rating / 20
-        this.usermark = response.data.usermark
-      }).catch(() => {
-        this.rating = 0
-        this.usermark = 0
-      })
+      if (this.now_playing.track_id !== undefined) {
+        webapi.library_track(this.now_playing.track_id).then((response) => {
+          this.rating = response.data.rating / 20
+          this.usermark = response.data.usermark
+        }).catch((err) => {
+          this.rating = 0
+          this.usermark = 0
+          if (err.response.status === 404) {
+            webapi.queue_remove(this.now_playing.id)
+          }
+        })
+      }
     }
   }
 }

commit deb06623a4464d2d2d3cf9ceec1e2033a45b6388
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Feb 18 20:56:04 2021 +0000

    ray: [web-src] partial rescan from directory/files modal

diff --git a/web-src/src/components/ModalDialogDirectory.vue b/web-src/src/components/ModalDialogDirectory.vue
index f25193fd..37466750 100644
--- a/web-src/src/components/ModalDialogDirectory.vue
+++ b/web-src/src/components/ModalDialogDirectory.vue
@@ -20,6 +20,9 @@
               <a class="card-footer-item has-text-dark" @click="play">
                 <span class="icon"><i class="mdi mdi-play"></i></span> <span class="is-size-7">Play</span>
               </a>
+              <a class="card-footer-item has-text-dark" @click="update_rescan">
+                <span class="icon"><i class="mdi mdi-harddisk"></i></span> <span class="is-size-7">Update/Rescan</span>
+              </a>
             </footer>
           </div>
         </div>
@@ -42,6 +45,11 @@ export default {
       webapi.player_play_expression('path starts with "' + this.directory.path + '" order by path asc', false)
     },
 
+    update_rescan: function () {
+      this.$emit('close')
+      webapi.library_update(null, this.directory.path)
+    },
+
     queue_add: function () {
       this.$emit('close')
       webapi.queue_expression_add('path starts with "' + this.directory.path + '" order by path asc')
diff --git a/web-src/src/components/ModalDialogUpdate.vue b/web-src/src/components/ModalDialogUpdate.vue
index 8d2d0eba..f565a3d7 100644
--- a/web-src/src/components/ModalDialogUpdate.vue
+++ b/web-src/src/components/ModalDialogUpdate.vue
@@ -79,7 +79,7 @@ export default {
       if (this.rescan_metadata) {
         webapi.library_rescan(this.update_dialog_scan_kind)
       } else {
-        webapi.library_update(this.update_dialog_scan_kind)
+        webapi.library_update(this.update_dialog_scan_kind, null)
       }
     },
 
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index 53f13a5a..5569cefe 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -27,11 +27,14 @@ export default {
     return axios.get('./api/library')
   },
 
-  library_update (scanKind) {
+  library_update (scanKind, path) {
     const params = {}
     if (scanKind) {
       params.scan_kind = scanKind
     }
+    if (path) {
+      params.path = path
+    }
     return axios.put('./api/update', undefined, { params: params })
   },
 

commit 86a26a753343fba5c4a57a702d50973ec1671bb7
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Oct 24 16:01:49 2020 +0100

    ray: [web-src] use lib generated objs for index_list

diff --git a/web-src/src/pages/PageAlbums.vue b/web-src/src/pages/PageAlbums.vue
index 2c329033..d9739cce 100644
--- a/web-src/src/pages/PageAlbums.vue
+++ b/web-src/src/pages/PageAlbums.vue
@@ -78,7 +78,6 @@ export default {
 
   data () {
     return {
-      index_list: [],
       tracks: 0,
       albums: { items: [] },
       sort_options: ['Name', 'Recently added', 'Recently released']
diff --git a/web-src/src/pages/PageArtists.vue b/web-src/src/pages/PageArtists.vue
index 42c33430..44fa3d24 100644
--- a/web-src/src/pages/PageArtists.vue
+++ b/web-src/src/pages/PageArtists.vue
@@ -85,12 +85,6 @@ export default {
   },
 
   computed: {
-    index_list () {
-      return [...new Set(this.artists.items
-        .filter(artist => !this.$store.state.hide_singles || artist.track_count > (artist.album_count * 2))
-        .map(artist => artist.name_sort.charAt(0).toUpperCase()))]
-    },
-
     artists_list () {
       return new Artists(this.artists.items, {
         hideSingles: this.hide_singles,

commit 73f5eb1ee00aca88d28bcde86724c26dfe6e5881
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Feb 10 18:40:42 2022 +0000

    ray: [web-src] vuejs warning fixups

diff --git a/web-src/src/components/NavbarBottom.vue b/web-src/src/components/NavbarBottom.vue
index d4b8e054..4c60e0e0 100644
--- a/web-src/src/components/NavbarBottom.vue
+++ b/web-src/src/components/NavbarBottom.vue
@@ -281,7 +281,7 @@ export default {
     },
 
     stream_location () {
-      var port = (this.$store.state.config.stream_port === 0 || this.$store.state.config.stream_port === undefined) ? window.location.port : this.$store.state.config.stream_port
+      const port = (this.$store.state.config.stream_port === 0 || this.$store.state.config.stream_port === undefined) ? window.location.port : this.$store.state.config.stream_port
       return window.location.protocol + '//' + window.location.hostname + ':' + port + '/stream.mp3'
     },
 
diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index 9616c8a4..c8a4d03c 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -110,7 +110,7 @@ export default {
     },
 
     modal_artist_obj () {
-      var tracks = this.min_rating === 0 ? this.tracks.items : this.tracks.items.filter(a => a.rating >= this.min_rating)
+      const tracks = this.min_rating === 0 ? this.tracks.items : this.tracks.items.filter(a => a.rating >= this.min_rating)
       return {
         id: this.id,
         name: this.name,
diff --git a/web-src/src/pages/PageFiles.vue b/web-src/src/pages/PageFiles.vue
index 5dc60ee6..653eda3e 100644
--- a/web-src/src/pages/PageFiles.vue
+++ b/web-src/src/pages/PageFiles.vue
@@ -184,7 +184,7 @@ export default {
     },
 
     index_list () {
-      var items = []
+      let items = []
 
       if (this.view === 'file_view') {
         items = this.files.tracks.items
diff --git a/web-src/src/pages/PageGenreTracks.vue b/web-src/src/pages/PageGenreTracks.vue
index 3ad0b0bd..f9aaa862 100644
--- a/web-src/src/pages/PageGenreTracks.vue
+++ b/web-src/src/pages/PageGenreTracks.vue
@@ -93,7 +93,7 @@ export default {
 
   computed: {
     modal_obj () {
-      var tracks = this.min_rating === 0 ? this.tracks.items : this.tracks.items.filter(a => a.rating >= this.min_rating)
+      const tracks = this.min_rating === 0 ? this.tracks.items : this.tracks.items.filter(a => a.rating >= this.min_rating)
       return {
         name: this.genre,
         album_count: new Set(tracks.map(track => track.album_id)).size,
diff --git a/web-src/src/pages/PagePodcast.vue b/web-src/src/pages/PagePodcast.vue
index 9958457d..c76865ea 100644
--- a/web-src/src/pages/PagePodcast.vue
+++ b/web-src/src/pages/PagePodcast.vue
@@ -116,7 +116,7 @@ export default {
     },
 
     is_url_pl: function () {
-      var urltracks = this.tracks.reduce((acc, item) => {
+      const urltracks = this.tracks.reduce((acc, item) => {
         acc += item.data_kind === 'url' ? 1 : 0
         return acc
       }, 0)
diff --git a/web-src/src/pages/PageQueue.vue b/web-src/src/pages/PageQueue.vue
index 7a33289a..34ba704d 100644
--- a/web-src/src/pages/PageQueue.vue
+++ b/web-src/src/pages/PageQueue.vue
@@ -109,14 +109,14 @@ export default {
       return this.$store.state.config.allow_modifying_stored_playlists && this.$store.state.config.default_playlist_directory
     },
     queue_duration () {
-      var seconds = this.queue.items.reduce((acc, item) => {
+      const seconds = this.queue.items.reduce((acc, item) => {
         acc += item.length_ms
         return acc
       }, 0) / 1000
 
-      var h = Math.floor(seconds / 3600)
-      var m = Math.floor(seconds % 3600 / 60)
-      var s = Math.floor(seconds % 3600 % 60)
+      const h = Math.floor(seconds / 3600)
+      const m = Math.floor(seconds % 3600 / 60)
+      const s = Math.floor(seconds % 3600 % 60)
 
       return [h > 0 ? h + ':' : ''] + ('0' + m).slice(-2) + ':' + ('0' + s).slice(-2)
     },
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index bfc3fdd9..53f13a5a 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -243,7 +243,7 @@ export default {
   },
 
   library_genre_albums (genre) {
-    var genreParams = {
+    const genreParams = {
       type: 'albums',
       media_kind: 'music',
       expression: 'genre is "' + genre + '"'
@@ -254,7 +254,7 @@ export default {
   },
 
   library_genre_artists (genre) {
-    var genreParams = {
+    const genreParams = {
       type: 'artists',
       media_kind: 'music',
       expression: 'genre is "' + genre + '"'

commit c86dfdfc4093860a0876cea5f0fb02ea3531e891
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Feb 6 15:10:34 2022 +0000

    ray: [web-src] fix browse recent added tracks to seperate tracks between wk/month/older

diff --git a/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue b/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
index 27b7015f..6a37832f 100644
--- a/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
+++ b/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
@@ -103,21 +103,40 @@ const browseData = {
       }),
       webapi.search({
         type: 'track',
-        expression: 'time_added after this week and media_kind is music order by time_added desc',
+        expression: 'time_added after this week and time_added before today and media_kind is music order by time_added desc',
         limit: recentlyAddedLimit
       }),
       webapi.search({
         type: 'track',
-        expression: 'time_added after last month and media_kind is music order by time_added desc',
+        expression: 'time_added after last month and time_added before this week and media_kind is music order by time_added desc',
         limit: recentlyAddedLimit
       })
     ])
   },
 
   set: function (vm, response) {
+    let N = store.getters.settings_option_recently_added_limit
+
     vm.recently_added_today = response[0].data.tracks
+    if (vm.recently_added_today.length > N) {
+      vm.recently_added_today.length = N
+      N = 0
+    } else {
+      N -= vm.recently_added_today.length
+    }
+
     vm.recently_added_week = response[1].data.tracks
+    if (vm.recently_added_week.length > N) {
+      vm.recently_added_week.length = N
+      N = 0
+    } else {
+      N -= vm.recently_added_week.length
+    }
+
     vm.recently_added_month = response[2].data.tracks
+    if (vm.recently_added_month.length > N) {
+      vm.recently_added_month.length = N
+    }
   }
 }
 
@@ -186,7 +205,7 @@ export default {
       return this.recently_added_older.items.length > 0
     },
     recently_added () {
-      return this.recently_added_older.items.length + this.recently_added_month.items.length
+      return this.recently_added_older.items.length + this.recently_added_month.items.length + this.recently_added_week.items.length + this.recently_added_today.items.length
     }
   }
 }

commit 985445ef03d9fa6d8288fafc567da9d340315848
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 19:55:31 2022 +0000

    ray: [web-src] artist albums group yrs

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index aaa44325..8a8ec160 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -2,7 +2,7 @@
   <div>
     <tabs-music></tabs-music>
 
-    <index-list :index="index_list"></index-list>
+    <index-list :index="albums_list.indexList"></index-list>
 
   <content-with-heading>
       <template slot="options">
@@ -89,7 +89,7 @@ export default {
       show_details_modal: false,
       selected_album: {},
 
-      sort_options: ['Name', 'Release date'],
+      sort_options: ['Name', 'Release date', 'Recently released'],
       show_artist_details_modal: false
     }
   },
@@ -130,6 +130,11 @@ export default {
       },
       set (value) {
         this.$store.commit(types.ARTIST_ALBUMS_SORT, value)
+        if (value !== 'Name') {
+          this.albums_list.options.group = true
+        } else {
+          this.albums_list.options.group = false
+        }
       }
     }
   },

commit 2073141610c1c7e111fbc1a498880367f838b095
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 19:28:23 2022 +0000

    ray: [web-src] artist tracks supporting dynamic sorting

diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index 1c6eace0..9616c8a4 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -2,11 +2,18 @@
   <div>
     <tabs-music></tabs-music>
 
-    <index-list :index="index_list"></index-list>
+    <index-list :index="tracks_list.indexList"></index-list>
 
     <content-with-heading>
       <template slot="options">
-        <index-button-list :index="index_list"></index-button-list>
+        <index-button-list :index="tracks_list.indexList"></index-button-list>
+
+        <div class="columns">
+          <div class="column">
+            <p class="heading" style="margin-bottom: 24px;">Sort by</p>
+            <dropdown-menu v-model="sort" :options="sort_options"></dropdown-menu>
+          </div>
+        </div>
       </template>
       <template slot="heading-left">
         <p class="title is-4">{{ name }}</p>
@@ -29,7 +36,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artist">{{ album_count }} albums</a> | {{ track_count }} tracks</p>
-        <list-tracks :tracks="rated_tracks" @rating-updated="rating_upd" @usermark-updated="usermark_upd"></list-tracks>
+        <list-tracks :tracks="tracks_list" @rating-updated="rating_upd" @usermark-updated="usermark_upd"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-artist :show="show_artist_details_modal" :artist="modal_artist_obj" @close="show_artist_details_modal = false" />
       </template>
@@ -41,6 +48,7 @@
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import IndexButtonList from '@/components/IndexButtonList'
+import DropdownMenu from '@/components/DropdownMenu'
 import ListTracks from '@/components/ListTracks'
 import ModalDialogTrack from '@/components/ModalDialogTrack'
 import ModalDialogArtist from '@/components/ModalDialogArtist'
@@ -48,6 +56,8 @@ import TabsMusic from '@/components/TabsMusic'
 import IndexList from '@/components/IndexList'
 import StarRating from 'vue-star-rating'
 import webapi from '@/webapi'
+import * as types from '@/store/mutation_types'
+import Tracks from '@/lib/Tracks'
 
 const tracksData = {
   load: function (to) {
@@ -68,7 +78,7 @@ const tracksData = {
 export default {
   name: 'PageArtistTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogArtist, ModalDialogTrack, IndexList, TabsMusic, StarRating },
+  components: { ContentWithHeading, ListTracks, IndexButtonList, DropdownMenu, ModalDialogArtist, ModalDialogTrack, IndexList, TabsMusic, StarRating },
 
   data () {
     return {
@@ -80,6 +90,7 @@ export default {
 
       show_details_modal: false,
       selected_track: {},
+      sort_options: ['Name', 'Recently added', 'Recently released'],
 
       show_artist_details_modal: false
     }
@@ -109,9 +120,21 @@ export default {
       }
     },
 
-    index_list () {
-      return [...new Set(this.tracks.items
-        .map(track => track.title_sort.charAt(0).toUpperCase()))]
+    tracks_list () {
+      return new Tracks(this.tracks.items, {
+        sort: this.sort,
+        group: true,
+        min_rating: this.min_rating
+      })
+    },
+
+    sort: {
+      get () {
+        return this.$store.state.albums_sort
+      },
+      set (value) {
+        this.$store.commit(types.ALBUMS_SORT, value)
+      }
     },
 
     track_uris () {

commit 8a548824b4a58c454182a0306a78f6011111524d
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 18:10:06 2022 +0000

    ray: [web-src] missing usermark update

diff --git a/web-src/src/pages/PageGenreTracks.vue b/web-src/src/pages/PageGenreTracks.vue
index 638f73e1..3ad0b0bd 100644
--- a/web-src/src/pages/PageGenreTracks.vue
+++ b/web-src/src/pages/PageGenreTracks.vue
@@ -37,7 +37,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | <a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks | <a class="has-text-link" @click="open_composers">composers</a></p>
-        <list-tracks :tracks="tracks_list" @rating-updated="rating_upd"></list-tracks>
+        <list-tracks :tracks="tracks_list" @rating-updated="rating_upd" @usermark-updated="usermark_upd"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
@@ -177,6 +177,10 @@ export default {
       }
     },
 
+    usermark_upd: function (args) {
+      this.tracks.items.find(e => e.id === args.track_id).usermark = args.value
+    },
+
     open_dialog: function (track) {
       this.selected_track = track
       this.show_details_modal = true

commit bbb15e63f66f03e9cfb008172248e354c70131fc
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 17:37:45 2022 +0000

    ray: [web-src] missing rating propogation

diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index 6336bf72..1c6eace0 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -29,7 +29,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artist">{{ album_count }} albums</a> | {{ track_count }} tracks</p>
-        <list-tracks :tracks="rated_tracks" @usermark-updated="usermark_upd"></list-tracks>
+        <list-tracks :tracks="rated_tracks" @rating-updated="rating_upd" @usermark-updated="usermark_upd"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-artist :show="show_artist_details_modal" :artist="modal_artist_obj" @close="show_artist_details_modal = false" />
       </template>
@@ -132,6 +132,13 @@ export default {
       this.$router.push({ path: '/music/artists/' + this.id })
     },
 
+    rating_upd: function (args) {
+      const idx = this.tracks.items.findIndex(track => track.id === args.track_id)
+      if (idx > -1) {
+        this.tracks.items[idx].rating = args.rating
+      }
+    },
+
     usermark_upd: function (args) {
       this.tracks.items.find(e => e.id === args.track_id).usermark = args.value
     },
diff --git a/web-src/src/pages/PageComposerTracks.vue b/web-src/src/pages/PageComposerTracks.vue
index eeb79e67..51c371c8 100644
--- a/web-src/src/pages/PageComposerTracks.vue
+++ b/web-src/src/pages/PageComposerTracks.vue
@@ -26,7 +26,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks</p>
-        <list-item-track v-for="(track, index) in rated_tracks" :key="track.id" :track="track" @click="play_track(index)">
+        <list-item-track v-for="(track, index) in rated_tracks" :key="track.id" :track="track" @rating-updated="rating_upd" @click="play_track(index)">
           <template slot="actions">
             <a @click="open_dialog(track)">
               <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
@@ -113,6 +113,13 @@ export default {
       this.min_rating = Math.ceil(rating) * 20
     },
 
+    rating_upd: function (args) {
+      const idx = this.tracks.items.findIndex(track => track.id === args.track_id)
+      if (idx > -1) {
+        this.tracks.items[idx].rating = args.rating
+      }
+    },
+
     open_dialog: function (track) {
       this.selected_track = track
       this.show_details_modal = true

commit 2f4b84be3b2dc29d20efcfa23fea1894a7e775f4
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 17:25:56 2022 +0000

    ray: [web-src] genre tracks supporting dynamic

diff --git a/web-src/src/pages/PageGenreTracks.vue b/web-src/src/pages/PageGenreTracks.vue
index 38e06fb9..638f73e1 100644
--- a/web-src/src/pages/PageGenreTracks.vue
+++ b/web-src/src/pages/PageGenreTracks.vue
@@ -2,9 +2,19 @@
   <div>
     <tabs-music></tabs-music>
 
-    <index-list :index="index_list"></index-list>
+    <index-list :index="tracks_list.indexList"></index-list>
 
     <content-with-heading>
+      <template slot="options">
+        <index-button-list :index="tracks_list.indexList"></index-button-list>
+
+        <div class="columns">
+          <div class="column">
+            <p class="heading" style="margin-bottom: 24px;">Sort by</p>
+            <dropdown-menu v-model="sort" :options="sort_options"></dropdown-menu>
+          </div>
+        </div>
+      </template>
       <template slot="heading-left">
         <p class="title is-4">{{ genre }}</p>
         <p class="heading">{{ tracks.total }} tracks</p>
@@ -27,7 +37,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | <a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks | <a class="has-text-link" @click="open_composers">composers</a></p>
-        <list-tracks :tracks="rated_tracks" @rating-updated="rating_upd"></list-tracks>
+        <list-tracks :tracks="tracks_list" @rating-updated="rating_upd"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
@@ -39,12 +49,16 @@
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import ListTracks from '@/components/ListTracks'
+import IndexButtonList from '@/components/IndexButtonList'
+import DropdownMenu from '@/components/DropdownMenu'
 import TabsMusic from '@/components/TabsMusic'
 import ModalDialogTrack from '@/components/ModalDialogTrack'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
 import IndexList from '@/components/IndexList'
 import StarRating from 'vue-star-rating'
 import webapi from '@/webapi'
+import * as types from '@/store/mutation_types'
+import Tracks from '@/lib/Tracks'
 
 const tracksData = {
   load: function (to) {
@@ -60,7 +74,7 @@ const tracksData = {
 export default {
   name: 'PageGenreTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListTracks, ModalDialogGenre, ModalDialogTrack, IndexList, TabsMusic, StarRating },
+  components: { ContentWithHeading, IndexButtonList, DropdownMenu, ListTracks, ModalDialogGenre, ModalDialogTrack, IndexList, TabsMusic, StarRating },
 
   data () {
     return {
@@ -71,6 +85,7 @@ export default {
 
       show_details_modal: false,
       selected_track: {},
+      sort_options: ['Name', 'Recently added', 'Recently released'],
 
       show_genre_details_modal: false
     }
@@ -88,6 +103,23 @@ export default {
       }
     },
 
+    tracks_list () {
+      return new Tracks(this.tracks.items, {
+        sort: this.sort,
+        group: true,
+        min_rating: this.min_rating
+      })
+    },
+
+    sort: {
+      get () {
+        return this.$store.state.albums_sort
+      },
+      set (value) {
+        this.$store.commit(types.ALBUMS_SORT, value)
+      }
+    },
+
     index_list () {
       return [...new Set(this.tracks.items
         .map(track => track.title_sort.charAt(0).toUpperCase()))]

commit f986a5ae3101f9d6d60cb90e695f73561bf8bb34
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 17:25:42 2022 +0000

    ray: [web-src] tracks supporting dynamic sorting like artist and album

diff --git a/web-src/src/components/ListTracks.vue b/web-src/src/components/ListTracks.vue
index 25d1e635..352ccb5a 100644
--- a/web-src/src/components/ListTracks.vue
+++ b/web-src/src/components/ListTracks.vue
@@ -1,5 +1,21 @@
 <template>
   <div>
+    <div v-if="is_grouped">
+      <div v-for="idx in tracks.indexList" :key="idx" class="mb-6">
+        <span class="tag is-info is-light is-small has-text-weight-bold" :id="'index_' + idx">{{ idx }}</span>
+        <list-item-track v-for="track in tracks.grouped[idx]"
+            :key="track.id"
+            :track="track"
+            @click="open_dialog(track)">
+            <template slot="actions">
+                <a @click="open_dialog(track)">
+                <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
+                </a>
+            </template>
+        </list-item-track>
+      </div>
+    </div>
+    <div v-else>
     <list-item-track v-for="(track, index) in tracks" :key="track.id" :track="track" @click="play_track(index, track)">
       <template slot="actions">
         <a @click="open_dialog(track)">
@@ -7,6 +23,7 @@
         </a>
       </template>
     </list-item-track>
+    </div>
     <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" @rating-updated="rating_upd" @usermark-updated="usermark_upd" />
   </div>
 </template>
@@ -15,6 +32,7 @@
 import ListItemTrack from '@/components/ListItemTrack'
 import ModalDialogTrack from '@/components/ModalDialogTrack'
 import webapi from '@/webapi'
+import Tracks from '@/lib/Tracks'
 
 export default {
   name: 'ListTracks',
@@ -29,6 +47,23 @@ export default {
     }
   },
 
+  computed: {
+    media_kind_resolved: function () {
+      return this.media_kind ? this.media_kind : this.selected_track.media_kind
+    },
+
+    tracks_list: function () {
+      if (Array.isArray(this.tracks)) {
+        return this.tracks
+      }
+      return this.tracks.sortedAndFiltered
+    },
+
+    is_grouped: function () {
+      return (this.tracks instanceof Tracks && this.tracks.options.group)
+    }
+  },
+
   methods: {
     play_track: function (position, track) {
       if (this.uris) {
diff --git a/web-src/src/lib/Tracks.js b/web-src/src/lib/Tracks.js
new file mode 100644
index 00000000..b4b495f9
--- /dev/null
+++ b/web-src/src/lib/Tracks.js
@@ -0,0 +1,92 @@
+
+export default class Tracks {
+  constructor (items, options = { hideSingles: false, hideSpotify: false, sort: 'Name', min_rating: 0, group: false }) {
+    this.items = items
+    this.options = options
+    this.grouped = {}
+    this.sortedAndFiltered = []
+    this.indexList = []
+
+    this.init()
+  }
+
+  init () {
+    this.createSortedAndFilteredList()
+    this.createGroupedList()
+    this.createIndexList()
+  }
+
+  getTrackIndex (track) {
+    if (this.options.sort === 'Recently added') {
+      return track.time_added.substring(0, 4)
+    } else if (this.options.sort === 'Recently added (browse)') {
+      return this.getRecentlyAddedBrowseIndex(track.time_added)
+    } else if (this.options.sort === 'Recently released') {
+      return track.date_released ? track.date_released.substring(0, 4) : '0000'
+    } else if (this.options.sort === 'Release date') {
+      return track.date_released ? track.date_released.substring(0, 4) : '0000'
+    }
+    return track.title_sort.charAt(0).toUpperCase()
+  }
+
+  getRecentlyAddedBrowseIndex (recentlyAdded) {
+    if (!recentlyAdded) {
+      return '0000'
+    }
+
+    const diff = new Date().getTime() - new Date(recentlyAdded).getTime()
+
+    if (diff < 86400000) { // 24h
+      return 'Today'
+    } else if (diff < 604800000) { // 7 days
+      return 'Last week'
+    } else if (diff < 2592000000) { // 30 days
+      return 'Last month'
+    }
+    return recentlyAdded.substring(0, 4)
+  }
+
+  createIndexList () {
+    this.indexList = [...new Set(this.sortedAndFiltered
+      .map(track => this.getTrackIndex(track)))]
+  }
+
+  createSortedAndFilteredList () {
+    let tracksSorted = this.items
+    if (this.options.sort === 'Recently added' || this.options.sort === 'Recently added (browse)') {
+      tracksSorted = [...tracksSorted].sort((a, b) => b.time_added.localeCompare(a.time_added))
+    } else if (this.options.sort === 'Recently released') {
+      tracksSorted = [...tracksSorted].sort((a, b) => {
+        if (!a.date_released) {
+          return 1
+        }
+        if (!b.date_released) {
+          return -1
+        }
+        return b.date_released.localeCompare(a.date_released)
+      })
+    } else if (this.options.sort === 'Release date') {
+      tracksSorted = [...tracksSorted].sort((a, b) => {
+        if (!a.date_released) {
+          return -1
+        }
+        if (!b.date_released) {
+          return 1
+        }
+        return a.date_released.localeCompare(b.date_released)
+      })
+    }
+    this.sortedAndFiltered = tracksSorted.filter(track => track.rating >= this.options.min_rating)
+  }
+
+  createGroupedList () {
+    if (!this.options.group) {
+      this.grouped = {}
+    }
+    this.grouped = this.sortedAndFiltered.reduce((r, track) => {
+      const idx = this.getTrackIndex(track)
+      r[idx] = [...r[idx] || [], track]
+      return r
+    }, {})
+  }
+}

commit c55159e3212e8aac328c6a540aef97e43da74693
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 16:49:13 2022 +0000

    ray: [web-src] track dialog/rating: propogate rating event

diff --git a/web-src/src/components/ListTracks.vue b/web-src/src/components/ListTracks.vue
index 30cc8cb3..25d1e635 100644
--- a/web-src/src/components/ListTracks.vue
+++ b/web-src/src/components/ListTracks.vue
@@ -7,7 +7,7 @@
         </a>
       </template>
     </list-item-track>
-    <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" @usermark-updated="usermark_upd" />
+    <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" @rating-updated="rating_upd" @usermark-updated="usermark_upd" />
   </div>
 </template>
 
@@ -40,6 +40,10 @@ export default {
       }
     },
 
+    rating_upd: function (args) {
+      this.$emit('rating-updated', args)
+    },
+
     usermark_upd: function (args) {
       this.$emit('usermark-updated', args)
     },
diff --git a/web-src/src/components/ModalDialogTrack.vue b/web-src/src/components/ModalDialogTrack.vue
index 31859ff1..b6996934 100644
--- a/web-src/src/components/ModalDialogTrack.vue
+++ b/web-src/src/components/ModalDialogTrack.vue
@@ -150,7 +150,9 @@ export default {
         rating = 0
       }
       this.rating = Math.ceil(rating) * 20
-      webapi.library_track_set_rating(this.track.id, this.rating)
+      webapi.library_track_set_rating(this.track.id, this.rating).then(() => {
+        this.$emit('rating-updated', { track_id: this.track.id, rating: this.rating })
+      })
     },
 
     queue_add: function () {
diff --git a/web-src/src/pages/PageGenreTracks.vue b/web-src/src/pages/PageGenreTracks.vue
index 92188ab9..38e06fb9 100644
--- a/web-src/src/pages/PageGenreTracks.vue
+++ b/web-src/src/pages/PageGenreTracks.vue
@@ -27,7 +27,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | <a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks | <a class="has-text-link" @click="open_composers">composers</a></p>
-        <list-tracks :tracks="rated_tracks"></list-tracks>
+        <list-tracks :tracks="rated_tracks" @rating-updated="rating_upd"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
@@ -138,6 +138,13 @@ export default {
       this.min_rating = Math.ceil(rating) * 20
     },
 
+    rating_upd: function (args) {
+      const idx = this.tracks.items.findIndex(track => track.id === args.track_id)
+      if (idx > -1) {
+        this.tracks.items[idx].rating = args.rating
+      }
+    },
+
     open_dialog: function (track) {
       this.selected_track = track
       this.show_details_modal = true

commit abd5ee992fe1fef46873751fc046fde07ca9ee14
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 13:47:46 2022 +0000

    ray: [web-src] compsoers search based on genre

diff --git a/web-src/src/pages/PageComposers.vue b/web-src/src/pages/PageComposers.vue
index 5505207e..6fda55ec 100644
--- a/web-src/src/pages/PageComposers.vue
+++ b/web-src/src/pages/PageComposers.vue
@@ -27,6 +27,9 @@ import Composers from '@/lib/Composers'
 
 const composersData = {
   load: function (to) {
+    if (to.params.genre) {
+      return webapi.library_genre_composers(to.params.genre)
+    }
     return webapi.library_composers()
   },
 
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index 086131f0..bfc3fdd9 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -275,6 +275,17 @@ export default {
     })
   },
 
+  library_genre_composers (genre) {
+    const genreParams = {
+      type: 'composers',
+      media_kind: 'music',
+      expression: 'genre is "' + genre + '"'
+    }
+    return axios.get('./api/search', {
+      params: genreParams
+    })
+  },
+
   library_radio_streams () {
     const params = {
       type: 'tracks',

commit c33bd20e01c90ae5732299354a9e3cc180e00008
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 13:02:04 2022 +0000

    ray: [web-src] genre artists sort options

diff --git a/web-src/src/pages/PageGenreArtists.vue b/web-src/src/pages/PageGenreArtists.vue
index 58955227..383581b3 100644
--- a/web-src/src/pages/PageGenreArtists.vue
+++ b/web-src/src/pages/PageGenreArtists.vue
@@ -2,9 +2,19 @@
   <div>
     <tabs-music></tabs-music>
 
-    <index-list :index="index_list"></index-list>
+    <index-list :index="artists_list.indexList"></index-list>
 
     <content-with-heading>
+      <template slot="options">
+        <index-button-list :index="artists_list.indexList"></index-button-list>
+
+        <div class="columns">
+          <div class="column">
+            <p class="heading" style="margin-bottom: 24px;">Sort by</p>
+            <dropdown-menu v-model="sort" :options="sort_options"></dropdown-menu>
+          </div>
+        </div>
+      </template>
       <template slot="heading-left">
         <p class="title is-4">{{ genre }}</p>
       </template>
@@ -20,14 +30,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile">{{ artists.total }} artists | <a class="has-text-link" @click="open_albums">albums</a> | <a class="has-text-link" @click="open_tracks">tracks</a> | <a class="has-text-link" @click="open_composers">composers</a></p>
-        <list-item-artist v-for="artist in artists.items" :key="artist.id" :artist="artist" @click="open_artist(artist)">
-          <template slot="actions">
-            <a @click="open_dialog(artist)">
-              <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
-            </a>
-          </template>
-        </list-item-artist>
-        <modal-dialog-artist :show="show_details_modal" :artist="selected_artist" @close="show_details_modal = false" />
+        <list-artists :artists="artists_list"></list-artists>
         <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
     </content-with-heading>
@@ -38,11 +41,14 @@
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import TabsMusic from '@/components/TabsMusic'
-import ListItemArtist from '@/components/ListItemArtist'
-import ModalDialogArtist from '@/components/ModalDialogArtist'
+import IndexButtonList from '@/components/IndexButtonList'
+import ListArtists from '@/components/ListArtists'
+import DropdownMenu from '@/components/DropdownMenu'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
 import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
+import * as types from '@/store/mutation_types'
+import Artists from '@/lib/Artists'
 
 const artistsData = {
   load: function (to) {
@@ -58,21 +64,39 @@ const artistsData = {
 export default {
   name: 'PageGenreArtists',
   mixins: [LoadDataBeforeEnterMixin(artistsData)],
-  components: { ContentWithHeading, TabsMusic, ListItemArtist, IndexList, ModalDialogArtist, ModalDialogGenre },
+  components: { ContentWithHeading, TabsMusic, IndexButtonList, ListArtists, IndexList, ModalDialogGenre, DropdownMenu },
 
   data () {
     return {
       artists: { items: [] },
       genre: '',
+      sort_options: ['Name', 'Recently added'],
 
       show_details_modal: false,
-      selected_artist: {},
 
       show_genre_details_modal: false
     }
   },
 
   computed: {
+    artists_list () {
+      return new Artists(this.artists.items, {
+        hideSingles: this.hide_singles,
+        hideSpotify: this.hide_spotify,
+        sort: this.sort,
+        group: true
+      })
+    },
+
+    sort: {
+      get () {
+        return this.$store.state.artists_sort
+      },
+      set (value) {
+        this.$store.commit(types.ARTISTS_SORT, value)
+      }
+    },
+
     modal_obj () {
       return {
         name: this.genre,
@@ -87,11 +111,6 @@ export default {
         }, 0),
         uri: this.artists.items.map(a => a.uri).join(',')
       }
-    },
-
-    index_list () {
-      return [...new Set(this.artists.items
-        .map(artist => artist.name_sort.charAt(0).toUpperCase()))]
     }
   },
 
@@ -123,9 +142,8 @@ export default {
       webapi.player_play_expression('genre is "' + this.genre + '" and media_kind is music', false, position)
     },
 
-    open_dialog: function (artist) {
-      this.selected_artist = artist
-      this.show_details_modal = true
+    scrollToTop: function () {
+      window.scrollTo({ top: 0, behavior: 'smooth' })
     }
   }
 }

commit e716ef300971448314e4c6013687efd87ae503c4
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Jan 7 12:52:26 2022 +0000

    ray: [web-src] genre album sort options

diff --git a/web-src/src/pages/PageGenre.vue b/web-src/src/pages/PageGenre.vue
index 1b6b99b9..4a0c539c 100644
--- a/web-src/src/pages/PageGenre.vue
+++ b/web-src/src/pages/PageGenre.vue
@@ -2,9 +2,19 @@
   <div>
     <tabs-music></tabs-music>
 
-    <index-list :index="index_list"></index-list>
+    <index-list :index="albums_list.indexList"></index-list>
 
     <content-with-heading>
+      <template slot="options">
+        <index-button-list :index="albums_list.indexList"></index-button-list>
+
+        <div class="columns">
+          <div class="column">
+            <p class="heading" style="margin-bottom: 24px;">Sort by</p>
+            <dropdown-menu v-model="sort" :options="sort_options"></dropdown-menu>
+          </div>
+        </div>
+      </template>
       <template slot="heading-left">
         <p class="title is-4">{{ name }}</p>
       </template>
@@ -20,7 +30,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | {{ genre_albums.total }} albums | <a class="has-text-link" @click="open_tracks">tracks</a> | <a class="has-text-link" @click="open_composers">composers</a> </p>
-        <list-albums :albums="genre_albums.items"></list-albums>
+        <list-albums :albums="albums_list"></list-albums>
         <modal-dialog-album :show="show_details_modal" :album="selected_album" @close="show_details_modal = false" />
         <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
@@ -31,12 +41,16 @@
 <script>
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
+import IndexButtonList from '@/components/IndexButtonList'
+import DropdownMenu from '@/components/DropdownMenu'
 import ListAlbums from '@/components/ListAlbums'
 import TabsMusic from '@/components/TabsMusic'
 import ModalDialogAlbum from '@/components/ModalDialogAlbum'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
 import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
+import * as types from '@/store/mutation_types'
+import Albums from '@/lib/Albums'
 
 const genreData = {
   load: function (to) {
@@ -56,7 +70,7 @@ const genreData = {
 export default {
   name: 'PageGenre',
   mixins: [LoadDataBeforeEnterMixin(genreData)],
-  components: { ContentWithHeading, ListAlbums, ModalDialogGenre, ModalDialogAlbum, IndexList, TabsMusic },
+  components: { ContentWithHeading, IndexButtonList, DropdownMenu, ListAlbums, ModalDialogGenre, ModalDialogAlbum, IndexList, TabsMusic },
 
   data () {
     return {
@@ -65,6 +79,7 @@ export default {
       tracks: 0,
       show_details_modal: false,
       selected_album: {},
+      sort_options: ['Name', 'Recently added', 'Recently released'],
       show_genre_details_modal: false
     }
   },
@@ -80,9 +95,20 @@ export default {
       }
     },
 
-    index_list () {
-      return [...new Set(this.genre_albums.items
-        .map(album => album.name_sort.charAt(0).toUpperCase()))]
+    albums_list () {
+      return new Albums(this.genre_albums.items, {
+        sort: this.sort,
+        group: true
+      })
+    },
+
+    sort: {
+      get () {
+        return this.$store.state.albums_sort
+      },
+      set (value) {
+        this.$store.commit(types.ALBUMS_SORT, value)
+      }
     }
   },
 
@@ -111,6 +137,10 @@ export default {
       webapi.player_play_expression('genre is "' + this.name + '" and media_kind is music', true)
     },
 
+    scrollToTop: function () {
+      window.scrollTo({ top: 0, behavior: 'smooth' })
+    },
+
     open_dialog: function (album) {
       this.selected_album = album
       this.show_details_modal = true

commit 99b047a597b5613eb87b71064edec8a62c3e267f
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Dec 25 13:17:26 2021 +0000

    [web-src] limit 'recently added' blocks correctly

diff --git a/web-src/src/pages/PageBrowseRecentlyAdded.vue b/web-src/src/pages/PageBrowseRecentlyAdded.vue
index 0cd7c8b8..1f0edf61 100644
--- a/web-src/src/pages/PageBrowseRecentlyAdded.vue
+++ b/web-src/src/pages/PageBrowseRecentlyAdded.vue
@@ -115,9 +115,28 @@ const browseData = {
   },
 
   set: function (vm, response) {
+    let N = store.getters.settings_option_recently_added_limit
+
     vm.recently_added_today = response[0].data.albums
+    if (vm.recently_added_today.length > N) {
+      vm.recently_added_today.length = N
+      N = 0
+    } else {
+      N -= vm.recently_added_today.length
+    }
+
     vm.recently_added_week = response[1].data.albums
+    if (vm.recently_added_week.length > N) {
+      vm.recently_added_week.length = N
+      N = 0
+    } else {
+      N -= vm.recently_added_week.length
+    }
+
     vm.recently_added_month = response[2].data.albums
+    if (vm.recently_added_month.length > N) {
+      vm.recently_added_month.length = N
+    }
   }
 }
 

commit aa19658d7e879c804626389d3eaa0c51d73baaf4
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Dec 24 20:56:13 2021 +0000

    ray: [web-src] use ListComposer for index block separation

diff --git a/web-src/src/pages/PageComposers.vue b/web-src/src/pages/PageComposers.vue
index 85c5b10d..5505207e 100644
--- a/web-src/src/pages/PageComposers.vue
+++ b/web-src/src/pages/PageComposers.vue
@@ -21,6 +21,7 @@ import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import TabsMusic from '@/components/TabsMusic'
 import ListComposers from '@/components/ListComposers'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 import Composers from '@/lib/Composers'
 

commit ff8ca329240445e85fa07b27bc3efc53f1adfcfd
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Dec 24 20:55:14 2021 +0000

    ray: [web-src] correct for no name_sort

diff --git a/web-src/src/lib/Composers.js b/web-src/src/lib/Composers.js
index 67f2c8c7..3c6f5626 100644
--- a/web-src/src/lib/Composers.js
+++ b/web-src/src/lib/Composers.js
@@ -18,7 +18,7 @@ export default class Composers {
 
   getComposerIndex (composer) {
     if (this.options.sort === 'Name') {
-      return composer.name_sort.charAt(0).toUpperCase()
+      return composer.name.charAt(0).toUpperCase()
     }
     return composer.time_added.substring(0, 4)
   }

commit b37602a1a82cd5e138bbed4494952295c4b97995
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Dec 24 20:16:13 2021 +0000

    [web-src] make each 'recently added' block be unique

diff --git a/web-src/src/pages/PageBrowseRecentlyAdded.vue b/web-src/src/pages/PageBrowseRecentlyAdded.vue
index ca9ec77e..0cd7c8b8 100644
--- a/web-src/src/pages/PageBrowseRecentlyAdded.vue
+++ b/web-src/src/pages/PageBrowseRecentlyAdded.vue
@@ -103,12 +103,12 @@ const browseData = {
       }),
       webapi.search({
         type: 'album',
-        expression: 'time_added after this week and media_kind is music order by time_added desc',
+        expression: 'time_added after this week and time_added before today and media_kind is music order by time_added desc',
         limit: recentlyAddedLimit
       }),
       webapi.search({
         type: 'album',
-        expression: 'time_added after last month and media_kind is music order by time_added desc',
+        expression: 'time_added after last month and time_added before this week and media_kind is music order by time_added desc',
         limit: recentlyAddedLimit
       })
     ])
@@ -141,7 +141,7 @@ export default {
   },
 
   mounted () {
-    const more = store.getters.settings_option_recently_added_limit - this.recently_added_month.items.length
+    const more = store.getters.settings_option_recently_added_limit - (this.recently_added_month.items.length + this.recently_added_week.items.length + this.recently_added_today.items.length)
     if (more) {
       webapi.search({
         type: 'album',
@@ -167,7 +167,7 @@ export default {
       return this.recently_added_older.items.length > 0
     },
     recently_added () {
-      return this.recently_added_older.items.length + this.recently_added_month.items.length
+      return this.recently_added_older.items.length + this.recently_added_month.items.length + this.recently_added_week.items.length + this.recently_added_today.items.length
     }
   }
 }

commit e719e097fa8d14cc01cead6c904ada9cee5b48e0
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Sep 29 14:36:15 2021 +0100

    [web-src] handle usermark in all pages

diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index 0e84f505..6336bf72 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -29,7 +29,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artist">{{ album_count }} albums</a> | {{ track_count }} tracks</p>
-        <list-tracks :tracks="rated_tracks"></list-tracks>
+        <list-tracks :tracks="rated_tracks" @usermark-updated="usermark_upd"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-artist :show="show_artist_details_modal" :artist="modal_artist_obj" @close="show_artist_details_modal = false" />
       </template>
@@ -132,6 +132,10 @@ export default {
       this.$router.push({ path: '/music/artists/' + this.id })
     },
 
+    usermark_upd: function (args) {
+      this.tracks.items.find(e => e.id === args.track_id).usermark = args.value
+    },
+
     play: function () {
       webapi.player_play_uri(this.tracks.items.map(a => a.uri).join(','), true)
     }
diff --git a/web-src/src/pages/PageBrowse.vue b/web-src/src/pages/PageBrowse.vue
index 72667f67..7ab12dbb 100644
--- a/web-src/src/pages/PageBrowse.vue
+++ b/web-src/src/pages/PageBrowse.vue
@@ -26,7 +26,7 @@
         <p class="heading">tracks</p>
       </template>
       <template slot="content">
-        <list-tracks :tracks="recently_added_tracks.items"></list-tracks>
+        <list-tracks :tracks="recently_added_tracks.items" @usermark-updated="usermark_upd_added"></list-tracks>
       </template>
       <template slot="footer">
         <nav class="level">
@@ -44,7 +44,7 @@
         <p class="heading">tracks</p>
       </template>
       <template slot="content">
-        <list-tracks :tracks="recently_played.items"></list-tracks>
+        <list-tracks :tracks="recently_played.items" @usermark-updated="usermark_upd_played"></list-tracks>
       </template>
       <template slot="footer">
         <nav class="level">
@@ -100,6 +100,17 @@ export default {
   methods: {
     open_browse: function (type) {
       this.$router.push({ path: '/music/browse/' + type })
+    },
+
+    usermark_upd_added: function (args) {
+      this.usermark_upd(this.recently_added_tracks.items, args)
+    },
+    usermark_upd_played: function (args) {
+      this.usermark_upd(this.recently_played.items, args)
+    },
+
+    usermark_upd: function (what, args) {
+      what.find(e => e.id === args.track_id).usermark = args.value
     }
   }
 }
diff --git a/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue b/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
index c75aab5a..27b7015f 100644
--- a/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
+++ b/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
@@ -22,7 +22,7 @@
         </div>
       </template>
       <template slot="content">
-        <list-tracks :tracks="recently_added_today.items"></list-tracks>
+        <list-tracks :tracks="recently_added_today.items" @usermark-updated="usermark_upd_today"></list-tracks>
         <modal-dialog-tracks :show="show_modal_today" title='Recently Added - Today' :tracks="recently_added_today" @close="show_modal_today = false" />
       </template>
     </content-with-heading>
@@ -40,7 +40,7 @@
         </div>
       </template>
       <template slot="content">
-        <list-tracks :tracks="recently_added_week.items"></list-tracks>
+        <list-tracks :tracks="recently_added_week.items" @usermark-updated="usermark_upd_week"></list-tracks>
         <modal-dialog-tracks :show="show_modal_week" title='Recently Added - Past Week' :tracks="recently_added_week" @close="show_modal_week = false" />
       </template>
     </content-with-heading>
@@ -58,7 +58,7 @@
         </div>
       </template>
       <template slot="content">
-        <list-tracks :tracks="recently_added_month.items"></list-tracks>
+        <list-tracks :tracks="recently_added_month.items" @usermark-updated="usermark_upd_month"></list-tracks>
         <modal-dialog-tracks :show="show_modal_month" title='Recently Added - Past Month' :tracks="recently_added_month" @close="show_modal_month = false" />
       </template>
     </content-with-heading>
@@ -76,7 +76,7 @@
         </div>
       </template>
       <template slot="content">
-        <list-tracks :tracks="recently_added_older.items"></list-tracks>
+        <list-tracks :tracks="recently_added_older.items" @usermark-updated="usermark_upd_older"></list-tracks>
         <modal-dialog-tracks :show="show_modal_older" title='Recently Added - Older than Month' :tracks="recently_added_older" @close="show_modal_older = false" />
       </template>
     </content-with-heading>
@@ -153,6 +153,25 @@ export default {
     }
   },
 
+  methods: {
+    usermark_upd_today: function (args) {
+      this.usermark_upd(this.recently_added_today.items, args)
+    },
+    usermark_upd_week: function (args) {
+      this.usermark_upd(this.recently_added_week.items, args)
+    },
+    usermark_upd_month: function (args) {
+      this.usermark_upd(this.recently_added_month.items, args)
+    },
+    usermark_upd_older: function (args) {
+      this.usermark_upd(this.recently_added_older.items, args)
+    },
+
+    usermark_upd: function (what, args) {
+      what.find(e => e.id === args.track_id).usermark = args.value
+    }
+  },
+
   computed: {
     show_recent_today () {
       return this.recently_added_today.items.length > 0
diff --git a/web-src/src/pages/PageFiles.vue b/web-src/src/pages/PageFiles.vue
index 41d781ca..5dc60ee6 100644
--- a/web-src/src/pages/PageFiles.vue
+++ b/web-src/src/pages/PageFiles.vue
@@ -105,7 +105,7 @@
 
         <modal-dialog-directory :show="show_directory_details_modal" :directory="selected_directory" @close="show_directory_details_modal = false" />
         <modal-dialog-playlist :show="show_playlist_details_modal" :playlist="selected_playlist" @close="show_playlist_details_modal = false" />
-        <modal-dialog-track :show="show_track_details_modal" :track="selected_track" @close="show_track_details_modal = false" />
+        <modal-dialog-track :show="show_track_details_modal" :track="selected_track" @close="show_track_details_modal = false" @usermark-updated="usermark_upd"/>
       </template>
     </content-with-heading>
   </div>
@@ -250,6 +250,10 @@ export default {
     open_playlist_dialog: function (playlist) {
       this.selected_playlist = playlist
       this.show_playlist_details_modal = true
+    },
+
+    usermark_upd: function (args) {
+      this.files.tracks.items.find(e => e.id === args.track_id).usermark = args.value
     }
   }
 }
diff --git a/web-src/src/pages/PageSearch.vue b/web-src/src/pages/PageSearch.vue
index 923c3497..00364105 100644
--- a/web-src/src/pages/PageSearch.vue
+++ b/web-src/src/pages/PageSearch.vue
@@ -34,7 +34,7 @@
         <p class="title is-4">Tracks</p>
       </template>
       <template slot="content">
-        <list-tracks :tracks="tracks.items"></list-tracks>
+        <list-tracks :tracks="tracks.items" @usermark-updated="usermark_upd"></list-tracks>
       </template>
       <template slot="footer">
         <nav v-if="show_all_tracks_button" class="level">
@@ -387,6 +387,10 @@ export default {
       this.$refs.search_field.blur()
     },
 
+    usermark_upd: function (args) {
+      this.tracks.items.find(e => e.id === args.track_id).usermark = args.value
+    },
+
     open_search_tracks: function () {
       this.$router.push({
         path: '/search/library',

commit eb3b1339c814d028b317dc808228a4b0f51f084c
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Sep 29 14:00:45 2021 +0100

    [web-src] misisng propogate usermark event to album page from modal via track list

diff --git a/web-src/src/components/ListTracks.vue b/web-src/src/components/ListTracks.vue
index fdb856b1..30cc8cb3 100644
--- a/web-src/src/components/ListTracks.vue
+++ b/web-src/src/components/ListTracks.vue
@@ -7,7 +7,7 @@
         </a>
       </template>
     </list-item-track>
-    <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
+    <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" @usermark-updated="usermark_upd" />
   </div>
 </template>
 
@@ -40,6 +40,10 @@ export default {
       }
     },
 
+    usermark_upd: function (args) {
+      this.$emit('usermark-updated', args)
+    },
+
     open_dialog: function (track) {
       this.selected_track = track
       this.show_details_modal = true
diff --git a/web-src/src/components/ModalDialogTrack.vue b/web-src/src/components/ModalDialogTrack.vue
index 6a634699..31859ff1 100644
--- a/web-src/src/components/ModalDialogTrack.vue
+++ b/web-src/src/components/ModalDialogTrack.vue
@@ -203,6 +203,7 @@ export default {
       const newvalue = value === 0 ? 0 : value | this.usermark
       webapi.library_track_set_usermark(this.track.id, newvalue).then(() => {
         this.usermark = newvalue
+        this.$emit('usermark-updated', { value: this.usermark, track_id: this.track.id })
       })
     },
 
diff --git a/web-src/src/pages/PageAlbum.vue b/web-src/src/pages/PageAlbum.vue
index 4895f4ab..89d22d59 100644
--- a/web-src/src/pages/PageAlbum.vue
+++ b/web-src/src/pages/PageAlbum.vue
@@ -24,7 +24,7 @@
     </template>
     <template slot="content">
       <p class="heading is-7 has-text-centered-mobile fd-has-margin-top">{{ album.track_count }} tracks</p>
-      <list-tracks :tracks="tracks" :uris="album.uri"></list-tracks>
+      <list-tracks :tracks="tracks" :uris="album.uri" @usermark-updated="usermark_upd"></list-tracks>
       <modal-dialog-album :show="show_album_details_modal" :album="album" @close="show_album_details_modal = false" />
     </template>
   </content-with-hero>
@@ -72,6 +72,10 @@ export default {
       this.$router.push({ path: '/music/artists/' + this.album.artist_id })
     },
 
+    usermark_upd: function (args) {
+      this.tracks.find(e => e.id === args.track_id).usermark = args.value
+    },
+
     play: function () {
       webapi.player_play_uri(this.album.uri, true)
     }

commit 25aea65620a4973d7a43afd610442d4c570960ab
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Sep 18 20:17:14 2021 +0100

    [web-src] usermark
    allow 'usermark' to be set via modal from now playing page and queue list
    now playlist and track listing (not queue listing) gives indication of usermarked track

diff --git a/web-src/src/components/ListItemTrack.vue b/web-src/src/components/ListItemTrack.vue
index 31c6d8f2..b4c50a70 100644
--- a/web-src/src/components/ListItemTrack.vue
+++ b/web-src/src/components/ListItemTrack.vue
@@ -4,7 +4,7 @@
       <slot name="icon"></slot>
     </figure>
     <div class="media-content fd-has-action is-clipped" @click="listeners.click">
-      <h1 class="title is-6" :class="{ 'has-text-grey': props.track.media_kind === 'podcast' && props.track.play_count > 0 }">{{ props.track.title }}</h1>
+      <h1 class="title is-6" :class="{ 'has-text-grey': props.track.usermark > 0 || props.track.media_kind === 'podcast' && props.track.play_count > 0, 'is-italic': props.track.usermark > 0 }">{{ props.track.title }}</h1>
       <h2 class="subtitle is-7 has-text-grey"><b>{{ props.track.artist }}</b></h2>
       <h2 class="subtitle is-7 has-text-grey">{{ props.track.album }}</h2>
       <slot name="progress"></slot>
diff --git a/web-src/src/components/ModalDialogQueueItem.vue b/web-src/src/components/ModalDialogQueueItem.vue
index 9efd3bbc..96ebe748 100644
--- a/web-src/src/components/ModalDialogQueueItem.vue
+++ b/web-src/src/components/ModalDialogQueueItem.vue
@@ -61,15 +61,16 @@
                     <span v-if="item.bitrate"> | {{ item.bitrate }} Kb/s</span>
                   </span>
                 </p>
-                <p>
-                  <span class="heading">Usermark</span>
-                  <span class="title is-6">{{ this.usermark }}</span>
-                </p>
-                <div class="buttons">
-                  <a class="button is-small is-danger" @click="usermark_update(1)">Mark to delete</a>
-                  <a class="button is-small is-warning" @click="usermark_update(2)">Mark to rexcode</a>
-                  <a class="button is-small is-warning" @click="usermark_update(4)">Mark to review</a>
-                  <a v-if="this.usermark > 0" class="button is-small is-success" @click="usermark_update(0)">Mark reset</a>
+                <div v-if="this.item.data_kind === 'file'">
+                  <p>
+                    <span class="heading">Usermark</span>
+                  </p>
+                  <div class="buttons">
+                    <a :disabled="this.usermark_is_set(1)" class="button is-small is-danger" @click="usermark_update(1)">Mark to delete</a>
+                    <a :disabled="this.usermark_is_set(2)" class="button is-small is-warning" @click="usermark_update(2)">Mark to rexcode</a>
+                    <a :disabled="this.usermark_is_set(4)" class="button is-small is-warning" @click="usermark_update(4)">Mark to review</a>
+                    <a :disabled="this.usermark === 0" class="button is-small is-success" @click="usermark_update(0)">Mark reset</a>
+                  </div>
                 </div>
               </div>
             </div>
@@ -98,7 +99,7 @@ import SpotifyWebApi from 'spotify-web-api-js'
 
 export default {
   name: 'ModalDialogQueueItem',
-  props: ['show', 'item'],
+  props: ['show', 'item', 'np_usermark'],
 
   data () {
     return {
@@ -155,21 +156,19 @@ export default {
       this.$router.push({ path: '/music/spotify/albums/' + this.spotify_track.album.id })
     },
 
+    usermark_is_set: function (value) {
+      return (this.usermark & value) > 0
+    },
+
     usermark_update (value) {
       const newvalue = value === 0 ? 0 : value | this.usermark
-      webapi.library_track_set_usermark(this.track_id, newvalue).then(() => {
+      webapi.library_track_set_usermark(this.item.track_id, newvalue).then(() => {
         this.usermark = newvalue
+        this.$emit('close_usermark', { value: this.usermark })
       })
     }
   },
 
-  computed: {
-    track_id () {
-      const item = this.$store.state.queue.items.find((elem) => elem.id === this.item.id)
-      return (item === undefined) ? -1 : item.track_id
-    }
-  },
-
   watch: {
     'item' () {
       if (this.item && this.item.data_kind === 'spotify') {
@@ -180,11 +179,15 @@ export default {
         })
       } else {
         this.spotify_track = {}
-        webapi.library_track(this.track_id).then((response) => {
-          this.usermark = response.data.usermark
-        }).catch(() => {
-          this.usermark = -1
-        })
+        if (this.np_usermark !== undefined) {
+          this.usermark = this.np_usermark
+        } else if (this.item.data_kind === 'file') {
+          webapi.library_track(this.item.track_id).then((response) => {
+            this.usermark = response.data.usermark
+          }).catch(() => {
+            this.usermark = -1
+          })
+        }
       }
     }
   }
diff --git a/web-src/src/components/ModalDialogTrack.vue b/web-src/src/components/ModalDialogTrack.vue
index 27ac1f92..6a634699 100644
--- a/web-src/src/components/ModalDialogTrack.vue
+++ b/web-src/src/components/ModalDialogTrack.vue
@@ -84,6 +84,17 @@
                     @rating-selected="rate_track"></star-rating> </span>
                   <span class="title is-6">{{ Math.floor(track.rating / 10) }} / 10</span>
                 </p>
+                <div v-if="this.track.data_kind === 'file'">
+                  <p>
+                    <span class="heading">Usermark</span>
+                  </p>
+                  <div class="buttons">
+                    <a :disabled="this.usermark_is_set(1)" class="button is-small is-danger" @click="usermark_update(1)">Mark to delete</a>
+                    <a :disabled="this.usermark_is_set(2)" class="button is-small is-warning" @click="usermark_update(2)">Mark to rexcode</a>
+                    <a :disabled="this.usermark_is_set(4)" class="button is-small is-warning" @click="usermark_update(4)">Mark to review</a>
+                    <a :disabled="this.usermark === 0" class="button is-small is-success" @click="usermark_update(0)">Mark reset</a>
+                  </div>
+                </div>
                 <p v-if="track.comment">
                   <span class="heading">Comment</span>
                   <span class="title is-6">{{ track.comment }}</span>
@@ -123,6 +134,7 @@ export default {
   data () {
     return {
       rating: 0,
+      usermark: -1,
       spotify_track: {}
     }
   },
@@ -183,6 +195,17 @@ export default {
       this.$router.push({ path: '/music/spotify/albums/' + this.spotify_track.album.id })
     },
 
+    usermark_is_set: function (value) {
+      return (this.usermark & value) > 0
+    },
+
+    usermark_update (value) {
+      const newvalue = value === 0 ? 0 : value | this.usermark
+      webapi.library_track_set_usermark(this.track.id, newvalue).then(() => {
+        this.usermark = newvalue
+      })
+    },
+
     mark_new: function () {
       webapi.library_track_update(this.track.id, { play_count: 'reset' }).then(() => {
         this.$emit('play-count-changed')
@@ -209,6 +232,13 @@ export default {
       } else {
         this.spotify_track = {}
         this.rating = this.track.rating
+        if (this.track.data_kind === 'file') {
+          webapi.library_track(this.track.id).then((response) => {
+            this.usermark = response.data.usermark
+          }).catch(() => {
+            this.usermark = -1
+          })
+        }
       }
     }
   }
diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index 01a05087..f9f9bee6 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -41,7 +41,7 @@
       </div>
       <div class="fd-has-padding-left-right">
         <div class="container has-text-centered fd-has-margin-top">
-          <h1 class="title is-5">
+          <h1 :class="{ 'title': true, 'is-5': true, 'has-text-grey': this.usermark > 0, 'is-italic': this.usermark > 0}">
             {{ now_playing.title }}
             <h2 class="subtitle is-7 has-text-grey" v-if="composer">
               {{ composer }}
@@ -71,7 +71,7 @@
         </div>
       </div>
     </div>
-    <modal-dialog-queue-item :show="show_details_modal" :item="selected_item" @close="show_details_modal = false" />
+    <modal-dialog-queue-item :show="show_details_modal" :item="selected_item" :np_usermark="this.usermark" @close="show_details_modal = false" @close_usermark="close_usermark_upd"/>
   </section>
 </template>
 
@@ -94,6 +94,7 @@ export default {
       interval_id: 0,
 
       rating: 0,
+      usermark: 0,
 
       show_details_modal: false,
       selected_item: {}
@@ -183,6 +184,11 @@ export default {
       webapi.library_track_set_rating(this.now_playing.track_id, this.rating * 20)
     },
 
+    close_usermark_upd: function (args) {
+      this.usermark = args.value
+      this.show_details_modal = false
+    },
+
     open_dialog: function (item) {
       this.selected_item = item
       this.show_details_modal = true
@@ -204,8 +210,10 @@ export default {
     'now_playing' () {
       webapi.library_track(this.now_playing.track_id).then((response) => {
         this.rating = response.data.rating / 20
+        this.usermark = response.data.usermark
       }).catch(() => {
         this.rating = 0
+        this.usermark = 0
       })
     }
   }

commit 8bad343c45a675acb72a9709791d4b03ecb94b66
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Mon Sep 6 18:58:13 2021 +0100

    [web-src] now playing modal setting track's usermark review status

diff --git a/web-src/src/components/ModalDialogQueueItem.vue b/web-src/src/components/ModalDialogQueueItem.vue
index ce4a8d5a..9efd3bbc 100644
--- a/web-src/src/components/ModalDialogQueueItem.vue
+++ b/web-src/src/components/ModalDialogQueueItem.vue
@@ -61,6 +61,16 @@
                     <span v-if="item.bitrate"> | {{ item.bitrate }} Kb/s</span>
                   </span>
                 </p>
+                <p>
+                  <span class="heading">Usermark</span>
+                  <span class="title is-6">{{ this.usermark }}</span>
+                </p>
+                <div class="buttons">
+                  <a class="button is-small is-danger" @click="usermark_update(1)">Mark to delete</a>
+                  <a class="button is-small is-warning" @click="usermark_update(2)">Mark to rexcode</a>
+                  <a class="button is-small is-warning" @click="usermark_update(4)">Mark to review</a>
+                  <a v-if="this.usermark > 0" class="button is-small is-success" @click="usermark_update(0)">Mark reset</a>
+                </div>
               </div>
             </div>
             <footer class="card-footer">
@@ -92,6 +102,7 @@ export default {
 
   data () {
     return {
+      usermark: -1,
       spotify_track: {}
     }
   },
@@ -142,6 +153,20 @@ export default {
     open_spotify_album: function () {
       this.$emit('close')
       this.$router.push({ path: '/music/spotify/albums/' + this.spotify_track.album.id })
+    },
+
+    usermark_update (value) {
+      const newvalue = value === 0 ? 0 : value | this.usermark
+      webapi.library_track_set_usermark(this.track_id, newvalue).then(() => {
+        this.usermark = newvalue
+      })
+    }
+  },
+
+  computed: {
+    track_id () {
+      const item = this.$store.state.queue.items.find((elem) => elem.id === this.item.id)
+      return (item === undefined) ? -1 : item.track_id
     }
   },
 
@@ -155,6 +180,11 @@ export default {
         })
       } else {
         this.spotify_track = {}
+        webapi.library_track(this.track_id).then((response) => {
+          this.usermark = response.data.usermark
+        }).catch(() => {
+          this.usermark = -1
+        })
       }
     }
   }
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index 1b43f880..086131f0 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -392,6 +392,13 @@ export default {
     })
   },
 
+  library_track_set_usermark (trackId, flag) {
+    return axios.put('/api/library/tracks/' + trackId, undefined, { params: { usermark: flag } }).then((response) => {
+      store.dispatch('add_notification', { text: flag === 0 ? 'Track Review Reset' : 'Track Review Updated', type: flag === 0 ? 'success' : 'info', timeout: 1500 })
+      return Promise.resolve(response)
+    })
+  },
+
   library_files (directory = undefined) {
     const filesParams = { directory: directory }
     return axios.get('./api/library/files', {

commit a327369ab22b592b67e943ab694d8ab0f0346c1a
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Mar 28 16:44:13 2021 +0100

    ray: [web-src] track dialog sets rating

diff --git a/web-src/src/components/ModalDialogTrack.vue b/web-src/src/components/ModalDialogTrack.vue
index 203573cd..27ac1f92 100644
--- a/web-src/src/components/ModalDialogTrack.vue
+++ b/web-src/src/components/ModalDialogTrack.vue
@@ -72,6 +72,16 @@
                 </p>
                 <p>
                   <span class="heading">Rating</span>
+                  <span class="heading"><star-rating v-model="rating"
+                    :star-size="24"
+                    :padding="7"
+                    :show-rating="false"
+                    :max-rating="5"
+                    :increment="1"
+                    :inline="true"
+                    :clearable="true"
+                    :active-on-click="true"
+                    @rating-selected="rate_track"></star-rating> </span>
                   <span class="title is-6">{{ Math.floor(track.rating / 10) }} / 10</span>
                 </p>
                 <p v-if="track.comment">
@@ -102,14 +112,17 @@
 <script>
 import webapi from '@/webapi'
 import SpotifyWebApi from 'spotify-web-api-js'
+import StarRating from 'vue-star-rating'
 
 export default {
   name: 'ModalDialogTrack',
+  components: { StarRating },
 
   props: ['show', 'track'],
 
   data () {
     return {
+      rating: 0,
       spotify_track: {}
     }
   },
@@ -120,6 +133,14 @@ export default {
       webapi.player_play_uri(this.track.uri, false)
     },
 
+    rate_track: function (rating) {
+      if (rating === 0.5) {
+        rating = 0
+      }
+      this.rating = Math.ceil(rating) * 20
+      webapi.library_track_set_rating(this.track.id, this.rating)
+    },
+
     queue_add: function () {
       webapi.queue_add(this.track.uri).then(() => {
         this.$emit('close')
@@ -187,6 +208,7 @@ export default {
         })
       } else {
         this.spotify_track = {}
+        this.rating = this.track.rating
       }
     }
   }

commit 082d074b6677fe89825933f5332b881bfed9d879
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Mar 28 18:03:17 2021 +0100

    ray: [web-src] now playing click to reset and actv (no hover)

diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index 691e11ce..01a05087 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -3,11 +3,13 @@
     <div v-if="now_playing.id > 0" class="fd-is-fullheight">
       <div class="has-text-centered fd-has-padding-left-right"><star-rating v-model="rating"
         :star-size="17"
-        :padding="3"
+        :padding="5"
         :show-rating="false"
         :max-rating="5"
-        :increment="0.5"
+        :increment="1"
         :inline="true"
+        :clearable="true"
+        :active-on-click="true"
         @rating-selected="rate_track"></star-rating> </div>
       <div class="fd-is-expanded">
         <cover-artwork @click="open_dialog(now_playing)"

commit 6439959edf1b78b791c180becfc5ed035a415319
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Mar 28 12:58:47 2021 +0100

    ray: [web-src] visible diff for rating update/reset

diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index 3425f705..1b43f880 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -387,7 +387,7 @@ export default {
 
   library_track_set_rating (trackId, rating) {
     return axios.put('/api/library/tracks/' + trackId, undefined, { params: { rating: rating } }).then((response) => {
-      store.dispatch('add_notification', { text: 'track rating updated', type: 'info', timeout: 1500 })
+      store.dispatch('add_notification', { text: rating === 0 ? 'Track Rating Reset' : 'Track Rating Updated', type: rating === 0 ? 'success' : 'info', timeout: 1500 })
       return Promise.resolve(response)
     })
   },

commit 30e0db5da75999c125d82b828cbbdface2aefdfa
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Jan 10 13:56:47 2021 +0000

    ray: [web-src] star rating fix - handle adding genre on 'Genres' page and also on individual 'Genre' page with rating applied

diff --git a/web-src/src/components/ModalDialogGenre.vue b/web-src/src/components/ModalDialogGenre.vue
index 6aad2e91..4e3fbf20 100644
--- a/web-src/src/components/ModalDialogGenre.vue
+++ b/web-src/src/components/ModalDialogGenre.vue
@@ -51,17 +51,29 @@ export default {
   methods: {
     play: function () {
       this.$emit('close')
-      webapi.player_play_expression('genre is "' + this.genre.name + '" and media_kind is music', false)
+      if (this.genre.uri === undefined) {
+        webapi.player_play_expression('genre is "' + this.genre.name + '" and media_kind is music', false)
+      } else {
+        webapi.player_play_uri(this.genre.uri, false)
+      }
     },
 
     queue_add: function () {
       this.$emit('close')
-      webapi.queue_expression_add('genre is "' + this.genre.name + '" and media_kind is music')
+      if (this.genre.uri === undefined) {
+        webapi.queue_expression_add('genre is "' + this.genre.name + '" and media_kind is music')
+      } else {
+        webapi.queue_add(this.genre.uri)
+      }
     },
 
     queue_add_next: function () {
       this.$emit('close')
-      webapi.queue_expression_add_next('genre is "' + this.genre.name + '" and media_kind is music')
+      if (this.genre.uri === undefined) {
+        webapi.queue_expression_add_next('genre is "' + this.genre.name + '" and media_kind is music')
+      } else {
+        webapi.queue_add_next(this.genre.uri)
+      }
     },
 
     open_albums: function () {

commit 9c2a359f5917cf4bfd4a8288560963a4a085fbfc
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Jan 10 13:08:32 2021 +0000

    ray: [web-src] add missing star rating items to PageArtistTracks

diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index 8870f6cb..0e84f505 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -13,6 +13,12 @@
       </template>
       <template slot="heading-right">
         <div class="buttons is-centered">
+          <star-rating v-model="min_rating"
+            :star-size="17"
+            :show-rating="false"
+            :max-rating="5"
+            :increment="0.5"
+            @rating-selected="show_rating"></star-rating>
           <a class="button is-small is-light is-rounded" @click="show_artist_details_modal = true">
             <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
           </a>
@@ -22,10 +28,10 @@
         </div>
       </template>
       <template slot="content">
-        <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artist">{{ artist.album_count }} albums</a> | {{ artist.track_count }} tracks</p>
-        <list-tracks :tracks="tracks.items" :uris="track_uris"></list-tracks>
+        <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artist">{{ album_count }} albums</a> | {{ track_count }} tracks</p>
+        <list-tracks :tracks="rated_tracks"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
-        <modal-dialog-artist :show="show_artist_details_modal" :artist="artist" @close="show_artist_details_modal = false" />
+        <modal-dialog-artist :show="show_artist_details_modal" :artist="modal_artist_obj" @close="show_artist_details_modal = false" />
       </template>
     </content-with-heading>
   </div>
@@ -40,6 +46,7 @@ import ModalDialogTrack from '@/components/ModalDialogTrack'
 import ModalDialogArtist from '@/components/ModalDialogArtist'
 import TabsMusic from '@/components/TabsMusic'
 import IndexList from '@/components/IndexList'
+import StarRating from 'vue-star-rating'
 import webapi from '@/webapi'
 
 const tracksData = {
@@ -61,7 +68,7 @@ const tracksData = {
 export default {
   name: 'PageArtistTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogArtist, ModalDialogTrack, IndexList, TabsMusic },
+  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogArtist, ModalDialogTrack, IndexList, TabsMusic, StarRating },
 
   data () {
     return {
@@ -69,6 +76,7 @@ export default {
       id: '',
       artist: {},
       tracks: { items: [] },
+      min_rating: 0,
 
       show_details_modal: false,
       selected_track: {},
@@ -112,6 +120,13 @@ export default {
   },
 
   methods: {
+    show_rating: function (rating) {
+      if (rating === 0.5) {
+        rating = 0
+      }
+      this.min_rating = Math.ceil(rating) * 20
+    },
+
     open_artist: function () {
       this.show_details_modal = false
       this.$router.push({ path: '/music/artists/' + this.id })

commit 9afc5ea1bbd246464fa6514a9f3767af57cf82fd
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Dec 26 18:47:56 2020 +0000

    ray: [web-src] recently added tracks

diff --git a/web-src/src/components/ModalDialogTracks.vue b/web-src/src/components/ModalDialogTracks.vue
new file mode 100644
index 00000000..3a23c34c
--- /dev/null
+++ b/web-src/src/components/ModalDialogTracks.vue
@@ -0,0 +1,83 @@
+<template>
+  <div>
+    <transition name="fade">
+      <div class="modal is-active" v-if="show">
+        <div class="modal-background" @click="$emit('close')"></div>
+        <div class="modal-content fd-modal-card">
+          <div class="card">
+            <div class="card-content">
+              <p class="title is-4"> {{ title }}</p>
+              <div class="content is-small">
+                <p>
+                  <span class="heading">Albums</span>
+                  <span class="title is-6">{{ album_count }}</span>
+                </p>
+                <p>
+                  <span class="heading">Artists</span>
+                  <span class="title is-6">{{ artist_count }}</span>
+                </p>
+                <p>
+                  <span class="heading">Tracks</span>
+                  <span class="title is-6">{{ tracks.total }}</span>
+                </p>
+              </div>
+            </div>
+            <footer class="card-footer">
+              <a class="card-footer-item has-text-dark" @click="queue_add">
+                <span class="icon"><i class="mdi mdi-playlist-plus"></i></span> <span class="is-size-7">Add</span>
+              </a>
+              <a class="card-footer-item has-text-dark" @click="queue_add_next">
+                <span class="icon"><i class="mdi mdi-playlist-play"></i></span> <span class="is-size-7">Add Next</span>
+              </a>
+              <a class="card-footer-item has-text-dark" @click="play">
+                <span class="icon"><i class="mdi mdi-play"></i></span> <span class="is-size-7">Play</span>
+              </a>
+            </footer>
+          </div>
+        </div>
+        <button class="modal-close is-large" aria-label="close" @click="$emit('close')"></button>
+      </div>
+    </transition>
+  </div>
+</template>
+
+<script>
+import webapi from '@/webapi'
+
+export default {
+  name: 'ModalDialog',
+  props: ['show', 'title', 'tracks'],
+
+  computed: {
+    uris () {
+      return this.tracks.items.map(a => a.uri).join(',')
+    },
+    artist_count () {
+      return new Set(this.tracks.items.map(a => a.artist_id)).size
+    },
+    album_count () {
+      return new Set(this.tracks.items.map(a => a.album_id)).size
+    }
+  },
+
+  methods: {
+    play: function () {
+      this.$emit('close')
+      webapi.player_play_uri(this.uris, false)
+    },
+
+    queue_add: function () {
+      this.$emit('close')
+      webapi.queue_add(this.uris)
+    },
+
+    queue_add_next: function () {
+      this.$emit('close')
+      webapi.queue_add_next(this.uris)
+    }
+  }
+}
+</script>
+
+<style>
+</style>
diff --git a/web-src/src/pages/PageBrowse.vue b/web-src/src/pages/PageBrowse.vue
index 0c5bec18..72667f67 100644
--- a/web-src/src/pages/PageBrowse.vue
+++ b/web-src/src/pages/PageBrowse.vue
@@ -20,6 +20,23 @@
       </template>
     </content-with-heading>
 
+    <content-with-heading>
+      <template slot="heading-left">
+        <p class="title is-4">Recently added</p>
+        <p class="heading">tracks</p>
+      </template>
+      <template slot="content">
+        <list-tracks :tracks="recently_added_tracks.items"></list-tracks>
+      </template>
+      <template slot="footer">
+        <nav class="level">
+          <p class="level-item">
+            <a class="button is-light is-small is-rounded" v-on:click="open_browse('recently_added_tracks')">Show more</a>
+          </p>
+        </nav>
+      </template>
+    </content-with-heading>
+
     <!-- Recently played -->
     <content-with-heading>
       <template slot="heading-left">
@@ -52,13 +69,15 @@ const browseData = {
   load: function (to) {
     return Promise.all([
       webapi.search({ type: 'album', expression: 'time_added after 8 weeks ago and media_kind is music having track_count > 3 order by time_added desc', limit: 3 }),
-      webapi.search({ type: 'track', expression: 'time_played after 8 weeks ago and media_kind is music order by time_played desc', limit: 3 })
+      webapi.search({ type: 'track', expression: 'time_played after 8 weeks ago and media_kind is music order by time_played desc', limit: 3 }),
+      webapi.search({ type: 'track', expression: 'time_added after 8 weeks ago and media_kind is music order by time_added desc', limit: 3 })
     ])
   },
 
   set: function (vm, response) {
     vm.recently_added = response[0].data.albums
     vm.recently_played = response[1].data.tracks
+    vm.recently_added_tracks = response[2].data.tracks
   }
 }
 
@@ -71,6 +90,7 @@ export default {
     return {
       recently_added: { items: [] },
       recently_played: { items: [] },
+      recently_added_tracks: { items: [] },
 
       show_track_details_modal: false,
       selected_track: {}
diff --git a/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue b/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
new file mode 100644
index 00000000..c75aab5a
--- /dev/null
+++ b/web-src/src/pages/PageBrowseRecentlyAddedTracks.vue
@@ -0,0 +1,177 @@
+<template>
+  <div>
+    <tabs-music></tabs-music>
+
+    <content-with-heading>
+      <template slot="heading-left">
+        <p class="title is-4">Recently added</p>
+        <p class="heading">{{ recently_added }} tracks</p>
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_today && recently_added_today.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">Today</p>
+        <p class="heading">{{ recently_added_today.items.length }} tracks</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_today = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-tracks :tracks="recently_added_today.items"></list-tracks>
+        <modal-dialog-tracks :show="show_modal_today" title='Recently Added - Today' :tracks="recently_added_today" @close="show_modal_today = false" />
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_week && recently_added_week.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">This Week</p>
+        <p class="heading">{{ recently_added_week.items.length }} tracks</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_week = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-tracks :tracks="recently_added_week.items"></list-tracks>
+        <modal-dialog-tracks :show="show_modal_week" title='Recently Added - Past Week' :tracks="recently_added_week" @close="show_modal_week = false" />
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_month && recently_added_month.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">This Month </p>
+        <p class="heading">{{ recently_added_month.items.length }} tracks</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_month = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-tracks :tracks="recently_added_month.items"></list-tracks>
+        <modal-dialog-tracks :show="show_modal_month" title='Recently Added - Past Month' :tracks="recently_added_month" @close="show_modal_month = false" />
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_older && recently_added_older.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">Older</p>
+        <p class="heading">{{ recently_added_older.items.length }} tracks</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_older = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-tracks :tracks="recently_added_older.items"></list-tracks>
+        <modal-dialog-tracks :show="show_modal_older" title='Recently Added - Older than Month' :tracks="recently_added_older" @close="show_modal_older = false" />
+      </template>
+    </content-with-heading>
+  </div>
+</template>
+
+<script>
+import { LoadDataBeforeEnterMixin } from './mixin'
+import ContentWithHeading from '@/templates/ContentWithHeading'
+import TabsMusic from '@/components/TabsMusic'
+import ListTracks from '@/components/ListTracks'
+import ModalDialogTracks from '@/components/ModalDialogTracks'
+import webapi from '@/webapi'
+import store from '@/store'
+
+const browseData = {
+  load: function (to) {
+    const recentlyAddedLimit = store.getters.settings_option_recently_added_limit
+    return Promise.all([
+      webapi.search({
+        type: 'track',
+        expression: 'time_added after today and media_kind is music order by time_added desc',
+        limit: recentlyAddedLimit
+      }),
+      webapi.search({
+        type: 'track',
+        expression: 'time_added after this week and media_kind is music order by time_added desc',
+        limit: recentlyAddedLimit
+      }),
+      webapi.search({
+        type: 'track',
+        expression: 'time_added after last month and media_kind is music order by time_added desc',
+        limit: recentlyAddedLimit
+      })
+    ])
+  },
+
+  set: function (vm, response) {
+    vm.recently_added_today = response[0].data.tracks
+    vm.recently_added_week = response[1].data.tracks
+    vm.recently_added_month = response[2].data.tracks
+  }
+}
+
+export default {
+  name: 'PageBrowseType',
+  mixins: [LoadDataBeforeEnterMixin(browseData)],
+  components: { ContentWithHeading, TabsMusic, ListTracks, ModalDialogTracks },
+
+  data () {
+    return {
+      recently_added_today: { items: [] },
+      recently_added_week: { items: [] },
+      recently_added_month: { items: [] },
+      recently_added_older: { items: [] },
+
+      show_modal_today: false,
+      show_modal_week: false,
+      show_modal_month: false,
+      show_modal_older: false
+    }
+  },
+
+  mounted () {
+    const more = store.getters.settings_option_recently_added_limit - this.recently_added_month.items.length
+    if (more) {
+      webapi.search({
+        type: 'track',
+        expression: 'time_added before last month and media_kind is music order by time_added desc',
+        limit: more
+      }).then(({ data }) => {
+        this.recently_added_older = data.tracks
+      })
+    }
+  },
+
+  computed: {
+    show_recent_today () {
+      return this.recently_added_today.items.length > 0
+    },
+    show_recent_week () {
+      return this.recently_added_week.items.length > 0
+    },
+    show_recent_month () {
+      return this.recently_added_month.items.length > 0
+    },
+    show_recent_older () {
+      return this.recently_added_older.items.length > 0
+    },
+    recently_added () {
+      return this.recently_added_older.items.length + this.recently_added_month.items.length
+    }
+  }
+}
+</script>
+
+<style>
+</style>
diff --git a/web-src/src/router/index.js b/web-src/src/router/index.js
index a2e7aa42..6b67afd6 100644
--- a/web-src/src/router/index.js
+++ b/web-src/src/router/index.js
@@ -6,6 +6,7 @@ import PageQueue from '@/pages/PageQueue'
 import PageNowPlaying from '@/pages/PageNowPlaying'
 import PageBrowse from '@/pages/PageBrowse'
 import PageBrowseRecentlyAdded from '@/pages/PageBrowseRecentlyAdded'
+import PageBrowseRecentlyAddedTracks from '@/pages/PageBrowseRecentlyAddedTracks'
 import PageBrowseRecentlyPlayed from '@/pages/PageBrowseRecentlyPlayed'
 import PageArtists from '@/pages/PageArtists'
 import PageArtist from '@/pages/PageArtist'
@@ -79,6 +80,12 @@ export const router = new VueRouter({
       component: PageBrowseRecentlyAdded,
       meta: { show_progress: true, has_tabs: true }
     },
+    {
+      path: '/music/browse/recently_added_tracks',
+      name: 'Browse Recently Added Tracks',
+      component: PageBrowseRecentlyAddedTracks,
+      meta: { show_progress: true, has_tabs: true }
+    },
     {
       path: '/music/browse/recently_played',
       name: 'Browse Recently Played',

commit 1c8118ed266f31b9c887653deffcec534ce00628
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Tue Dec 1 11:20:36 2020 +0000

    [web-src] use smartpl to retrieve recently added albums

diff --git a/web-src/src/pages/PageBrowseRecentlyAdded.vue b/web-src/src/pages/PageBrowseRecentlyAdded.vue
index cdd990af..ca9ec77e 100644
--- a/web-src/src/pages/PageBrowseRecentlyAdded.vue
+++ b/web-src/src/pages/PageBrowseRecentlyAdded.vue
@@ -5,10 +5,79 @@
     <content-with-heading>
       <template slot="heading-left">
         <p class="title is-4">Recently added</p>
-        <p class="heading">albums</p>
+        <p class="heading">{{ recently_added }} albums</p>
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_today && recently_added_today.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">Today</p>
+        <p class="heading">{{ recently_added_today.items.length }} albums</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_today = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
       </template>
       <template slot="content">
-        <list-albums :albums="albums_list"></list-albums>
+        <list-albums :albums="recently_added_today.items"></list-albums>
+        <modal-dialog-albums :show="show_modal_today" title='Recently Added - Today' :albums="recently_added_today" @close="show_modal_today = false" />
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_week && recently_added_week.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">This Week</p>
+        <p class="heading">{{ recently_added_week.items.length }} albums</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_week = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-albums :albums="recently_added_week.items"></list-albums>
+        <modal-dialog-albums :show="show_modal_week" title='Recently Added - Past Week' :albums="recently_added_week" @close="show_modal_week = false" />
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_month && recently_added_month.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">This Month </p>
+        <p class="heading">{{ recently_added_month.items.length }} albums</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_month = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-albums :albums="recently_added_month.items"></list-albums>
+        <modal-dialog-albums :show="show_modal_month" title='Recently Added - Past Month' :albums="recently_added_month" @close="show_modal_month = false" />
+      </template>
+    </content-with-heading>
+
+    <content-with-heading v-if="show_recent_older && recently_added_older.items.length">
+      <template slot="heading-left">
+        <p class="title is-6">Older</p>
+        <p class="heading">{{ recently_added_older.items.length }} albums</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_modal_older = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-albums :albums="recently_added_older.items"></list-albums>
+        <modal-dialog-albums :show="show_modal_older" title='Recently Added - Older than Month' :albums="recently_added_older" @close="show_modal_older = false" />
       </template>
     </content-with-heading>
   </div>
@@ -19,45 +88,87 @@ import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import TabsMusic from '@/components/TabsMusic'
 import ListAlbums from '@/components/ListAlbums'
+import ModalDialogAlbums from '@/components/ModalDialogAlbums'
 import webapi from '@/webapi'
 import store from '@/store'
-import Albums from '@/lib/Albums'
 
 const browseData = {
   load: function (to) {
-    const limit = store.getters.settings_option_recently_added_limit
-    return webapi.search({
-      type: 'album',
-      expression: 'media_kind is music having track_count > 3 order by time_added desc',
-      limit: limit
-    })
+    const recentlyAddedLimit = store.getters.settings_option_recently_added_limit
+    return Promise.all([
+      webapi.search({
+        type: 'album',
+        expression: 'time_added after today and media_kind is music order by time_added desc',
+        limit: recentlyAddedLimit
+      }),
+      webapi.search({
+        type: 'album',
+        expression: 'time_added after this week and media_kind is music order by time_added desc',
+        limit: recentlyAddedLimit
+      }),
+      webapi.search({
+        type: 'album',
+        expression: 'time_added after last month and media_kind is music order by time_added desc',
+        limit: recentlyAddedLimit
+      })
+    ])
   },
 
   set: function (vm, response) {
-    vm.recently_added = response.data.albums
+    vm.recently_added_today = response[0].data.albums
+    vm.recently_added_week = response[1].data.albums
+    vm.recently_added_month = response[2].data.albums
   }
 }
 
 export default {
   name: 'PageBrowseType',
   mixins: [LoadDataBeforeEnterMixin(browseData)],
-  components: { ContentWithHeading, TabsMusic, ListAlbums },
+  components: { ContentWithHeading, TabsMusic, ListAlbums, ModalDialogAlbums },
 
   data () {
     return {
-      recently_added: { items: [] }
+      recently_added_today: { items: [] },
+      recently_added_week: { items: [] },
+      recently_added_month: { items: [] },
+      recently_added_older: { items: [] },
+
+      show_modal_today: false,
+      show_modal_week: false,
+      show_modal_month: false,
+      show_modal_older: false
     }
   },
 
-  computed: {
-    albums_list () {
-      return new Albums(this.recently_added.items, {
-        hideSingles: false,
-        hideSpotify: false,
-        sort: 'Recently added (browse)',
-        group: true
+  mounted () {
+    const more = store.getters.settings_option_recently_added_limit - this.recently_added_month.items.length
+    if (more) {
+      webapi.search({
+        type: 'album',
+        expression: 'time_added before last month and media_kind is music order by time_added desc',
+        limit: more
+      }).then(({ data }) => {
+        this.recently_added_older = data.albums
       })
     }
+  },
+
+  computed: {
+    show_recent_today () {
+      return this.recently_added_today.items.length > 0
+    },
+    show_recent_week () {
+      return this.recently_added_week.items.length > 0
+    },
+    show_recent_month () {
+      return this.recently_added_month.items.length > 0
+    },
+    show_recent_older () {
+      return this.recently_added_older.items.length > 0
+    },
+    recently_added () {
+      return this.recently_added_older.items.length + this.recently_added_month.items.length
+    }
   }
 }
 </script>

commit 49fe279cb05edb1da4edc1c083a999306076e630
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Aug 23 17:02:33 2020 +0100

    [web-src] consider play_count > 0 for top tracks

diff --git a/web-src/src/pages/PageTopTracks.vue b/web-src/src/pages/PageTopTracks.vue
index 647d2a2f..f9e2491f 100644
--- a/web-src/src/pages/PageTopTracks.vue
+++ b/web-src/src/pages/PageTopTracks.vue
@@ -43,7 +43,7 @@ import webapi from '@/webapi'
 
 const tracksData = {
   load: function (to) {
-    return webapi.search({ type: 'track', expression: (to.params.condition ? to.params.condition : 'media_kind is music') + ' order by play_count desc', limit: 10 })
+    return webapi.search({ type: 'track', expression: (to.params.condition ? to.params.condition : 'media_kind is music') + ' and play_count > 0 order by play_count desc', limit: 10 })
   },
 
   set: function (vm, response) {

commit c9369ea4fb687095db8b26b96156660136186647
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Jul 5 13:02:22 2020 +0100

    ray: [web-src] add back missing quality info on now playing

diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index 13b70bec..691e11ce 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -18,6 +18,9 @@
       </div>
       <div class="fd-has-padding-left-right">
         <div class="container has-text-centered">
+          <p class="subtitle has-text-grey is-7" v-show="now_playing.samplerate > 0">
+          {{ now_playing.type }} | {{ now_playing.samplerate }} Hz | {{ now_playing_channels }} | {{ now_playing.bitrate }} Kb/s
+          </p>
           <p class="control has-text-centered fd-progress-now-playing">
             <range-slider
               class="seek-slider fd-has-action"
@@ -121,6 +124,15 @@ export default {
       return this.$store.getters.now_playing
     },
 
+    now_playing_channels () {
+      if (this.now_playing.channels === 2) {
+        return 'stereo'
+      }
+      if (this.now_playing.channels === 1) {
+        return 'mono'
+      }
+      return this.now_playing.channels
+    },
     seeking: function () {
       return this.is_seeking
     },

commit 8dd0e40cfd8c5977dc84a3a6cc3faab22541f698
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Tue May 5 11:06:32 2020 +0100

    ray: [web-src] stop button greyed out when already stopped

diff --git a/web-src/src/components/PlayerButtonStop.vue b/web-src/src/components/PlayerButtonStop.vue
index 94140bac..6ff60c85 100644
--- a/web-src/src/components/PlayerButtonStop.vue
+++ b/web-src/src/components/PlayerButtonStop.vue
@@ -1,6 +1,6 @@
 <template>
   <a @click="play_stop" :disabled="disabled">
-    <span class="icon"><i class="mdi mdi-stop" :class="icon_style"></i></span>
+    <span class="icon"><i class="mdi mdi-stop" :class="icon_style1"></i></span>
   </a>
 </template>
 
@@ -17,6 +17,9 @@ export default {
   computed: {
     disabled () {
       return !this.$store.state.queue || this.$store.state.queue.count <= 0
+    },
+    icon_style1 () {
+      return this.icon_style + ' ' + (this.$store.state.player.state === 'stop' ? 'has-text-grey-light' : 'has-text-black')
     }
   },
 

commit d106c7ab965920876fb40c82f1f9163a6571d355
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Apr 30 11:41:35 2020 +0100

    [web-src] show skip buttons for music but hide for internet streams (length === 0)

diff --git a/web-src/src/components/PlayerButtonSeekBack.vue b/web-src/src/components/PlayerButtonSeekBack.vue
index eeb4213c..af675694 100644
--- a/web-src/src/components/PlayerButtonSeekBack.vue
+++ b/web-src/src/components/PlayerButtonSeekBack.vue
@@ -23,7 +23,7 @@ export default {
           this.now_playing.data_kind === 'pipe'
     },
     visible () {
-      return ['podcast', 'music', 'audiobook'].includes(this.now_playing.media_kind)
+      return ['podcast', 'music', 'audiobook'].includes(this.now_playing.media_kind) && this.$store.state.player.item_length_ms > 0
     }
   },
 
diff --git a/web-src/src/components/PlayerButtonSeekForward.vue b/web-src/src/components/PlayerButtonSeekForward.vue
index a0b86659..bb128f5b 100644
--- a/web-src/src/components/PlayerButtonSeekForward.vue
+++ b/web-src/src/components/PlayerButtonSeekForward.vue
@@ -23,7 +23,7 @@ export default {
           this.now_playing.data_kind === 'pipe'
     },
     visible () {
-      return ['podcast', 'music', 'audiobook'].includes(this.now_playing.media_kind)
+      return ['podcast', 'music', 'audiobook'].includes(this.now_playing.media_kind) && this.$store.state.player.item_length_ms > 0
     }
   },
 

commit e777bb7bbbcdfaec573083262fbbb0ce7e8533d6
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Apr 29 12:06:02 2020 +0100

    ray: [web] enable skip fwd/back for music

diff --git a/web-src/src/components/PlayerButtonSeekBack.vue b/web-src/src/components/PlayerButtonSeekBack.vue
index a280959f..eeb4213c 100644
--- a/web-src/src/components/PlayerButtonSeekBack.vue
+++ b/web-src/src/components/PlayerButtonSeekBack.vue
@@ -23,7 +23,7 @@ export default {
           this.now_playing.data_kind === 'pipe'
     },
     visible () {
-      return ['podcast', 'audiobook'].includes(this.now_playing.media_kind)
+      return ['podcast', 'music', 'audiobook'].includes(this.now_playing.media_kind)
     }
   },
 
diff --git a/web-src/src/components/PlayerButtonSeekForward.vue b/web-src/src/components/PlayerButtonSeekForward.vue
index 49e01c27..a0b86659 100644
--- a/web-src/src/components/PlayerButtonSeekForward.vue
+++ b/web-src/src/components/PlayerButtonSeekForward.vue
@@ -23,7 +23,7 @@ export default {
           this.now_playing.data_kind === 'pipe'
     },
     visible () {
-      return ['podcast', 'audiobook'].includes(this.now_playing.media_kind)
+      return ['podcast', 'music', 'audiobook'].includes(this.now_playing.media_kind)
     }
   },
 

commit 56b4e9e7f6916ac47f0f070eded93246710c4f86
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Apr 26 20:09:44 2020 +0100

    [web-src] star rating position

diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index 8331b21f..13b70bec 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -1,15 +1,15 @@
 <template>
   <section>
     <div v-if="now_playing.id > 0" class="fd-is-fullheight">
+      <div class="has-text-centered fd-has-padding-left-right"><star-rating v-model="rating"
+        :star-size="17"
+        :padding="3"
+        :show-rating="false"
+        :max-rating="5"
+        :increment="0.5"
+        :inline="true"
+        @rating-selected="rate_track"></star-rating> </div>
       <div class="fd-is-expanded">
-        <div class="has-text-centered fd-has-padding-left-right"><star-rating v-model="rating"
-          :star-size="17"
-          :padding="3"
-          :show-rating="false"
-          :max-rating="5"
-          :increment="0.5"
-          :inline="true"
-          @rating-selected="rate_track"></star-rating></div>
         <cover-artwork @click="open_dialog(now_playing)"
           :artwork_url="now_playing.artwork_url"
           :artist="now_playing.artist"

commit 7e959511761083a600156ba9552164a8d2d0f1d5
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Mon Aug 26 10:39:15 2019 +0100

    ray: [web-src] queue add/add next close on success only

diff --git a/web-src/src/components/ModalDialogTrack.vue b/web-src/src/components/ModalDialogTrack.vue
index 22f54d3d..203573cd 100644
--- a/web-src/src/components/ModalDialogTrack.vue
+++ b/web-src/src/components/ModalDialogTrack.vue
@@ -121,13 +121,15 @@ export default {
     },
 
     queue_add: function () {
-      this.$emit('close')
-      webapi.queue_add(this.track.uri)
+      webapi.queue_add(this.track.uri).then(() => {
+        this.$emit('close')
+      })
     },
 
     queue_add_next: function () {
-      this.$emit('close')
-      webapi.queue_add_next(this.track.uri)
+      webapi.queue_add_next(this.track.uri).then(() => {
+        this.$emit('close')
+      })
     },
 
     open_album: function () {

commit 9592411d900cb68995b850b3feede029cc100911
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Apr 12 22:34:06 2019 +0100

    ray: [web-src] db/db_genre_info --fixup

diff --git a/web-src/src/pages/PageGenre.vue b/web-src/src/pages/PageGenre.vue
index 64f95542..1b6b99b9 100644
--- a/web-src/src/pages/PageGenre.vue
+++ b/web-src/src/pages/PageGenre.vue
@@ -21,7 +21,8 @@
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | {{ genre_albums.total }} albums | <a class="has-text-link" @click="open_tracks">tracks</a> | <a class="has-text-link" @click="open_composers">composers</a> </p>
         <list-albums :albums="genre_albums.items"></list-albums>
-        <modal-dialog-genre :show="show_genre_details_modal" :genre="{ 'name': name }" @close="show_genre_details_modal = false" />
+        <modal-dialog-album :show="show_details_modal" :album="selected_album" @close="show_details_modal = false" />
+        <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
     </content-with-heading>
   </div>
@@ -32,6 +33,7 @@ import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import ListAlbums from '@/components/ListAlbums'
 import TabsMusic from '@/components/TabsMusic'
+import ModalDialogAlbum from '@/components/ModalDialogAlbum'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
 import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
@@ -54,19 +56,30 @@ const genreData = {
 export default {
   name: 'PageGenre',
   mixins: [LoadDataBeforeEnterMixin(genreData)],
-  components: { ContentWithHeading, ListAlbums, ModalDialogGenre, IndexList, TabsMusic },
+  components: { ContentWithHeading, ListAlbums, ModalDialogGenre, ModalDialogAlbum, IndexList, TabsMusic },
 
   data () {
     return {
       name: '',
-      tracks: 0,
       genre_albums: { items: [] },
-
+      tracks: 0,
+      show_details_modal: false,
+      selected_album: {},
       show_genre_details_modal: false
     }
   },
 
   computed: {
+    modal_obj () {
+      return {
+        name: this.name,
+        album_count: this.genre_albums.items.length,
+        artist_count: new Set(this.genre_albums.items.map(album => album.artist_id)).size,
+        track_count: this.tracks,
+        uri: this.genre_albums.items.map(a => a.uri).join(',')
+      }
+    },
+
     index_list () {
       return [...new Set(this.genre_albums.items
         .map(album => album.name_sort.charAt(0).toUpperCase()))]
diff --git a/web-src/src/pages/PageGenreArtists.vue b/web-src/src/pages/PageGenreArtists.vue
index 10ff3c58..58955227 100644
--- a/web-src/src/pages/PageGenreArtists.vue
+++ b/web-src/src/pages/PageGenreArtists.vue
@@ -28,7 +28,7 @@
           </template>
         </list-item-artist>
         <modal-dialog-artist :show="show_details_modal" :artist="selected_artist" @close="show_details_modal = false" />
-        <modal-dialog-genre :show="show_genre_details_modal" :genre="{ 'name': genre }" @close="show_genre_details_modal = false" />
+        <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
     </content-with-heading>
   </div>
@@ -73,6 +73,22 @@ export default {
   },
 
   computed: {
+    modal_obj () {
+      return {
+        name: this.genre,
+        album_count: this.artists.items.reduce((acc, item) => {
+          acc += item.album_count
+          return acc
+        }, 0),
+        artist_count: this.artists.items.length,
+        track_count: this.artists.items.reduce((acc, item) => {
+          acc += item.track_count
+          return acc
+        }, 0),
+        uri: this.artists.items.map(a => a.uri).join(',')
+      }
+    },
+
     index_list () {
       return [...new Set(this.artists.items
         .map(artist => artist.name_sort.charAt(0).toUpperCase()))]
diff --git a/web-src/src/pages/PageGenreTracks.vue b/web-src/src/pages/PageGenreTracks.vue
index f25042b5..92188ab9 100644
--- a/web-src/src/pages/PageGenreTracks.vue
+++ b/web-src/src/pages/PageGenreTracks.vue
@@ -29,7 +29,7 @@
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | <a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks | <a class="has-text-link" @click="open_composers">composers</a></p>
         <list-tracks :tracks="rated_tracks"></list-tracks>
         <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
-        <modal-dialog-genre :show="show_genre_details_modal" :genre="{ 'name': genre }" @close="show_genre_details_modal = false" />
+        <modal-dialog-genre :show="show_genre_details_modal" :genre="modal_obj" @close="show_genre_details_modal = false" />
       </template>
     </content-with-heading>
   </div>
@@ -77,6 +77,17 @@ export default {
   },
 
   computed: {
+    modal_obj () {
+      var tracks = this.min_rating === 0 ? this.tracks.items : this.tracks.items.filter(a => a.rating >= this.min_rating)
+      return {
+        name: this.genre,
+        album_count: new Set(tracks.map(track => track.album_id)).size,
+        artist_count: new Set(tracks.map(track => track.artist_id)).size,
+        track_count: tracks.length,
+        uri: tracks.map(a => a.uri).join(',')
+      }
+    },
+
     index_list () {
       return [...new Set(this.tracks.items
         .map(track => track.title_sort.charAt(0).toUpperCase()))]

commit 27f3f8dc31ab89c0e500fd54688ef4efaf781c75
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Tue Apr 9 19:41:47 2019 +0100

    [web-src] add notification for rating update

diff --git a/web-src/src/pages/PageComposerTracks.vue b/web-src/src/pages/PageComposerTracks.vue
index 60d57480..eeb79e67 100644
--- a/web-src/src/pages/PageComposerTracks.vue
+++ b/web-src/src/pages/PageComposerTracks.vue
@@ -26,7 +26,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks</p>
-        <list-item-track v-for="(track, index) in tracks.items" :key="track.id" :track="track" v-if="track.rating >= min_rating" @click="play_track(index)">
+        <list-item-track v-for="(track, index) in rated_tracks" :key="track.id" :track="track" @click="play_track(index)">
           <template slot="actions">
             <a @click="open_dialog(track)">
               <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
diff --git a/web-src/src/pages/PageGenreArtists.vue b/web-src/src/pages/PageGenreArtists.vue
index 756ed6a2..10ff3c58 100644
--- a/web-src/src/pages/PageGenreArtists.vue
+++ b/web-src/src/pages/PageGenreArtists.vue
@@ -57,7 +57,7 @@ const artistsData = {
 
 export default {
   name: 'PageGenreArtists',
-  mixins: [ LoadDataBeforeEnterMixin(artistsData) ],
+  mixins: [LoadDataBeforeEnterMixin(artistsData)],
   components: { ContentWithHeading, TabsMusic, ListItemArtist, IndexList, ModalDialogArtist, ModalDialogGenre },
 
   data () {
diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index a77ff5a5..8331b21f 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -166,7 +166,7 @@ export default {
       }
       this.rating = Math.ceil(rating)
       this.state.item_rating = this.rating * 20
-      webapi.library_track_update(this.now_playing.track_id, { rating: this.rating * 20 })
+      webapi.library_track_set_rating(this.now_playing.track_id, this.rating * 20)
     },
 
     open_dialog: function (item) {
diff --git a/web-src/src/pages/PageTopTracks.vue b/web-src/src/pages/PageTopTracks.vue
new file mode 100644
index 00000000..647d2a2f
--- /dev/null
+++ b/web-src/src/pages/PageTopTracks.vue
@@ -0,0 +1,89 @@
+<template>
+  <div>
+    <tabs-music></tabs-music>
+
+    <content-with-heading>
+      <template slot="heading-left">
+        <p class="title is-4">{{ id }}</p>
+        <p class="heading">Top Tracks (of {{ tracks.total }} tracks)</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_top_tracks_details_modal = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+          <a class="button is-small is-dark is-rounded" @click="play">
+            <span class="icon"><i class="mdi mdi-shuffle"></i></span> <span>Shuffle</span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <list-item-track v-for="(track, index) in tracks.items" :key="track.id" :track="track" @click="play_track(index)">
+          <template slot="actions">
+            <a @click="open_dialog(track)">
+              <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
+            </a>
+          </template>
+        </list-item-track>
+        <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
+        <modal-dialog-top-tracks :show="show_top_tracks_details_modal" :tracks="tracks" @close="show_top_tracks_details_modal = false" />
+      </template>
+    </content-with-heading>
+  </div>
+</template>
+
+<script>
+import { LoadDataBeforeEnterMixin } from './mixin'
+import ContentWithHeading from '@/templates/ContentWithHeading'
+import TabsMusic from '@/components/TabsMusic'
+import ListItemTrack from '@/components/ListItemTrack'
+import ModalDialogTrack from '@/components/ModalDialogTrack'
+import ModalDialogTopTracks from '@/components/ModalDialogTopTracks'
+import webapi from '@/webapi'
+
+const tracksData = {
+  load: function (to) {
+    return webapi.search({ type: 'track', expression: (to.params.condition ? to.params.condition : 'media_kind is music') + ' order by play_count desc', limit: 10 })
+  },
+
+  set: function (vm, response) {
+    vm.id = vm.$route.params.id
+    vm.tracks = response.data.tracks
+  }
+}
+
+export default {
+  name: 'PageTopTracks',
+  mixins: [LoadDataBeforeEnterMixin(tracksData)],
+  components: { ContentWithHeading, TabsMusic, ListItemTrack, ModalDialogTrack, ModalDialogTopTracks },
+
+  data () {
+    return {
+      tracks: { items: [] },
+      id: '',
+
+      show_top_tracks_details_modal: false,
+      show_details_modal: false,
+      selected_track: {}
+    }
+  },
+
+  methods: {
+    play: function () {
+      webapi.player_play_uri(this.tracks.items.map(a => a.uri).join(','), true)
+    },
+
+    play_track: function (position) {
+      webapi.player_play_uri(this.tracks.items.map(a => a.uri).join(','), false, position)
+    },
+
+    open_dialog: function (track) {
+      this.selected_track = track
+      this.show_details_modal = true
+    }
+  }
+}
+</script>
+
+<style>
+</style>
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index dff2bab2..3425f705 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -385,6 +385,13 @@ export default {
     return axios.put('./api/library/tracks/' + trackId, undefined, { params: attributes })
   },
 
+  library_track_set_rating (trackId, rating) {
+    return axios.put('/api/library/tracks/' + trackId, undefined, { params: { rating: rating } }).then((response) => {
+      store.dispatch('add_notification', { text: 'track rating updated', type: 'info', timeout: 1500 })
+      return Promise.resolve(response)
+    })
+  },
+
   library_files (directory = undefined) {
     const filesParams = { directory: directory }
     return axios.get('./api/library/files', {

commit 15be521871403668df1c8a25d72be6f0aa3a3c54
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Apr 7 11:58:18 2019 +0100

    ray: [web-src] star rating on compsoer tracks page --fixup

diff --git a/web-src/src/pages/PageComposerTracks.vue b/web-src/src/pages/PageComposerTracks.vue
index 58a7d72c..60d57480 100644
--- a/web-src/src/pages/PageComposerTracks.vue
+++ b/web-src/src/pages/PageComposerTracks.vue
@@ -10,7 +10,13 @@
       </template>
       <template slot="heading-right">
         <div class="buttons is-centered">
-         <a class="button is-small is-light is-rounded" @click="show_composer_details_modal = true">
+          <star-rating v-model="min_rating"
+            :star-size="17"
+            :show-rating="false"
+            :max-rating="5"
+            :increment="0.5"
+            @rating-selected="show_rating"></star-rating>
+          <a class="button is-small is-light is-rounded" @click="show_composer_details_modal = true">
             <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
           </a>
           <a class="button is-small is-dark is-rounded" @click="play">
@@ -20,7 +26,7 @@
       </template>
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks</p>
-        <list-item-track v-for="(track, index) in rated_tracks" :key="track.id" :track="track" @click="play_track(index)">
+        <list-item-track v-for="(track, index) in tracks.items" :key="track.id" :track="track" v-if="track.rating >= min_rating" @click="play_track(index)">
           <template slot="actions">
             <a @click="open_dialog(track)">
               <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
@@ -42,6 +48,7 @@ import IndexList from '@/components/IndexList'
 import ListItemTrack from '@/components/ListItemTrack'
 import ModalDialogTrack from '@/components/ModalDialogTrack'
 import ModalDialogComposer from '@/components/ModalDialogComposer'
+import StarRating from 'vue-star-rating'
 import webapi from '@/webapi'
 
 const tracksData = {
@@ -58,7 +65,7 @@ const tracksData = {
 export default {
   name: 'PageComposerTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, TabsMusic, ListItemTrack, IndexList, ModalDialogTrack, ModalDialogComposer },
+  components: { ContentWithHeading, TabsMusic, ListItemTrack, IndexList, ModalDialogTrack, ModalDialogComposer, StarRating },
 
   data () {
     return {

commit be4b7cb17cdaf2321f8a5cdf9a097dc74187cc47
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Mar 21 20:54:32 2019 +0000

    ray: [web-src] bugfix for open_composers

diff --git a/web-src/src/pages/PageGenreArtists.vue b/web-src/src/pages/PageGenreArtists.vue
index b5ff03a5..756ed6a2 100644
--- a/web-src/src/pages/PageGenreArtists.vue
+++ b/web-src/src/pages/PageGenreArtists.vue
@@ -87,7 +87,7 @@ export default {
 
     open_composers: function () {
       this.show_details_modal = false
-      this.$router.push({ name: 'Composers', params: { genre: this.name } })
+      this.$router.push({ name: 'Composers', params: { genre: this.genre } })
     },
 
     open_tracks: function () {

commit cefa263344555c0387850fa98681b9e0593b787a
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Mar 21 20:14:23 2019 +0000

    ray: [web-src] fixes on modalgenre

diff --git a/web-src/src/components/ModalDialogGenre.vue b/web-src/src/components/ModalDialogGenre.vue
index f52fe465..6aad2e91 100644
--- a/web-src/src/components/ModalDialogGenre.vue
+++ b/web-src/src/components/ModalDialogGenre.vue
@@ -7,19 +7,19 @@
           <div class="card">
             <div class="card-content">
               <p class="title is-4">
-                <a class="has-text-link" @click="open_genre">{{ genre.name }}</a>
+                <a class="has-text-link" @click="open_albums">{{ genre.name }}</a>
               </p>
               <p>
                 <span class="heading">Albums</span>
-                <span class="title is-6">{{ genre.album_count }}</span>
+                <a class="has-text-link is-6" @click="open_albums">{{ genre.album_count }}</a>
               </p>
               <p>
                 <span class="heading">Artists</span>
-                <span class="title is-6">{{ genre.artist_count }}</span>
+                <a class="has-text-link is-6" @click="open_artists">{{ genre.artist_count }}</a>
               </p>
               <p>
                 <span class="heading">Tracks</span>
-                <span class="title is-6">{{ genre.track_count }}</span>
+                <a class="has-text-link is-6" @click="open_tracks">{{ genre.track_count }}</a>
               </p>
             </div>
             <footer class="card-footer">
@@ -64,9 +64,19 @@ export default {
       webapi.queue_expression_add_next('genre is "' + this.genre.name + '" and media_kind is music')
     },
 
-    open_genre: function () {
+    open_albums: function () {
       this.$emit('close')
       this.$router.push({ name: 'Genre', params: { genre: this.genre.name } })
+    },
+
+    open_tracks: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'GenreTracks', params: { genre: this.genre.name } })
+    },
+
+    open_artists: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'GenreArtists', params: { genre: this.genre.name } })
     }
   }
 }

commit d2bade6edbd050a4ccf5539ae81c092b6127c2bd
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Mar 21 20:07:46 2019 +0000

    ray: [web-src] migrate composer to horizontal idx

diff --git a/web-src/src/pages/PageComposer.vue b/web-src/src/pages/PageComposer.vue
index 609fec61..3c8cdee9 100644
--- a/web-src/src/pages/PageComposer.vue
+++ b/web-src/src/pages/PageComposer.vue
@@ -1,5 +1,9 @@
 <template>
   <div>
+    <tabs-music></tabs-music>
+
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
       <template slot="heading-left">
         <p class="title is-4">{{ name }}</p>
@@ -33,6 +37,8 @@
 <script>
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
+import TabsMusic from '@/components/TabsMusic'
+import IndexList from '@/components/IndexList'
 import ListItemAlbums from '@/components/ListItemAlbum'
 import ModalDialogAlbum from '@/components/ModalDialogAlbum'
 import ModalDialogComposer from '@/components/ModalDialogComposer'
@@ -52,7 +58,7 @@ const composerData = {
 export default {
   name: 'PageComposer',
   mixins: [LoadDataBeforeEnterMixin(composerData)],
-  components: { ContentWithHeading, ListItemAlbums, ModalDialogAlbum, ModalDialogComposer },
+  components: { ContentWithHeading, TabsMusic, ListItemAlbums, IndexList, ModalDialogAlbum, ModalDialogComposer },
 
   data () {
     return {
diff --git a/web-src/src/pages/PageComposerTracks.vue b/web-src/src/pages/PageComposerTracks.vue
index 2eb022a9..58a7d72c 100644
--- a/web-src/src/pages/PageComposerTracks.vue
+++ b/web-src/src/pages/PageComposerTracks.vue
@@ -1,5 +1,9 @@
 <template>
   <div>
+    <tabs-music></tabs-music>
+
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
       <template slot="heading-left">
         <p class="title is-4">{{ composer }}</p>
@@ -33,6 +37,8 @@
 <script>
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
+import TabsMusic from '@/components/TabsMusic'
+import IndexList from '@/components/IndexList'
 import ListItemTrack from '@/components/ListItemTrack'
 import ModalDialogTrack from '@/components/ModalDialogTrack'
 import ModalDialogComposer from '@/components/ModalDialogComposer'
@@ -52,7 +58,7 @@ const tracksData = {
 export default {
   name: 'PageComposerTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListItemTrack, ModalDialogTrack, ModalDialogComposer },
+  components: { ContentWithHeading, TabsMusic, ListItemTrack, IndexList, ModalDialogTrack, ModalDialogComposer },
 
   data () {
     return {
diff --git a/web-src/src/pages/PageComposers.vue b/web-src/src/pages/PageComposers.vue
index 854d36e4..85c5b10d 100644
--- a/web-src/src/pages/PageComposers.vue
+++ b/web-src/src/pages/PageComposers.vue
@@ -2,10 +2,9 @@
   <div>
     <tabs-music></tabs-music>
 
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
-      <template slot="options">
-        <index-button-list :index="composers_list.indexList"></index-button-list>
-      </template>
       <template slot="heading-left">
         <p class="title is-4">{{ heading }}</p>
         <p class="heading">{{ composers.total }} composers</p>
@@ -21,7 +20,6 @@
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import TabsMusic from '@/components/TabsMusic'
-import IndexButtonList from '@/components/IndexButtonList'
 import ListComposers from '@/components/ListComposers'
 import webapi from '@/webapi'
 import Composers from '@/lib/Composers'
@@ -45,7 +43,7 @@ const composersData = {
 export default {
   name: 'PageComposers',
   mixins: [LoadDataBeforeEnterMixin(composersData)],
-  components: { ContentWithHeading, TabsMusic, IndexButtonList, ListComposers },
+  components: { ContentWithHeading, TabsMusic, ListComposers, IndexList },
 
   data () {
     return {

commit b826b8b1ba407657042ffd393b685b0315879483
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Mar 14 23:41:07 2019 +0000

    ray: [web-src] migrate genre artist to horizontal idx

diff --git a/web-src/src/pages/PageGenreArtists.vue b/web-src/src/pages/PageGenreArtists.vue
index 439289d6..b5ff03a5 100644
--- a/web-src/src/pages/PageGenreArtists.vue
+++ b/web-src/src/pages/PageGenreArtists.vue
@@ -1,9 +1,10 @@
 <template>
   <div>
+    <tabs-music></tabs-music>
+
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
-      <template slot="options">
-        <index-button-list :index="index_list"></index-button-list>
-      </template>
       <template slot="heading-left">
         <p class="title is-4">{{ genre }}</p>
       </template>
@@ -36,10 +37,11 @@
 <script>
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
-import IndexButtonList from '@/components/IndexButtonList'
+import TabsMusic from '@/components/TabsMusic'
 import ListItemArtist from '@/components/ListItemArtist'
 import ModalDialogArtist from '@/components/ModalDialogArtist'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 
 const artistsData = {
@@ -56,7 +58,7 @@ const artistsData = {
 export default {
   name: 'PageGenreArtists',
   mixins: [ LoadDataBeforeEnterMixin(artistsData) ],
-  components: { ContentWithHeading, ListItemArtist, IndexButtonList, ModalDialogArtist, ModalDialogGenre },
+  components: { ContentWithHeading, TabsMusic, ListItemArtist, IndexList, ModalDialogArtist, ModalDialogGenre },
 
   data () {
     return {

commit acb14bd31bebc2e44b07336afa901d86a3fb1ddc
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Mar 14 21:28:49 2019 +0000

    [web-src] artists by Genre page: now displays artists,albums,tracks

diff --git a/web-src/src/pages/PageGenreArtists.vue b/web-src/src/pages/PageGenreArtists.vue
new file mode 100644
index 00000000..439289d6
--- /dev/null
+++ b/web-src/src/pages/PageGenreArtists.vue
@@ -0,0 +1,117 @@
+<template>
+  <div>
+    <content-with-heading>
+      <template slot="options">
+        <index-button-list :index="index_list"></index-button-list>
+      </template>
+      <template slot="heading-left">
+        <p class="title is-4">{{ genre }}</p>
+      </template>
+      <template slot="heading-right">
+        <div class="buttons is-centered">
+          <a class="button is-small is-light is-rounded" @click="show_genre_details_modal = true">
+            <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
+          </a>
+          <a class="button is-small is-dark is-rounded" @click="play">
+            <span class="icon"><i class="mdi mdi-shuffle"></i></span> <span>Shuffle</span>
+          </a>
+        </div>
+      </template>
+      <template slot="content">
+        <p class="heading has-text-centered-mobile">{{ artists.total }} artists | <a class="has-text-link" @click="open_albums">albums</a> | <a class="has-text-link" @click="open_tracks">tracks</a> | <a class="has-text-link" @click="open_composers">composers</a></p>
+        <list-item-artist v-for="artist in artists.items" :key="artist.id" :artist="artist" @click="open_artist(artist)">
+          <template slot="actions">
+            <a @click="open_dialog(artist)">
+              <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
+            </a>
+          </template>
+        </list-item-artist>
+        <modal-dialog-artist :show="show_details_modal" :artist="selected_artist" @close="show_details_modal = false" />
+        <modal-dialog-genre :show="show_genre_details_modal" :genre="{ 'name': genre }" @close="show_genre_details_modal = false" />
+      </template>
+    </content-with-heading>
+  </div>
+</template>
+
+<script>
+import { LoadDataBeforeEnterMixin } from './mixin'
+import ContentWithHeading from '@/templates/ContentWithHeading'
+import IndexButtonList from '@/components/IndexButtonList'
+import ListItemArtist from '@/components/ListItemArtist'
+import ModalDialogArtist from '@/components/ModalDialogArtist'
+import ModalDialogGenre from '@/components/ModalDialogGenre'
+import webapi from '@/webapi'
+
+const artistsData = {
+  load: function (to) {
+    return webapi.library_genre_artists(to.params.genre)
+  },
+
+  set: function (vm, response) {
+    vm.genre = vm.$route.params.genre
+    vm.artists = response.data.artists
+  }
+}
+
+export default {
+  name: 'PageGenreArtists',
+  mixins: [ LoadDataBeforeEnterMixin(artistsData) ],
+  components: { ContentWithHeading, ListItemArtist, IndexButtonList, ModalDialogArtist, ModalDialogGenre },
+
+  data () {
+    return {
+      artists: { items: [] },
+      genre: '',
+
+      show_details_modal: false,
+      selected_artist: {},
+
+      show_genre_details_modal: false
+    }
+  },
+
+  computed: {
+    index_list () {
+      return [...new Set(this.artists.items
+        .map(artist => artist.name_sort.charAt(0).toUpperCase()))]
+    }
+  },
+
+  methods: {
+    open_albums: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'Genre', params: { genre: this.genre } })
+    },
+
+    open_composers: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'Composers', params: { genre: this.name } })
+    },
+
+    open_tracks: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'GenreTracks', params: { genre: this.genre } })
+    },
+
+    open_artist: function (artist) {
+      this.$router.push({ path: '/music/artists/' + artist.id })
+    },
+
+    play: function () {
+      webapi.player_play_expression('genre is "' + this.genre + '" and media_kind is music', true)
+    },
+
+    play_artist: function (position) {
+      webapi.player_play_expression('genre is "' + this.genre + '" and media_kind is music', false, position)
+    },
+
+    open_dialog: function (artist) {
+      this.selected_artist = artist
+      this.show_details_modal = true
+    }
+  }
+}
+</script>
+
+<style>
+</style>
diff --git a/web-src/src/router/index.js b/web-src/src/router/index.js
index 8eae2d44..a2e7aa42 100644
--- a/web-src/src/router/index.js
+++ b/web-src/src/router/index.js
@@ -13,6 +13,7 @@ import PageAlbums from '@/pages/PageAlbums'
 import PageAlbum from '@/pages/PageAlbum'
 import PageGenres from '@/pages/PageGenres'
 import PageGenre from '@/pages/PageGenre'
+import PageGenreArtists from '@/pages/PageGenreArtists'
 import PageGenreTracks from '@/pages/PageGenreTracks'
 import PageArtistTracks from '@/pages/PageArtistTracks'
 import PageComposers from '@/pages/PageComposers'
@@ -126,6 +127,12 @@ export const router = new VueRouter({
       component: PageGenre,
       meta: { show_progress: true, has_index: true }
     },
+    {
+      path: '/music/genres/:genre/artists',
+      name: 'GenreArtists',
+      component: PageGenreArtists,
+      meta: { show_progress: true, has_index: true }
+    },
     {
       path: '/music/genres/:genre/tracks',
       name: 'GenreTracks',
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index ddb68264..dff2bab2 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -242,8 +242,8 @@ export default {
     return axios.get('./api/library/genres')
   },
 
-  library_genre (genre) {
-    const genreParams = {
+  library_genre_albums (genre) {
+    var genreParams = {
       type: 'albums',
       media_kind: 'music',
       expression: 'genre is "' + genre + '"'
@@ -253,6 +253,17 @@ export default {
     })
   },
 
+  library_genre_artists (genre) {
+    var genreParams = {
+      type: 'artists',
+      media_kind: 'music',
+      expression: 'genre is "' + genre + '"'
+    }
+    return axios.get('/api/search', {
+      params: genreParams
+    })
+  },
+
   library_genre_tracks (genre) {
     const genreParams = {
       type: 'tracks',

commit be5575e2c8fe81af5d06a82becb12e4b80e22060
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Mon Mar 18 21:12:04 2019 +0000

    [web-src] display additional genre info

diff --git a/web-src/src/components/ModalDialogGenre.vue b/web-src/src/components/ModalDialogGenre.vue
index 531ad42f..f52fe465 100644
--- a/web-src/src/components/ModalDialogGenre.vue
+++ b/web-src/src/components/ModalDialogGenre.vue
@@ -9,6 +9,18 @@
               <p class="title is-4">
                 <a class="has-text-link" @click="open_genre">{{ genre.name }}</a>
               </p>
+              <p>
+                <span class="heading">Albums</span>
+                <span class="title is-6">{{ genre.album_count }}</span>
+              </p>
+              <p>
+                <span class="heading">Artists</span>
+                <span class="title is-6">{{ genre.artist_count }}</span>
+              </p>
+              <p>
+                <span class="heading">Tracks</span>
+                <span class="title is-6">{{ genre.track_count }}</span>
+              </p>
             </div>
             <footer class="card-footer">
               <a class="card-footer-item has-text-dark" @click="queue_add">

commit 01b5a146df14c7303d2d226a242b935272efe67b
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Mar 23 15:20:03 2019 +0000

    ray: [web-src] artist modal links to albums and tracks

diff --git a/web-src/src/components/ModalDialogArtist.vue b/web-src/src/components/ModalDialogArtist.vue
index 8103f780..f24acd41 100644
--- a/web-src/src/components/ModalDialogArtist.vue
+++ b/web-src/src/components/ModalDialogArtist.vue
@@ -12,7 +12,7 @@
               <div class="content is-small">
                 <p>
                   <span class="heading">Albums</span>
-                  <a class="title is-6 has-text-link" @click="open_albums">{{ artist.album_count }}</a>
+                  <a class="title is-6 has-text-link" @click="open_artist">{{ artist.album_count }}</a>
                 </p>
                 <p>
                   <span class="heading">Tracks</span>
@@ -75,11 +75,6 @@ export default {
       this.$router.push({ path: '/music/artists/' + this.artist.id })
     },
 
-    open_albums: function () {
-      this.$emit('close')
-      this.$router.push({ path: '/music/artists/' + this.artist.id + '/ablums' })
-    },
-
     open_tracks: function () {
       this.$emit('close')
       this.$router.push({ path: '/music/artists/' + this.artist.id + '/tracks' })

commit 8e9aa07fd82219053f6095bccb522aee67d5783b
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Dec 12 19:20:48 2018 +0000

    ray: [web-src] horizontal-scrollable index'd navigation

diff --git a/web-src/src/pages/PageGenre.vue b/web-src/src/pages/PageGenre.vue
index 211a891b..64f95542 100644
--- a/web-src/src/pages/PageGenre.vue
+++ b/web-src/src/pages/PageGenre.vue
@@ -19,7 +19,7 @@
         </div>
       </template>
       <template slot="content">
-        <p class="heading has-text-centered-mobile">{{ genre_albums.total }} albums | <a class="has-text-link" @click="open_tracks">{{ tracks }} tracks</a></p>
+        <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | {{ genre_albums.total }} albums | <a class="has-text-link" @click="open_tracks">tracks</a> | <a class="has-text-link" @click="open_composers">composers</a> </p>
         <list-albums :albums="genre_albums.items"></list-albums>
         <modal-dialog-genre :show="show_genre_details_modal" :genre="{ 'name': name }" @close="show_genre_details_modal = false" />
       </template>
@@ -38,7 +38,7 @@ import webapi from '@/webapi'
 
 const genreData = {
   load: function (to) {
-    return webapi.library_genre(to.params.genre)
+    return webapi.library_genre_albums(to.params.genre)
   },
 
   set: function (vm, response) {
@@ -79,6 +79,21 @@ export default {
       this.$router.push({ name: 'GenreTracks', params: { genre: this.name } })
     },
 
+    open_toptracks: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'TopGenreTracks', params: { condition: 'genre is "' + this.name + '" and media_kind is music', id: this.name } })
+    },
+
+    open_artists: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'GenreArtists', params: { genre: this.name } })
+    },
+
+    open_composers: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'Composers', params: { genre: this.name } })
+    },
+
     play: function () {
       webapi.player_play_expression('genre is "' + this.name + '" and media_kind is music', true)
     },

commit 8fd8c04a50fbf24465b2186ff64027d9fa8ff8cb
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Apr 7 12:16:02 2019 +0100

    [web-src] *tracks pages can filter based on ratings

diff --git a/web-src/src/pages/PageGenreTracks.vue b/web-src/src/pages/PageGenreTracks.vue
index cccc31c6..f25042b5 100644
--- a/web-src/src/pages/PageGenreTracks.vue
+++ b/web-src/src/pages/PageGenreTracks.vue
@@ -11,6 +11,12 @@
       </template>
       <template slot="heading-right">
         <div class="buttons is-centered">
+          <star-rating v-model="min_rating"
+            :star-size="17"
+            :show-rating="false"
+            :max-rating="5"
+            :increment="0.5"
+            @rating-selected="show_rating"></star-rating>
           <a class="button is-small is-light is-rounded" @click="show_genre_details_modal = true">
             <span class="icon"><i class="mdi mdi-dots-horizontal mdi-18px"></i></span>
           </a>
@@ -20,8 +26,9 @@
         </div>
       </template>
       <template slot="content">
-        <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_genre">albums</a> | {{ tracks.total }} tracks</p>
-        <list-tracks :tracks="tracks.items" :expression="expression"></list-tracks>
+        <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artists">artists</a> | <a class="has-text-link" @click="open_albums">albums</a> | {{ tracks.total }} tracks | <a class="has-text-link" @click="open_composers">composers</a></p>
+        <list-tracks :tracks="rated_tracks"></list-tracks>
+        <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-genre :show="show_genre_details_modal" :genre="{ 'name': genre }" @close="show_genre_details_modal = false" />
       </template>
     </content-with-heading>
@@ -33,8 +40,10 @@ import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import ListTracks from '@/components/ListTracks'
 import TabsMusic from '@/components/TabsMusic'
+import ModalDialogTrack from '@/components/ModalDialogTrack'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
 import IndexList from '@/components/IndexList'
+import StarRating from 'vue-star-rating'
 import webapi from '@/webapi'
 
 const tracksData = {
@@ -51,13 +60,18 @@ const tracksData = {
 export default {
   name: 'PageGenreTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListTracks, ModalDialogGenre, IndexList, TabsMusic },
+  components: { ContentWithHeading, ListTracks, ModalDialogGenre, ModalDialogTrack, IndexList, TabsMusic, StarRating },
 
   data () {
     return {
       tracks: { items: [] },
       genre: '',
 
+      min_rating: 0,
+
+      show_details_modal: false,
+      selected_track: {},
+
       show_genre_details_modal: false
     }
   },
@@ -70,17 +84,52 @@ export default {
 
     expression () {
       return 'genre is "' + this.genre + '" and media_kind is music'
+    },
+
+    rated_tracks () {
+      return this.tracks.items.filter(track => track.rating >= this.min_rating)
     }
   },
 
   methods: {
-    open_genre: function () {
+    open_albums: function () {
       this.show_details_modal = false
       this.$router.push({ name: 'Genre', params: { genre: this.genre } })
     },
 
+    open_toptracks: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'TopGenreTracks', params: { condition: 'genre is "' + this.genre + '" and media_kind is music', id: this.genre } })
+    },
+
+    open_composers: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'Composers', params: { genre: this.genre } })
+    },
+
+    open_artists: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'GenreArtists', params: { genre: this.genre } })
+    },
+
     play: function () {
       webapi.player_play_expression(this.expression, true)
+    },
+
+    play_track: function (position) {
+      webapi.player_play_expression(this.expression, false, position)
+    },
+
+    show_rating: function (rating) {
+      if (rating === 0.5) {
+        rating = 0
+      }
+      this.min_rating = Math.ceil(rating) * 20
+    },
+
+    open_dialog: function (track) {
+      this.selected_track = track
+      this.show_details_modal = true
     }
   }
 }

commit 4e68865d5fe58221c1fa8dceb613c67b6fe151a0
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Apr 6 22:11:29 2019 +0100

    [jsonapi,web-src] /api/player endpoint incl rating, sync now playing with new element

diff --git a/web-src/src/store/index.js b/web-src/src/store/index.js
index 250d2d83..9d04aca7 100644
--- a/web-src/src/store/index.js
+++ b/web-src/src/store/index.js
@@ -33,6 +33,7 @@ export default new Vuex.Store({
       shuffle: false,
       volume: 0,
       item_id: 0,
+      item_rating: 0,
       item_length_ms: 0,
       item_progress_ms: 0
     },

commit 7690cb864ff5b295392424e560369cb04b9a00fb
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Apr 6 15:24:34 2019 +0100

    [web-src] allow user selectable 'rating' to 'now playing'
    - vue-star-rating dependancy
    - 'now playing' page update

diff --git a/web-src/package-lock.json b/web-src/package-lock.json
index 95bf42a1..57b95ad9 100644
--- a/web-src/package-lock.json
+++ b/web-src/package-lock.json
@@ -32878,7 +32878,7 @@
       "dependencies": {
         "jsesc": {
           "version": "0.5.0",
-          "resolved": "https://registry.npmjs.org/jsesc/-/jsesc-0.5.0.tgz",
+          "resolved": "http://registry.npmjs.org/jsesc/-/jsesc-0.5.0.tgz",
           "integrity": "sha1-597mbjXW/Bb3EP6R1c9p9w8IkR0=",
           "dev": true
         }
@@ -35202,13 +35202,10 @@
         "bezier-easing": "2.1.0"
       }
     },
-    "vue-scrollto": {
-      "version": "2.15.0",
-      "resolved": "https://registry.npmjs.org/vue-scrollto/-/vue-scrollto-2.15.0.tgz",
-      "integrity": "sha512-FmJncIrXvsqvyVAN55Trc2CQWVDyxuMgdQQp1Q9I9bhoEi7XXpvXXQonhbFBktzNggJf1rpfHpVqa8KLhPeePQ==",
-      "requires": {
-        "bezier-easing": "2.1.0"
-      }
+    "vue-star-rating": {
+      "version": "1.6.1",
+      "resolved": "https://registry.npmjs.org/vue-star-rating/-/vue-star-rating-1.6.1.tgz",
+      "integrity": "sha512-JSmVx16rcxyw4Ma6YQ5DnIExyjF4IFf/ypxh3zfmtFZzE/hjswDT0fLn1vF4ERxDbAp0nHA3u51BYFbA8gyYyQ=="
     },
     "vue-style-loader": {
       "version": "4.1.3",
diff --git a/web-src/package.json b/web-src/package.json
index 7dd138c2..a175a764 100644
--- a/web-src/package.json
+++ b/web-src/package.json
@@ -32,6 +32,7 @@
     "vue-scrollto": "^2.20.0",
     "vue-tiny-lazyload-img": "^0.1.0",
     "vuedraggable": "^2.24.3",
+    "vue-star-rating": "^1.7.0",
     "vuex": "^3.6.2"
   },
   "devDependencies": {
diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index e8e3309f..aaa44325 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -97,11 +97,11 @@ export default {
   computed: {
     modal_obj () {
       return {
-        'id': this.id,
-        'name': this.name,
-        'album_count': this.albums.items.length,
-        'track_count': this.track_count,
-        'uri': this.albums.items.map(a => a.uri).join(',')
+        id: this.id,
+        name: this.name,
+        album_count: this.albums.items.length,
+        track_count: this.track_count,
+        uri: this.albums.items.map(a => a.uri).join(',')
       }
     },
 
diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index 02a756ed..a77ff5a5 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -2,6 +2,14 @@
   <section>
     <div v-if="now_playing.id > 0" class="fd-is-fullheight">
       <div class="fd-is-expanded">
+        <div class="has-text-centered fd-has-padding-left-right"><star-rating v-model="rating"
+          :star-size="17"
+          :padding="3"
+          :show-rating="false"
+          :max-rating="5"
+          :increment="0.5"
+          :inline="true"
+          @rating-selected="rate_track"></star-rating></div>
         <cover-artwork @click="open_dialog(now_playing)"
           :artwork_url="now_playing.artwork_url"
           :artist="now_playing.artist"
@@ -66,12 +74,13 @@
 import ModalDialogQueueItem from '@/components/ModalDialogQueueItem'
 import RangeSlider from 'vue-range-slider'
 import CoverArtwork from '@/components/CoverArtwork'
+import StarRating from 'vue-star-rating'
 import webapi from '@/webapi'
 import * as types from '@/store/mutation_types'
 
 export default {
   name: 'PageNowPlaying',
-  components: { ModalDialogQueueItem, RangeSlider, CoverArtwork },
+  components: { ModalDialogQueueItem, RangeSlider, CoverArtwork, StarRating },
 
   data () {
     return {
@@ -79,6 +88,8 @@ export default {
       item_progress_ms: 0,
       interval_id: 0,
 
+      rating: 0,
+
       show_details_modal: false,
       selected_item: {}
     }
@@ -149,6 +160,15 @@ export default {
       this.is_seeking = false
     },
 
+    rate_track: function (rating) {
+      if (rating === 0.5) {
+        rating = 0
+      }
+      this.rating = Math.ceil(rating)
+      this.state.item_rating = this.rating * 20
+      webapi.library_track_update(this.now_playing.track_id, { rating: this.rating * 20 })
+    },
+
     open_dialog: function (item) {
       this.selected_item = item
       this.show_details_modal = true
@@ -165,6 +185,14 @@ export default {
       if (this.state.state === 'play') {
         this.interval_id = window.setInterval(this.tick, 1000)
       }
+    },
+
+    'now_playing' () {
+      webapi.library_track(this.now_playing.track_id).then((response) => {
+        this.rating = response.data.rating / 20
+      }).catch(() => {
+        this.rating = 0
+      })
     }
   }
 }

commit 76d348ff50a5f4aa36ee63c462095b0b651150ed
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Apr 7 16:08:06 2019 +0100

    [jsonapi,web-src] name sync to previous json naming

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index 59b2b7c9..e8e3309f 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -30,7 +30,7 @@
       <p class="heading has-text-centered-mobile">{{ albums.total }} albums | <a class="has-text-link" @click="open_tracks">{{ track_count }} tracks</a></p>
       <list-albums :albums="albums_list"></list-albums>
       <modal-dialog-album :show="show_details_modal" :album="selected_album" @close="show_details_modal = false" />
-      <modal-dialog-artist :show="show_artist_details_modal" :artist="consolidated_artist" @close="show_artist_details_modal = false" />
+      <modal-dialog-artist :show="show_artist_details_modal" :artist="modal_obj" @close="show_artist_details_modal = false" />
     </template>
   </content-with-heading>
   </div>
@@ -95,6 +95,16 @@ export default {
   },
 
   computed: {
+    modal_obj () {
+      return {
+        'id': this.id,
+        'name': this.name,
+        'album_count': this.albums.items.length,
+        'track_count': this.track_count,
+        'uri': this.albums.items.map(a => a.uri).join(',')
+      }
+    },
+
     index_list () {
       return [...new Set(this.albums.items
         .map(album => album.name_sort.charAt(0).toUpperCase()))]
@@ -125,6 +135,11 @@ export default {
   },
 
   methods: {
+    open_toptracks: function () {
+      this.show_details_modal = false
+      this.$router.push({ name: 'TopArtistTracks', params: { condition: 'songartistid in "' + this.id + '" and media_kind is music', id: this.name } })
+    },
+
     open_tracks: function () {
       this.$router.push({ path: '/music/artists/' + this.id + '/tracks' })
     },
diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index efd60708..8870f6cb 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -78,6 +78,29 @@ export default {
   },
 
   computed: {
+    track_count () {
+      return this.tracks.items.length
+    },
+
+    album_count () {
+      return new Set(this.tracks.items.map(track => track.album_id)).size
+    },
+
+    rated_tracks () {
+      return this.tracks.items.filter(track => track.rating >= this.min_rating)
+    },
+
+    modal_artist_obj () {
+      var tracks = this.min_rating === 0 ? this.tracks.items : this.tracks.items.filter(a => a.rating >= this.min_rating)
+      return {
+        id: this.id,
+        name: this.name,
+        album_count: new Set(tracks.map(track => track.album_id)).size,
+        track_count: tracks.length,
+        uri: tracks.map(a => a.uri).join(',')
+      }
+    },
+
     index_list () {
       return [...new Set(this.tracks.items
         .map(track => track.title_sort.charAt(0).toUpperCase()))]

commit e5a4312aa57f1a94dbd959890ca601a9f88ebd71
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Feb 14 20:15:18 2019 +0000

    [db,jsonapi] support songtrackartistid in queue tbl

diff --git a/web-src/src/components/ModalDialogQueueItem.vue b/web-src/src/components/ModalDialogQueueItem.vue
index 6171bf15..ce4a8d5a 100644
--- a/web-src/src/components/ModalDialogQueueItem.vue
+++ b/web-src/src/components/ModalDialogQueueItem.vue
@@ -10,7 +10,8 @@
                 {{ item.title }}
               </p>
               <p class="subtitle">
-                {{ item.artist }}
+                <a v-if="item.track_artist_id" class="title is-6 has-text-link" @click="open_track_artist">{{ item.artist }}</a>
+                <span v-else class="subtitle">{{ item.artist }}</span>
               </p>
               <div class="content is-small">
                 <p>
@@ -125,6 +126,10 @@ export default {
       this.$router.push({ path: '/music/artists/' + this.item.album_artist_id })
     },
 
+    open_track_artist: function () {
+      this.$router.push({ path: '/music/artists/' + this.item.track_artist_id })
+    },
+
     open_genre: function () {
       this.$router.push({ name: 'Genre', params: { genre: this.item.genre } })
     },

commit 0c3dee70b075b0d5844a80170872529b249ff702
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Feb 27 20:21:54 2019 +0000

    [web-src] show media quality on 'now playing screen'

diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index d421cd10..02a756ed 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -16,7 +16,7 @@
               min="0"
               :max="state.item_length_ms"
               :value="item_progress_ms"
-              :disabled="state.state === 'stop'"
+              :disabled="state.state === 'stop' || seeking"
               step="1000"
               @change="seek" >
             </range-slider>
@@ -75,6 +75,7 @@ export default {
 
   data () {
     return {
+      is_seeking: false,
       item_progress_ms: 0,
       interval_id: 0,
 
@@ -109,6 +110,10 @@ export default {
       return this.$store.getters.now_playing
     },
 
+    seeking: function () {
+      return this.is_seeking
+    },
+
     settings_option_show_composer_now_playing () {
       return this.$store.getters.settings_option_show_composer_now_playing
     },
@@ -137,9 +142,11 @@ export default {
     },
 
     seek: function (newPosition) {
+      this.is_seeking = true
       webapi.player_seek_to_pos(newPosition).catch(() => {
         this.item_progress_ms = this.state.item_progress_ms
       })
+      this.is_seeking = false
     },
 
     open_dialog: function (item) {

commit 0ecfb013338142eb0064cf9ac6244218f605af5a
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Sep 6 17:12:41 2019 +0100

    [web-src] use alternative mp3 streaming port if supplied by server config

diff --git a/web-src/src/components/NavbarBottom.vue b/web-src/src/components/NavbarBottom.vue
index bd2c3e89..d4b8e054 100644
--- a/web-src/src/components/NavbarBottom.vue
+++ b/web-src/src/components/NavbarBottom.vue
@@ -175,7 +175,7 @@
               </div>
               <div class="level-item fd-expanded">
                 <div class="fd-expanded">
-                  <p class="heading" :class="{ 'has-text-grey-light': !playing }">HTTP stream <a href="stream.mp3"><span class="is-lowercase">(stream.mp3)</span></a></p>
+                  <p class="heading" :class="{ 'has-text-grey-light': !playing }">HTTP stream <a :href=stream_location><span class="is-lowercase">(stream.mp3)</span></a></p>
                   <range-slider
                     class="slider fd-has-action"
                     min="0"
@@ -280,6 +280,11 @@ export default {
       return this.$store.state.player
     },
 
+    stream_location () {
+      var port = (this.$store.state.config.stream_port === 0 || this.$store.state.config.stream_port === undefined) ? window.location.port : this.$store.state.config.stream_port
+      return window.location.protocol + '//' + window.location.hostname + ':' + port + '/stream.mp3'
+    },
+
     config () {
       return this.$store.state.config
     }
diff --git a/web-src/src/components/NavbarTop.vue b/web-src/src/components/NavbarTop.vue
index 6a573386..e0266d19 100644
--- a/web-src/src/components/NavbarTop.vue
+++ b/web-src/src/components/NavbarTop.vue
@@ -46,7 +46,6 @@
           </a>
 
           <div class="navbar-dropdown is-right">
-
             <navbar-item-link to="/playlists"><span class="icon"><i class="mdi mdi-library-music"></i></span> <b>Playlists</b></navbar-item-link>
             <navbar-item-link to="/music" exact><span class="icon"><i class="mdi mdi-music"></i></span> <b>Music</b></navbar-item-link>
             <navbar-item-link to="/music/artists"><span class="fd-navbar-item-level2">Artists</span></navbar-item-link>
diff --git a/web-src/src/store/index.js b/web-src/src/store/index.js
index b0a0b5a1..250d2d83 100644
--- a/web-src/src/store/index.js
+++ b/web-src/src/store/index.js
@@ -8,6 +8,7 @@ export default new Vuex.Store({
   state: {
     config: {
       websocket_port: 0,
+      stream_port: 0,
       version: '',
       buildoptions: []
     },

commit 354422ec2bc5be4ce0427cfe792902090880461b
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Mar 17 15:40:04 2019 +0000

    ray: [web-src] NowPlaying: add stop button to NavBarBottom
    
    ray: [web-src] add stop to NavBarBotttom

diff --git a/web-src/src/components/NavbarBottom.vue b/web-src/src/components/NavbarBottom.vue
index 3b88174f..bd2c3e89 100644
--- a/web-src/src/components/NavbarBottom.vue
+++ b/web-src/src/components/NavbarBottom.vue
@@ -20,6 +20,7 @@
       <!-- Skip previous (not visible on "now playing" page) -->
       <player-button-previous v-if="is_now_playing_page" class="navbar-item fd-margin-left-auto" icon_style="mdi-24px"></player-button-previous>
       <player-button-seek-back v-if="is_now_playing_page" seek_ms="10000" class="navbar-item" icon_style="mdi-24px"></player-button-seek-back>
+      <player-button-stop v-if="is_now_playing_page" class="navbar-item" icon_style="mdi-36px"></player-button-stop>
       <!-- Play/pause -->
       <player-button-play-pause class="navbar-item" icon_style="mdi-36px" show_disabled_message></player-button-play-pause>
       <player-button-seek-forward v-if="is_now_playing_page" seek_ms="30000" class="navbar-item" icon_style="mdi-24px"></player-button-seek-forward>
@@ -200,6 +201,7 @@ import _audio from '@/audio'
 import NavbarItemLink from './NavbarItemLink'
 import NavbarItemOutput from './NavbarItemOutput'
 import PlayerButtonPlayPause from '@/components/PlayerButtonPlayPause'
+import PlayerButtonStop from '@/components/PlayerButtonStop'
 import PlayerButtonNext from '@/components/PlayerButtonNext'
 import PlayerButtonPrevious from '@/components/PlayerButtonPrevious'
 import PlayerButtonShuffle from '@/components/PlayerButtonShuffle'
@@ -217,6 +219,7 @@ export default {
     NavbarItemOutput,
     RangeSlider,
     PlayerButtonPlayPause,
+    PlayerButtonStop,
     PlayerButtonNext,
     PlayerButtonPrevious,
     PlayerButtonShuffle,
diff --git a/web-src/src/components/PlayerButtonStop.vue b/web-src/src/components/PlayerButtonStop.vue
index 32aec63f..94140bac 100644
--- a/web-src/src/components/PlayerButtonStop.vue
+++ b/web-src/src/components/PlayerButtonStop.vue
@@ -1,6 +1,6 @@
 <template>
-  <a v-on:click="play_stop">
-    <span class="icon"><i class="mdi mdi-stop"></i></span>
+  <a @click="play_stop" :disabled="disabled">
+    <span class="icon"><i class="mdi mdi-stop" :class="icon_style"></i></span>
   </a>
 </template>
 
@@ -10,6 +10,16 @@ import webapi from '@/webapi'
 export default {
   name: 'PlayerButtonStop',
 
+  props: {
+    icon_style: String
+  },
+
+  computed: {
+    disabled () {
+      return !this.$store.state.queue || this.$store.state.queue.count <= 0
+    }
+  },
+
   methods: {
     play_stop: function () {
       webapi.player_stop()

commit 5dbba1fa8e2196ba99867c266951df846b7bde57
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Apr 7 16:08:06 2019 +0100

    [jsonapi,web-src] name sync to previous json naming

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index 95abee12..59b2b7c9 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -14,7 +14,7 @@
         </div>
       </template>
     <template slot="heading-left">
-      <p class="title is-4">{{ album_artist }}</p>
+      <p class="title is-4">{{ name }}</p>
     </template>
     <template slot="heading-right">
       <div class="buttons is-centered">

commit 4c64c06eff9bc7968c65741df5b50259a9bb8a49
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Mar 30 17:13:48 2019 +0000

    [web-src] handle multiple artists for artist modal

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index 4c974416..95abee12 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -30,7 +30,7 @@
       <p class="heading has-text-centered-mobile">{{ albums.total }} albums | <a class="has-text-link" @click="open_tracks">{{ track_count }} tracks</a></p>
       <list-albums :albums="albums_list"></list-albums>
       <modal-dialog-album :show="show_details_modal" :album="selected_album" @close="show_details_modal = false" />
-      <modal-dialog-artist :show="show_artist_details_modal" :artist="artist" @close="show_artist_details_modal = false" />
+      <modal-dialog-artist :show="show_artist_details_modal" :artist="consolidated_artist" @close="show_artist_details_modal = false" />
     </template>
   </content-with-heading>
   </div>
@@ -70,9 +70,6 @@ const artistData = {
       track_count: vm.track_count,
       uri: vm.albums.items.map(a => a.uri).join(',')
     }
-
-    vm.name = response[0].data.name
-    vm.id = response[0].data.id
   }
 }
 

commit b37171facbdd0bdf0fb354cb5021c77393eae8e4
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Jan 20 20:03:24 2019 +0000

    [web-src] sync with jsonapi for handling albums compilations

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index e2980484..4c974416 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -14,7 +14,7 @@
         </div>
       </template>
     <template slot="heading-left">
-      <p class="title is-4">{{ artist.name }}</p>
+      <p class="title is-4">{{ album_artist }}</p>
     </template>
     <template slot="heading-right">
       <div class="buttons is-centered">
@@ -27,8 +27,9 @@
       </div>
     </template>
     <template slot="content">
-      <p class="heading has-text-centered-mobile">{{ artist.album_count }} albums | <a class="has-text-link" @click="open_tracks">{{ track_count }} tracks</a></p>
+      <p class="heading has-text-centered-mobile">{{ albums.total }} albums | <a class="has-text-link" @click="open_tracks">{{ track_count }} tracks</a></p>
       <list-albums :albums="albums_list"></list-albums>
+      <modal-dialog-album :show="show_details_modal" :album="selected_album" @close="show_details_modal = false" />
       <modal-dialog-artist :show="show_artist_details_modal" :artist="artist" @close="show_artist_details_modal = false" />
     </template>
   </content-with-heading>
@@ -40,6 +41,7 @@ import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import ListAlbums from '@/components/ListAlbums'
 import TabsMusic from '@/components/TabsMusic'
+import ModalDialogAlbum from '@/components/ModalDialogAlbum'
 import ModalDialogArtist from '@/components/ModalDialogArtist'
 import DropdownMenu from '@/components/DropdownMenu'
 import IndexList from '@/components/IndexList'
@@ -68,13 +70,16 @@ const artistData = {
       track_count: vm.track_count,
       uri: vm.albums.items.map(a => a.uri).join(',')
     }
+
+    vm.name = response[0].data.name
+    vm.id = response[0].data.id
   }
 }
 
 export default {
   name: 'PageArtist',
   mixins: [LoadDataBeforeEnterMixin(artistData)],
-  components: { ContentWithHeading, ListAlbums, ModalDialogArtist, DropdownMenu, TabsMusic, IndexList },
+  components: { ContentWithHeading, ListAlbums, ModalDialogArtist, DropdownMenu, TabsMusic, IndexList, ModalDialogAlbum },
 
   data () {
     return {
@@ -84,6 +89,9 @@ export default {
       artist: [], // can be multiple entries if compilation album
       albums: { items: [] },
 
+      show_details_modal: false,
+      selected_album: {},
+
       sort_options: ['Name', 'Release date'],
       show_artist_details_modal: false
     }
diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index 587cf888..efd60708 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -24,6 +24,7 @@
       <template slot="content">
         <p class="heading has-text-centered-mobile"><a class="has-text-link" @click="open_artist">{{ artist.album_count }} albums</a> | {{ artist.track_count }} tracks</p>
         <list-tracks :tracks="tracks.items" :uris="track_uris"></list-tracks>
+        <modal-dialog-track :show="show_details_modal" :track="selected_track" @close="show_details_modal = false" />
         <modal-dialog-artist :show="show_artist_details_modal" :artist="artist" @close="show_artist_details_modal = false" />
       </template>
     </content-with-heading>
@@ -35,6 +36,7 @@ import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import IndexButtonList from '@/components/IndexButtonList'
 import ListTracks from '@/components/ListTracks'
+import ModalDialogTrack from '@/components/ModalDialogTrack'
 import ModalDialogArtist from '@/components/ModalDialogArtist'
 import TabsMusic from '@/components/TabsMusic'
 import IndexList from '@/components/IndexList'
@@ -59,7 +61,7 @@ const tracksData = {
 export default {
   name: 'PageArtistTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogArtist, IndexList, TabsMusic },
+  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogArtist, ModalDialogTrack, IndexList, TabsMusic },
 
   data () {
     return {
@@ -68,19 +70,14 @@ export default {
       artist: {},
       tracks: { items: [] },
 
+      show_details_modal: false,
+      selected_track: {},
+
       show_artist_details_modal: false
     }
   },
 
   computed: {
-    track_count () {
-      return this.tracks.items.length
-    },
-
-    album_count () {
-      return new Set(this.tracks.items.map(track => track.album_id)).size
-    },
-
     index_list () {
       return [...new Set(this.tracks.items
         .map(track => track.title_sort.charAt(0).toUpperCase()))]
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index 8cec8eba..ddb68264 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -311,6 +311,7 @@ export default {
         params: artistParams
       })
     }
+    // return axios.get('/api/library/artists/' + artist + '/tracks')
   },
 
   library_podcasts_new_episodes () {

commit ad052e94362ac09fc1f94f05b1f1d33cdb6659da
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Dec 12 19:20:48 2018 +0000

    ray: [web-src] horizontal-scrollable index'd navigation

diff --git a/web-src/src/pages/PageAlbums.vue b/web-src/src/pages/PageAlbums.vue
index d9739cce..2c329033 100644
--- a/web-src/src/pages/PageAlbums.vue
+++ b/web-src/src/pages/PageAlbums.vue
@@ -78,6 +78,7 @@ export default {
 
   data () {
     return {
+      index_list: [],
       tracks: 0,
       albums: { items: [] },
       sort_options: ['Name', 'Recently added', 'Recently released']
diff --git a/web-src/src/pages/PageArtists.vue b/web-src/src/pages/PageArtists.vue
index 44fa3d24..42c33430 100644
--- a/web-src/src/pages/PageArtists.vue
+++ b/web-src/src/pages/PageArtists.vue
@@ -85,6 +85,12 @@ export default {
   },
 
   computed: {
+    index_list () {
+      return [...new Set(this.artists.items
+        .filter(artist => !this.$store.state.hide_singles || artist.track_count > (artist.album_count * 2))
+        .map(artist => artist.name_sort.charAt(0).toUpperCase()))]
+    },
+
     artists_list () {
       return new Artists(this.artists.items, {
         hideSingles: this.hide_singles,

commit 62049c5a87c320911e7691faf773f53a00b58f93
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Oct 3 15:55:31 2021 +0100

    [web-src] watch notify change on podcasts_count to reload new episdoes after forcing update

diff --git a/web-src/src/pages/PagePodcasts.vue b/web-src/src/pages/PagePodcasts.vue
index 2ec5677f..9c1735df 100644
--- a/web-src/src/pages/PagePodcasts.vue
+++ b/web-src/src/pages/PagePodcasts.vue
@@ -116,6 +116,13 @@ export default {
   computed: {
     rss () {
       return this.$store.state.rss_count
+    },
+
+    podcasts_tracks () {
+      return this.$store.state.podcasts_count.tracks
+    },
+    podcasts () {
+      return this.$store.state.podcasts_count
     }
   },
 
@@ -148,15 +155,6 @@ export default {
 
     update_podcasts: function () {
       webapi.library_podcast_update()
-
-      setTimeout(function (obj) {
-        webapi.library_podcasts_new_episodes().then(({ data }) => {
-          obj.splice(0, obj.length)
-          data.tracks.items.forEach((e) => {
-            obj.push(e)
-          })
-        })
-      }, 5000, this.new_episodes.items)
     },
 
     reload_podcasts: function () {
@@ -170,6 +168,16 @@ export default {
       this.$store.commit(types.UPDATE_DIALOG_SCAN_KIND, 'rss')
       this.$store.commit(types.SHOW_UPDATE_DIALOG, true)
     }
+  },
+
+  watch: {
+    'podcasts' () {
+      this.reload_podcasts()
+    },
+
+    'podcasts_tracks' () {
+      this.reload_new_episodes()
+    }
   }
 }
 </script>

commit edc1de0faf4601175fce8934f6ece3175b908c08
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Jun 16 18:16:09 2021 +0100

    ray: rebase master 6583157596c3

diff --git a/web-src/src/components/IndexList.vue b/web-src/src/components/IndexList.vue
new file mode 100644
index 00000000..c07516c6
--- /dev/null
+++ b/web-src/src/components/IndexList.vue
@@ -0,0 +1,36 @@
+<template>
+  <section class="section fd-tabs-bottom-section">
+    <div class="container">
+      <div class="columns is-centered">
+        <div class="column is-four-fifths">
+          <div class="tabs is-centered is-small">
+            <ul>
+              <list-idx-nav v-for="idx in filtered_index" :key="idx" :name="idx" :anchor="idx"></list-idx-nav>
+            </ul>
+          </div>
+        </div>
+      </div>
+    </div>
+  </section>
+</template>
+
+<script>
+import ListIdxNav from '@/components/ListIdxNav'
+
+export default {
+  name: 'IndexList',
+  components: { ListIdxNav },
+
+  props: ['index'],
+
+  computed: {
+    filtered_index () {
+      const specialChars = '!"#$%&\'()*+,-./:;<=>?@[\\]^`{|}~'
+      return this.index.filter(c => !specialChars.includes(c))
+    }
+  }
+}
+</script>
+
+<style>
+</style>
diff --git a/web-src/src/idxnav/index.js b/web-src/src/idxnav/index.js
new file mode 100644
index 00000000..9b160764
--- /dev/null
+++ b/web-src/src/idxnav/index.js
@@ -0,0 +1,4 @@
+import Vue from 'vue'
+import VueScrollTo from 'vue-scrollto'
+
+Vue.use(VueScrollTo)
diff --git a/web-src/src/main.js b/web-src/src/main.js
index 470febea..3a18470f 100644
--- a/web-src/src/main.js
+++ b/web-src/src/main.js
@@ -6,6 +6,7 @@ import { router } from './router'
 import store from './store'
 import './filter'
 import './progress'
+import './idxnav'
 import vClickOutside from 'v-click-outside'
 import VueTinyLazyloadImg from 'vue-tiny-lazyload-img'
 import VueObserveVisibility from 'vue-observe-visibility'
diff --git a/web-src/src/mystyles.scss b/web-src/src/mystyles.scss
index 6fdf1048..665dd2e4 100644
--- a/web-src/src/mystyles.scss
+++ b/web-src/src/mystyles.scss
@@ -102,6 +102,16 @@ a.navbar-item {
   width: 100%;
 }
 
+.fd-tabs-bottom-section {
+  padding-bottom: 5px;
+  padding-top: 5px;
+  background: white;
+  bottom: 3.25rem;
+  z-index: 20;
+  position: fixed;
+  width: 100%;
+}
+
 section.fd-tabs-section + section.fd-content {
   margin-top: 24px;
 }
@@ -303,4 +313,4 @@ hr.fd-navbar-divider {
 
 .hero-body {
   padding: 1.5rem !important;
-}
\ No newline at end of file
+}
diff --git a/web-src/src/pages/PageAlbums.vue b/web-src/src/pages/PageAlbums.vue
index 05605bc9..d9739cce 100644
--- a/web-src/src/pages/PageAlbums.vue
+++ b/web-src/src/pages/PageAlbums.vue
@@ -52,6 +52,7 @@ import TabsMusic from '@/components/TabsMusic'
 import IndexButtonList from '@/components/IndexButtonList'
 import ListAlbums from '@/components/ListAlbums'
 import DropdownMenu from '@/components/DropdownMenu'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 import * as types from '@/store/mutation_types'
 import Albums from '@/lib/Albums'
@@ -73,7 +74,7 @@ const albumsData = {
 export default {
   name: 'PageAlbums',
   mixins: [LoadDataBeforeEnterMixin(albumsData)],
-  components: { ContentWithHeading, TabsMusic, IndexButtonList, ListAlbums, DropdownMenu },
+  components: { ContentWithHeading, TabsMusic, IndexList, IndexButtonList, ListAlbums, DropdownMenu },
 
   data () {
     return {
diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index d149a5d8..e2980484 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -1,4 +1,9 @@
 <template>
+  <div>
+    <tabs-music></tabs-music>
+
+    <index-list :index="index_list"></index-list>
+
   <content-with-heading>
       <template slot="options">
         <div class="columns">
@@ -9,7 +14,7 @@
         </div>
       </template>
     <template slot="heading-left">
-      <p class="title is-4">{{ name }}</p>
+      <p class="title is-4">{{ artist.name }}</p>
     </template>
     <template slot="heading-right">
       <div class="buttons is-centered">
@@ -27,14 +32,17 @@
       <modal-dialog-artist :show="show_artist_details_modal" :artist="artist" @close="show_artist_details_modal = false" />
     </template>
   </content-with-heading>
+  </div>
 </template>
 
 <script>
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import ListAlbums from '@/components/ListAlbums'
+import TabsMusic from '@/components/TabsMusic'
 import ModalDialogArtist from '@/components/ModalDialogArtist'
 import DropdownMenu from '@/components/DropdownMenu'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 import * as types from '@/store/mutation_types'
 import Albums from '@/lib/Albums'
@@ -54,11 +62,11 @@ const artistData = {
     vm.albums = response[1].data
 
     vm.consolidated_artist = {
-      'id': vm.id,
-      'name': vm.name,
-      'album_count': vm.albums.items.length,
-      'track_count': vm.track_count,
-      'uri': vm.albums.items.map(a => a.uri).join(',')
+      id: vm.id,
+      name: vm.name,
+      album_count: vm.albums.items.length,
+      track_count: vm.track_count,
+      uri: vm.albums.items.map(a => a.uri).join(',')
     }
   }
 }
@@ -66,7 +74,7 @@ const artistData = {
 export default {
   name: 'PageArtist',
   mixins: [LoadDataBeforeEnterMixin(artistData)],
-  components: { ContentWithHeading, ListAlbums, ModalDialogArtist, DropdownMenu },
+  components: { ContentWithHeading, ListAlbums, ModalDialogArtist, DropdownMenu, TabsMusic, IndexList },
 
   data () {
     return {
@@ -82,8 +90,12 @@ export default {
   },
 
   computed: {
+    index_list () {
+      return [...new Set(this.albums.items
+        .map(album => album.name_sort.charAt(0).toUpperCase()))]
+    },
+
     track_count () {
-      var n = 0
       return this.albums.items.reduce((acc, item) => {
         acc += item.track_count
         return acc
diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index 327a65a4..587cf888 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -1,5 +1,9 @@
 <template>
   <div>
+    <tabs-music></tabs-music>
+
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
       <template slot="options">
         <index-button-list :index="index_list"></index-button-list>
@@ -32,6 +36,8 @@ import ContentWithHeading from '@/templates/ContentWithHeading'
 import IndexButtonList from '@/components/IndexButtonList'
 import ListTracks from '@/components/ListTracks'
 import ModalDialogArtist from '@/components/ModalDialogArtist'
+import TabsMusic from '@/components/TabsMusic'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 
 const tracksData = {
@@ -53,7 +59,7 @@ const tracksData = {
 export default {
   name: 'PageArtistTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogArtist },
+  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogArtist, IndexList, TabsMusic },
 
   data () {
     return {
diff --git a/web-src/src/pages/PageArtists.vue b/web-src/src/pages/PageArtists.vue
index ee30e70e..44fa3d24 100644
--- a/web-src/src/pages/PageArtists.vue
+++ b/web-src/src/pages/PageArtists.vue
@@ -52,6 +52,7 @@ import TabsMusic from '@/components/TabsMusic'
 import IndexButtonList from '@/components/IndexButtonList'
 import ListArtists from '@/components/ListArtists'
 import DropdownMenu from '@/components/DropdownMenu'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 import * as types from '@/store/mutation_types'
 import Artists from '@/lib/Artists'
@@ -73,10 +74,11 @@ const artistsData = {
 export default {
   name: 'PageArtists',
   mixins: [LoadDataBeforeEnterMixin(artistsData)],
-  components: { ContentWithHeading, TabsMusic, IndexButtonList, ListArtists, DropdownMenu },
+  components: { ContentWithHeading, TabsMusic, IndexList, IndexButtonList, ListArtists, DropdownMenu },
 
   data () {
     return {
+      albums: 0,
       artists: { items: [] },
       sort_options: ['Name', 'Recently added']
     }
diff --git a/web-src/src/pages/PageGenre.vue b/web-src/src/pages/PageGenre.vue
index d5d21704..211a891b 100644
--- a/web-src/src/pages/PageGenre.vue
+++ b/web-src/src/pages/PageGenre.vue
@@ -1,9 +1,10 @@
 <template>
   <div>
+    <tabs-music></tabs-music>
+
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
-      <template slot="options">
-        <index-button-list :index="index_list"></index-button-list>
-      </template>
       <template slot="heading-left">
         <p class="title is-4">{{ name }}</p>
       </template>
@@ -18,7 +19,7 @@
         </div>
       </template>
       <template slot="content">
-        <p class="heading has-text-centered-mobile">{{ genre_albums.total }} albums | <a class="has-text-link" @click="open_tracks">tracks</a></p>
+        <p class="heading has-text-centered-mobile">{{ genre_albums.total }} albums | <a class="has-text-link" @click="open_tracks">{{ tracks }} tracks</a></p>
         <list-albums :albums="genre_albums.items"></list-albums>
         <modal-dialog-genre :show="show_genre_details_modal" :genre="{ 'name': name }" @close="show_genre_details_modal = false" />
       </template>
@@ -29,9 +30,10 @@
 <script>
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
-import IndexButtonList from '@/components/IndexButtonList'
 import ListAlbums from '@/components/ListAlbums'
+import TabsMusic from '@/components/TabsMusic'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 
 const genreData = {
@@ -52,11 +54,12 @@ const genreData = {
 export default {
   name: 'PageGenre',
   mixins: [LoadDataBeforeEnterMixin(genreData)],
-  components: { ContentWithHeading, IndexButtonList, ListAlbums, ModalDialogGenre },
+  components: { ContentWithHeading, ListAlbums, ModalDialogGenre, IndexList, TabsMusic },
 
   data () {
     return {
       name: '',
+      tracks: 0,
       genre_albums: { items: [] },
 
       show_genre_details_modal: false
@@ -66,7 +69,7 @@ export default {
   computed: {
     index_list () {
       return [...new Set(this.genre_albums.items
-        .map(album => album.name.charAt(0).toUpperCase()))]
+        .map(album => album.name_sort.charAt(0).toUpperCase()))]
     }
   },
 
diff --git a/web-src/src/pages/PageGenreTracks.vue b/web-src/src/pages/PageGenreTracks.vue
index c790cc6d..cccc31c6 100644
--- a/web-src/src/pages/PageGenreTracks.vue
+++ b/web-src/src/pages/PageGenreTracks.vue
@@ -1,11 +1,13 @@
 <template>
   <div>
+    <tabs-music></tabs-music>
+
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
-      <template slot="options">
-        <index-button-list :index="index_list"></index-button-list>
-      </template>
       <template slot="heading-left">
         <p class="title is-4">{{ genre }}</p>
+        <p class="heading">{{ tracks.total }} tracks</p>
       </template>
       <template slot="heading-right">
         <div class="buttons is-centered">
@@ -29,9 +31,10 @@
 <script>
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
-import IndexButtonList from '@/components/IndexButtonList'
 import ListTracks from '@/components/ListTracks'
+import TabsMusic from '@/components/TabsMusic'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 
 const tracksData = {
@@ -48,7 +51,7 @@ const tracksData = {
 export default {
   name: 'PageGenreTracks',
   mixins: [LoadDataBeforeEnterMixin(tracksData)],
-  components: { ContentWithHeading, ListTracks, IndexButtonList, ModalDialogGenre },
+  components: { ContentWithHeading, ListTracks, ModalDialogGenre, IndexList, TabsMusic },
 
   data () {
     return {
diff --git a/web-src/src/pages/PageGenres.vue b/web-src/src/pages/PageGenres.vue
index c02a2660..da4f6d69 100644
--- a/web-src/src/pages/PageGenres.vue
+++ b/web-src/src/pages/PageGenres.vue
@@ -2,10 +2,9 @@
   <div>
     <tabs-music></tabs-music>
 
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
-      <template slot="options">
-        <index-button-list :index="index_list"></index-button-list>
-      </template>
       <template slot="heading-left">
         <p class="title is-4">Genres</p>
         <p class="heading">{{ genres.total }} genres</p>
@@ -28,9 +27,9 @@
 import { LoadDataBeforeEnterMixin } from './mixin'
 import ContentWithHeading from '@/templates/ContentWithHeading'
 import TabsMusic from '@/components/TabsMusic'
-import IndexButtonList from '@/components/IndexButtonList'
 import ListItemGenre from '@/components/ListItemGenre'
 import ModalDialogGenre from '@/components/ModalDialogGenre'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 
 const genresData = {
@@ -46,7 +45,7 @@ const genresData = {
 export default {
   name: 'PageGenres',
   mixins: [LoadDataBeforeEnterMixin(genresData)],
-  components: { ContentWithHeading, TabsMusic, IndexButtonList, ListItemGenre, ModalDialogGenre },
+  components: { ContentWithHeading, TabsMusic, IndexList, ListItemGenre, ModalDialogGenre },
 
   data () {
     return {
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index 9d283639..8cec8eba 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -76,7 +76,7 @@ export default {
       position = store.getters.now_playing.position + 1
     }
     return axios.post('./api/queue/items/add?uris=' + uri + '&position=' + position).then((response) => {
-      store.dispatch('add_notification', { text: response.data.count + ' tracks appended to queue', type: 'info', timeout: 2000 })
+      store.dispatch('add_notification', { text: response.data.count + ' tracks added next to queue', type: 'info', timeout: 2000 })
       return Promise.resolve(response)
     })
   },

commit 41bdb9a097329282cca3c36f0c093e139e7094c4
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Tue Jan 12 11:22:20 2021 +0000

    ray: Revert "[web-src] Remove now unused ModalDialogAlbums"
    
    This reverts commit e168918b95adbaf0d4e442f055f9befb764d9a53.

diff --git a/web-src/src/components/ModalDialogAlbums.vue b/web-src/src/components/ModalDialogAlbums.vue
new file mode 100644
index 00000000..20d6083d
--- /dev/null
+++ b/web-src/src/components/ModalDialogAlbums.vue
@@ -0,0 +1,86 @@
+<template>
+  <div>
+    <transition name="fade">
+      <div class="modal is-active" v-if="show">
+        <div class="modal-background" @click="$emit('close')"></div>
+        <div class="modal-content fd-modal-card">
+          <div class="card">
+            <div class="card-content">
+              <p class="title is-4"> {{ title }}</p>
+              <div class="content is-small">
+                <p>
+                  <span class="heading">Albums</span>
+                  <span class="title is-6">{{ albums.total }}</span>
+                </p>
+                <p>
+                  <span class="heading">Artists</span>
+                  <span class="title is-6">{{ artist_count }}</span>
+                </p>
+                <p>
+                  <span class="heading">Tracks</span>
+                  <span class="title is-6">{{ track_count }}</span>
+                </p>
+              </div>
+            </div>
+            <footer class="card-footer">
+              <a class="card-footer-item has-text-dark" @click="queue_add">
+                <span class="icon"><i class="mdi mdi-playlist-plus"></i></span> <span class="is-size-7">Add</span>
+              </a>
+              <a class="card-footer-item has-text-dark" @click="queue_add_next">
+                <span class="icon"><i class="mdi mdi-playlist-play"></i></span> <span class="is-size-7">Add Next</span>
+              </a>
+              <a class="card-footer-item has-text-dark" @click="play">
+                <span class="icon"><i class="mdi mdi-play"></i></span> <span class="is-size-7">Play</span>
+              </a>
+            </footer>
+          </div>
+        </div>
+        <button class="modal-close is-large" aria-label="close" @click="$emit('close')"></button>
+      </div>
+    </transition>
+  </div>
+</template>
+
+<script>
+import webapi from '@/webapi'
+
+export default {
+  name: 'ModalDialog',
+  props: ['show', 'title', 'albums'],
+
+  computed: {
+    uris () {
+      return this.albums.items.map(a => a.uri).join(',')
+    },
+    artist_count () {
+      return new Set(this.albums.items.map(a => a.artist_id)).size
+    },
+    track_count () {
+      return this.albums.items.reduce((acc, item) => {
+        acc += item.track_count
+        return acc
+      }, 0)
+    }
+  },
+
+  methods: {
+    play: function () {
+      this.$emit('close')
+      webapi.player_play_uri(this.uris, false)
+    },
+
+    queue_add: function () {
+      this.$emit('close')
+      webapi.queue_add(this.uris)
+    },
+
+    queue_add_next: function () {
+      this.$emit('close')
+      webapi.queue_add_next(this.uris)
+    }
+  }
+}
+</script>
+
+<style>
+</style>

commit 5c5c52139d24a1977c8aefb43f9d98ec6290e9d8
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Nov 21 16:05:19 2020 +0000

    ray: [web-src] show RSS url on removal dialog

diff --git a/web-src/src/components/ListAlbums.vue b/web-src/src/components/ListAlbums.vue
index 6c7b1b00..49ded716 100644
--- a/web-src/src/components/ListAlbums.vue
+++ b/web-src/src/components/ListAlbums.vue
@@ -63,6 +63,7 @@
       <template slot="modal-content">
         <p>Permanently remove this podcast from your library?</p>
         <p class="is-size-7">(This will also remove the RSS playlist <b>{{ rss_playlist_to_remove.name }}</b>.)</p>
+        <p class="is-size-7 has-text-link">{{ rss_playlist_to_remove.path }}</p>
       </template>
     </modal-dialog>
   </div>
diff --git a/web-src/src/pages/PagePodcast.vue b/web-src/src/pages/PagePodcast.vue
index 74b66ccb..9958457d 100644
--- a/web-src/src/pages/PagePodcast.vue
+++ b/web-src/src/pages/PagePodcast.vue
@@ -59,6 +59,7 @@
         <template slot="modal-content">
           <p>Permanently remove this podcast from your library?</p>
           <p class="is-size-7">(This will also remove the RSS playlist <b>{{ rss_playlist_to_remove.name }}</b>.)</p>
+          <p class="is-size-7 has-text-link">{{ rss_playlist_to_remove.path }}</p>
         </template>
       </modal-dialog>
     </template>

commit 6482ee2fa58012d3568ce56a4209a4bc9f664308
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Nov 20 22:50:43 2020 +0000

    ray: [web-src] harden 'Remove Podcast' display logic for only when some tracks are data_kind=url

diff --git a/web-src/src/components/ModalDialogAlbum.vue b/web-src/src/components/ModalDialogAlbum.vue
index 9e974a36..c3179c36 100644
--- a/web-src/src/components/ModalDialogAlbum.vue
+++ b/web-src/src/components/ModalDialogAlbum.vue
@@ -16,7 +16,7 @@
               </p>
               <div class="buttons" v-if="media_kind_resolved === 'podcast'">
                 <a class="button is-small" @click="mark_played">Mark as played</a>
-                <a class="button is-small" @click="$emit('remove-podcast')">Remove podcast</a>
+                <a class="button is-small" v-if="show_remove_button" @click="$emit('remove-podcast')">Remove podcast</a>
               </div>
               <div class="content is-small">
                 <p v-if="album.artist">
@@ -75,7 +75,7 @@ import webapi from '@/webapi'
 export default {
   name: 'ModalDialogAlbum',
   components: { CoverArtwork },
-  props: ['show', 'album', 'media_kind', 'new_tracks'],
+  props: ['show', 'album', 'media_kind', 'request_remove_button', 'new_tracks'],
 
   data () {
     return {
@@ -88,6 +88,10 @@ export default {
       return webapi.artwork_url_append_size_params(this.album.artwork_url)
     },
 
+    show_remove_button: function () {
+      return this.request_remove_button === undefined || this.request_remove_button
+    },
+
     media_kind_resolved: function () {
       return this.media_kind ? this.media_kind : this.album.media_kind
     }
diff --git a/web-src/src/pages/PagePodcast.vue b/web-src/src/pages/PagePodcast.vue
index f932f9e8..74b66ccb 100644
--- a/web-src/src/pages/PagePodcast.vue
+++ b/web-src/src/pages/PagePodcast.vue
@@ -46,6 +46,7 @@
         :album="album"
         :media_kind="'podcast'"
         :new_tracks="new_tracks"
+        :request_remove_button="is_url_pl"
         @close="show_album_details_modal = false"
         @play-count-changed="reload_tracks"
         @remove-podcast="open_remove_podcast_dialog" />
@@ -111,6 +112,14 @@ export default {
   computed: {
     new_tracks () {
       return this.tracks.filter(track => track.play_count === 0).length
+    },
+
+    is_url_pl: function () {
+      var urltracks = this.tracks.reduce((acc, item) => {
+        acc += item.data_kind === 'url' ? 1 : 0
+        return acc
+      }, 0)
+      return urltracks > 0
     }
   },
 

commit bb09fbe2b9e8aa08191a078457a228d676155d49
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Sep 6 11:23:39 2020 +0100

    ray: [web-src] allow podcast update to force rss update - page will refresh 'new episodes' after 5secs but may not be accurate if still refreshing at the server side

diff --git a/web-src/src/pages/PagePodcasts.vue b/web-src/src/pages/PagePodcasts.vue
index ea782ded..2ec5677f 100644
--- a/web-src/src/pages/PagePodcasts.vue
+++ b/web-src/src/pages/PagePodcasts.vue
@@ -146,6 +146,19 @@ export default {
       })
     },
 
+    update_podcasts: function () {
+      webapi.library_podcast_update()
+
+      setTimeout(function (obj) {
+        webapi.library_podcasts_new_episodes().then(({ data }) => {
+          obj.splice(0, obj.length)
+          data.tracks.items.forEach((e) => {
+            obj.push(e)
+          })
+        })
+      }, 5000, this.new_episodes.items)
+    },
+
     reload_podcasts: function () {
       webapi.library_albums('podcast').then(({ data }) => {
         this.albums = data
diff --git a/web-src/src/webapi/index.js b/web-src/src/webapi/index.js
index 8401c30c..9d283639 100644
--- a/web-src/src/webapi/index.js
+++ b/web-src/src/webapi/index.js
@@ -333,6 +333,10 @@ export default {
     })
   },
 
+  library_podcast_update () {
+    return axios.put('/api/update/rss')
+  },
+
   library_add (url) {
     return axios.post('./api/library/add', undefined, { params: { url: url } })
   },

commit 5f6b3ba614e0d443232ff895f2bcf2c606865271
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Nov 1 16:32:01 2020 +0000

    ray: [websrc] custom settings page

diff --git a/web-src/src/components/TabsSettings.vue b/web-src/src/components/TabsSettings.vue
index 389ae68b..7e4e5a43 100644
--- a/web-src/src/components/TabsSettings.vue
+++ b/web-src/src/components/TabsSettings.vue
@@ -25,6 +25,11 @@
                   <span class="">Online Services</span>
                 </a>
               </router-link>
+              <router-link tag="li" to="/settings/custom" active-class="is-active">
+                <a>
+                  <span class="">Custom</span>
+                </a>
+              </router-link>
             </ul>
           </div>
         </div>
diff --git a/web-src/src/pages/SettingsPageCustom.vue b/web-src/src/pages/SettingsPageCustom.vue
new file mode 100644
index 00000000..77a4fa05
--- /dev/null
+++ b/web-src/src/pages/SettingsPageCustom.vue
@@ -0,0 +1,36 @@
+<template>
+  <div>
+    <tabs-settings></tabs-settings>
+
+    <content-with-heading>
+      <template slot="heading-left">
+        <div class="title is-4">Queue Adding</div>
+      </template>
+
+      <template slot="content">
+        <div class="content">
+          <p>
+            Tracks added to the queue can be duplicate of existing entries - we can request the server to 'replace' existing tracks with newly queued items so they are not repeated
+          </p>
+        </div>
+        <settings-checkbox category_name="custom" option_name="queue_add_replace_tracks">
+          <template slot="label"> Replace existing on add</template>
+        </settings-checkbox>
+      </template>
+    </content-with-heading>
+  </div>
+</template>
+
+<script>
+import ContentWithHeading from '@/templates/ContentWithHeading'
+import TabsSettings from '@/components/TabsSettings'
+import SettingsCheckbox from '@/components/SettingsCheckbox'
+
+export default {
+  name: 'SettingsPageCustom',
+  components: { ContentWithHeading, TabsSettings, SettingsCheckbox }
+}
+</script>
+
+<style>
+</style>
diff --git a/web-src/src/router/index.js b/web-src/src/router/index.js
index df2fe184..8eae2d44 100644
--- a/web-src/src/router/index.js
+++ b/web-src/src/router/index.js
@@ -41,6 +41,7 @@ import SettingsPageWebinterface from '@/pages/SettingsPageWebinterface'
 import SettingsPageArtwork from '@/pages/SettingsPageArtwork'
 import SettingsPageOnlineServices from '@/pages/SettingsPageOnlineServices'
 import SettingsPageRemotesOutputs from '@/pages/SettingsPageRemotesOutputs'
+import SettingsPageCustom from '@/pages/SettingsPageCustom'
 
 Vue.use(VueRouter)
 
@@ -267,6 +268,11 @@ export const router = new VueRouter({
       name: 'Spotify Search',
       component: SpotifyPageSearch
     },
+    {
+      path: '/settings/custom',
+      name: 'Settings Custom',
+      component: SettingsPageCustom
+    },
     {
       path: '/settings/webinterface',
       name: 'Settings Webinterface',

commit 7821cca40315d38288234b26bf4704ff33f18b91
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Oct 24 17:14:17 2020 +0100

    ray: [web-src] adjust for 0.8.1

diff --git a/web-src/src/components/ListIdxNav.vue b/web-src/src/components/ListIdxNav.vue
new file mode 100644
index 00000000..e01ae221
--- /dev/null
+++ b/web-src/src/components/ListIdxNav.vue
@@ -0,0 +1,16 @@
+<template>
+  <div>
+    <a href="#" v-scroll-to="{ el: '#index_' + anchor, offset: -100 }">{{ name }}</a>
+  </div>
+</template>
+
+<script>
+export default {
+  name: 'ListIdxNav',
+
+  props: ['name', 'anchor']
+}
+</script>
+
+<style>
+</style>

commit 1956d4652dcc51aa04396288e2abfaeb5fb60b61
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Oct 24 16:01:49 2020 +0100

    ray: [web-src] use lib generated objs for index_list

diff --git a/web-src/src/pages/PageAlbums.vue b/web-src/src/pages/PageAlbums.vue
index f47765dc..05605bc9 100644
--- a/web-src/src/pages/PageAlbums.vue
+++ b/web-src/src/pages/PageAlbums.vue
@@ -2,6 +2,8 @@
   <div>
     <tabs-music></tabs-music>
 
+    <index-list :index="albums_list.indexList"></index-list>
+
     <content-with-heading>
       <template slot="options">
         <index-button-list :index="albums_list.indexList"></index-button-list>
@@ -65,10 +67,6 @@ const albumsData = {
       acc += item.track_count
       return acc
     }, 0)
-
-    vm.index_list = [...new Set(vm.albums.items
-      .filter(album => !vm.$store.state.hide_singles || album.track_count > 2)
-      .map(album => album.name_sort.charAt(0).toUpperCase()))]
   }
 }
 
@@ -79,6 +77,7 @@ export default {
 
   data () {
     return {
+      tracks: 0,
       albums: { items: [] },
       sort_options: ['Name', 'Recently added', 'Recently released']
     }
diff --git a/web-src/src/pages/PageArtists.vue b/web-src/src/pages/PageArtists.vue
index 9a98d13d..ee30e70e 100644
--- a/web-src/src/pages/PageArtists.vue
+++ b/web-src/src/pages/PageArtists.vue
@@ -2,6 +2,8 @@
   <div>
     <tabs-music></tabs-music>
 
+    <index-list :index="artists_list.indexList"></index-list>
+
     <content-with-heading>
       <template slot="options">
         <index-button-list :index="artists_list.indexList"></index-button-list>

commit 85aae6ae3959b7b654c06fa244da65e951909ca6
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Oct 24 12:52:13 2020 +0100

    ray: [web-src] IndexButtonList does not display buttons, using my IndexList

diff --git a/web-src/src/components/IndexButtonList.vue b/web-src/src/components/IndexButtonList.vue
index ea37e508..f15bf6b1 100644
--- a/web-src/src/components/IndexButtonList.vue
+++ b/web-src/src/components/IndexButtonList.vue
@@ -1,8 +1,5 @@
 <template>
   <section>
-    <nav class="buttons is-centered fd-is-square" style="margin-bottom: 16px;">
-      <a v-for="char in filtered_index" :key="char" class="button is-small" @click="nav(char)">{{ char }}</a>
-    </nav>
   </section>
 </template>
 

commit fa9bcf485c0e11f4504a0b198c295629f7830e0a
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Sep 5 16:05:19 2020 +0100

    ray: [web-src] queue has 'play next'

diff --git a/web-src/src/components/ModalDialogQueueItem.vue b/web-src/src/components/ModalDialogQueueItem.vue
index 0f29b0b7..6171bf15 100644
--- a/web-src/src/components/ModalDialogQueueItem.vue
+++ b/web-src/src/components/ModalDialogQueueItem.vue
@@ -66,6 +66,9 @@
               <a class="card-footer-item has-text-dark" @click="remove">
                 <span class="icon"><i class="mdi mdi-delete"></i></span> <span class="is-size-7">Remove</span>
               </a>
+              <a class="card-footer-item has-text-dark" @click="play_next">
+                <span class="icon"><i class="mdi mdi-playlist-play"></i></span> <span class="is-size-7">Play Next</span>
+              </a>
               <a class="card-footer-item has-text-dark" @click="play">
                 <span class="icon"><i class="mdi mdi-play"></i></span> <span class="is-size-7">Play</span>
               </a>
@@ -98,6 +101,11 @@ export default {
       webapi.queue_remove(this.item.id)
     },
 
+    play_next: function () {
+      this.$emit('close')
+      webapi.queue_add_next(this.item.uri)
+    },
+
     play: function () {
       this.$emit('close')
       webapi.player_play({ item_id: this.item.id })

commit 98d8cdbeb12efc3f55369cfb317da21189cb9cba
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat May 16 19:01:50 2020 +0100

    ray: [web-src] custom browsers compat

diff --git a/web-src/.browserslistrc b/web-src/.browserslistrc
index 4aca366c..d3d13906 100644
--- a/web-src/.browserslistrc
+++ b/web-src/.browserslistrc
@@ -1,4 +1,5 @@
-> 0.25%
-not ie <= 8
-not dead
-not op_mini all
+# 'npx browserslist' to veify
+last 1 chrome version,
+last 2 ff version,
+last 1 and_ff version,
+ios > 9

commit 948b6544258146e07072ddefede9892fb51c2b89
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Aug 31 09:40:45 2019 +0100

    ray: [web-src] shift composer placement on now playing

diff --git a/web-src/src/pages/PageNowPlaying.vue b/web-src/src/pages/PageNowPlaying.vue
index 4f3f921c..d421cd10 100644
--- a/web-src/src/pages/PageNowPlaying.vue
+++ b/web-src/src/pages/PageNowPlaying.vue
@@ -30,6 +30,9 @@
         <div class="container has-text-centered fd-has-margin-top">
           <h1 class="title is-5">
             {{ now_playing.title }}
+            <h2 class="subtitle is-7 has-text-grey" v-if="composer">
+              {{ composer }}
+            </h2>
           </h1>
           <h2 class="title is-6">
             {{ now_playing.artist }}

commit f3f3af7cb009ad16fecf4ef60edd2fb72bcb353e
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Aug 21 18:39:44 2019 +0100

    ray: [web-src] nav jump to now playing track in q

diff --git a/web-src/src/components/ListItemQueueItem.vue b/web-src/src/components/ListItemQueueItem.vue
index 22b59b92..bbc409f1 100644
--- a/web-src/src/components/ListItemQueueItem.vue
+++ b/web-src/src/components/ListItemQueueItem.vue
@@ -1,5 +1,5 @@
 <template>
-  <div class="media" v-if="is_next || !show_only_next_items">
+  <div class="media" v-if="is_next || !show_only_next_items" :id="'index_' + item.id">
     <div class="media-left" v-if="edit_mode">
       <span class="icon has-text-grey fd-is-movable handle"><i class="mdi mdi-drag-horizontal mdi-18px"></i></span>
     </div>
diff --git a/web-src/src/pages/PageQueue.vue b/web-src/src/pages/PageQueue.vue
index 19dcd966..7a33289a 100644
--- a/web-src/src/pages/PageQueue.vue
+++ b/web-src/src/pages/PageQueue.vue
@@ -6,6 +6,7 @@
     <template slot="heading-left">
       <p class="title is-4">Queue</p>
       <p class="heading">{{ queue.count }} tracks | {{ queue_duration }} Playtime</p>
+      <a class="subtitle has-text-link is-7" v-show="queue_items.length > 0 && now_playing.id !== undefined" href='#' v-scroll-to="{ el: '#index_' + now_playing.id, offset: -165 }">Now Playing</a>
     </template>
     <template slot="heading-right">
       <div class="buttons is-centered">
@@ -130,6 +131,9 @@ export default {
         this.$store.commit(types.UPDATE_QUEUE, this.$store.state.queue)
       }
     },
+    now_playing () {
+      return this.$store.getters.now_playing
+    },
     current_position () {
       const nowPlaying = this.$store.getters.now_playing
       return nowPlaying === undefined || nowPlaying.position === undefined ? -1 : this.$store.getters.now_playing.position

commit 7fcbac23fe75e0e7d2b9d1ad35efc4ec2183bd92
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Aug 21 09:40:25 2019 +0100

    ray: [web-src] PageFile idx fix for / dirs

diff --git a/web-src/src/pages/PageFiles.vue b/web-src/src/pages/PageFiles.vue
index f418c35c..41d781ca 100644
--- a/web-src/src/pages/PageFiles.vue
+++ b/web-src/src/pages/PageFiles.vue
@@ -227,7 +227,7 @@ export default {
     },
 
     basename: function (path) {
-      return path.slice(this.current_directory.length + 1, path.length)
+      return path.slice(this.current_directory === '/' ? path.lastIndexOf('/') + 1 : this.current_directory.length + 1, path.length)
     },
 
     play: function () {

commit c8c2f31be066d63a833a47989805d7dbb590902d
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Mon Aug 19 13:35:03 2019 +0100

    ray: [web-src] calc/display total play duration for queue

diff --git a/web-src/src/pages/PageQueue.vue b/web-src/src/pages/PageQueue.vue
index fd88aafc..19dcd966 100644
--- a/web-src/src/pages/PageQueue.vue
+++ b/web-src/src/pages/PageQueue.vue
@@ -4,8 +4,8 @@
 
   <content-with-heading>
     <template slot="heading-left">
-      <p class="heading">{{ queue.count }} tracks</p>
       <p class="title is-4">Queue</p>
+      <p class="heading">{{ queue.count }} tracks | {{ queue_duration }} Playtime</p>
     </template>
     <template slot="heading-right">
       <div class="buttons is-centered">
@@ -107,6 +107,18 @@ export default {
     is_queue_save_allowed () {
       return this.$store.state.config.allow_modifying_stored_playlists && this.$store.state.config.default_playlist_directory
     },
+    queue_duration () {
+      var seconds = this.queue.items.reduce((acc, item) => {
+        acc += item.length_ms
+        return acc
+      }, 0) / 1000
+
+      var h = Math.floor(seconds / 3600)
+      var m = Math.floor(seconds % 3600 / 60)
+      var s = Math.floor(seconds % 3600 % 60)
+
+      return [h > 0 ? h + ':' : ''] + ('0' + m).slice(-2) + ':' + ('0' + s).slice(-2)
+    },
     queue () {
       return this.$store.state.queue
     },

commit 40240373b76587a03c78d8fc86b71a116c4ba67f
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Fri Aug 16 18:21:59 2019 +0100

    ray: [web-src] force rerender using v-if to regen id: nav anchors and add Directory anchros

diff --git a/web-src/src/components/ListItemDirectory.vue b/web-src/src/components/ListItemDirectory.vue
index c1a4f0ee..a71749a3 100644
--- a/web-src/src/components/ListItemDirectory.vue
+++ b/web-src/src/components/ListItemDirectory.vue
@@ -1,5 +1,5 @@
 <template functional>
-  <div class="media">
+   <div class="media" :id="'index_' + (props.alt_index_id === undefined ? props.directory.path : props.alt_index_id).charAt(0).toUpperCase()" :class="{ 'with-progress': slots().progress }">
     <figure class="media-left fd-has-action" @click="listeners.click">
       <span class="icon">
         <i class="mdi mdi-folder"></i>
@@ -18,7 +18,7 @@
 <script>
 export default {
   name: 'ListItemDirectory',
-  props: ['directory']
+  props: ['directory', 'alt_index_id']
 }
 </script>
 
diff --git a/web-src/src/pages/PageFiles.vue b/web-src/src/pages/PageFiles.vue
index c78a3f0d..f418c35c 100644
--- a/web-src/src/pages/PageFiles.vue
+++ b/web-src/src/pages/PageFiles.vue
@@ -63,8 +63,8 @@
           </div>
         </div>
 
-        <div v-show="view === 'dir_view'">
-        <list-item-directory v-for="directory in files.directories" :key="directory.path" :directory="directory" @click="open_directory(directory)">
+        <div v-if="view === 'dir_view'">
+        <list-item-directory v-for="directory in files.directories" :key="directory.path" :directory="directory" :alt_index_id="basename(directory.path)" @click="open_directory(directory)">
         <template slot="actions">
           <a @click="open_directory_dialog(directory)">
             <span class="icon has-text-dark"><i class="mdi mdi-dots-vertical mdi-18px"></i></span>
@@ -73,7 +73,7 @@
         </list-item-directory>
         </div>
 
-        <div v-show="view === 'pls_view'">
+        <div v-if="view === 'pls_view'">
         <list-item-playlist v-for="playlist in files.playlists.items" :key="playlist.id" :playlist="playlist" @click="open_playlist(playlist)">
           <template slot="icon">
             <span class="icon">
@@ -88,7 +88,7 @@
         </list-item-playlist>
         </div>
 
-        <div v-show="view === 'file_view'">
+        <div v-if="view === 'file_view'">
         <list-item-track v-for="(track, index) in files.tracks.items" :key="track.id" :track="track" :alt_index_id="basename(track.path)" @click="play_track(index)">
           <template slot="icon">
             <span class="icon">
@@ -188,12 +188,13 @@ export default {
 
       if (this.view === 'file_view') {
         items = this.files.tracks.items
+      } else if (this.view === 'dir_view') {
+        items = this.files.directories
       }
 
       if (items.length === 0) {
         return [...new Set()]
       }
-
       return [...new Set(items
         .map(dirent => this.basename(dirent.path).charAt(0).toUpperCase()))]
     }

commit 350a4cab1f575084a2857543f41505fb1885b23c
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun May 19 13:53:51 2019 +0100

    ray: [web-src] add TabsMusic to PageQueue

diff --git a/web-src/package-lock.json b/web-src/package-lock.json
index f99ce442..95bf42a1 100644
--- a/web-src/package-lock.json
+++ b/web-src/package-lock.json
@@ -35202,6 +35202,14 @@
         "bezier-easing": "2.1.0"
       }
     },
+    "vue-scrollto": {
+      "version": "2.15.0",
+      "resolved": "https://registry.npmjs.org/vue-scrollto/-/vue-scrollto-2.15.0.tgz",
+      "integrity": "sha512-FmJncIrXvsqvyVAN55Trc2CQWVDyxuMgdQQp1Q9I9bhoEi7XXpvXXQonhbFBktzNggJf1rpfHpVqa8KLhPeePQ==",
+      "requires": {
+        "bezier-easing": "2.1.0"
+      }
+    },
     "vue-style-loader": {
       "version": "4.1.3",
       "resolved": "https://registry.npmjs.org/vue-style-loader/-/vue-style-loader-4.1.3.tgz",

commit 06cf4985a60b94db379fce2a7c3c8dd4fc54a3e0
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Aug 15 22:27:46 2019 +0100

    ray: [web-src] timeformat change

diff --git a/web-src/src/components/ModalDialogTrack.vue b/web-src/src/components/ModalDialogTrack.vue
index ee5ec4c0..22f54d3d 100644
--- a/web-src/src/components/ModalDialogTrack.vue
+++ b/web-src/src/components/ModalDialogTrack.vue
@@ -68,7 +68,7 @@
                 </p>
                 <p>
                   <span class="heading">Added at</span>
-                  <span class="title is-6">{{ track.time_added | time('L LT') }}</span>
+                  <span class="title is-6">{{ track.time_added | time('lll') }}</span>
                 </p>
                 <p>
                   <span class="heading">Rating</span>

commit e70e3e4348af3b04d4c53cca6e1edd70dd37976f
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Wed Aug 14 09:11:39 2019 +0100

    [web-src] PageFile display dir/file/playilst counts

diff --git a/web-src/src/pages/PageFiles.vue b/web-src/src/pages/PageFiles.vue
index e1727ed5..c78a3f0d 100644
--- a/web-src/src/pages/PageFiles.vue
+++ b/web-src/src/pages/PageFiles.vue
@@ -9,19 +9,19 @@
                 <li :class="[ view === 'dir_view' ? 'is-active' : '']">
                   <a @click="view='dir_view'">
                     <span class="icon is-small"><i class="mdi mdi-folder"></i></span>
-                    <span>Directories</span>
+                    <span>Directories ({{ count(files.directories) }})</span>
                   </a>
                 </li>
                 <li :class="[ view === 'file_view' ? 'is-active' : '']">
                   <a @click="view='file_view'">
                     <span class="icon is-small"><i class="mdi mdi-file"></i></span>
-                    <span>Files</span>
+                    <span>Files ({{ count(files.tracks.items) }})</span>
                   </a>
                 </li>
                 <li :class="[ view === 'pls_view' ? 'is-active' : '']">
                   <a @click="view='pls_view'">
                     <span class="icon is-small"><i class="mdi mdi-library-music"></i></span>
-                    <span>Playlists</span>
+                    <span>Playlists ({{ count(files.playlists.items) }})</span>
                   </a>
                 </li>
               </ul>
@@ -135,14 +135,15 @@ const filesData = {
     vm.view = 'file_view'
     if (response) {
       vm.files = response.data
-      if (vm.files.tracks.length > 0) {
+      if (vm.count(vm.files.tracks.items) > 0) {
         vm.view = 'file_view'
-      } else if (vm.files.directories.length > 0) {
+      } else if (vm.count(vm.files.directories) > 0) {
         vm.view = 'dir_view'
-      } else if (vm.files.playlists.length > 0) {
+      } else if (vm.count(vm.files.playlists.items) > 0) {
         vm.view = 'pls_view'
       }
     } else {
+      vm.view = 'dir_view'
       vm.files = {
         directories: vm.$store.state.config.directories.map(dir => { return { path: dir } }),
         tracks: { items: [] },
@@ -217,6 +218,13 @@ export default {
       this.show_directory_details_modal = true
     },
 
+    count: function (what) {
+      if (what === undefined || what === null) {
+        return 0
+      }
+      return what.length
+    },
+
     basename: function (path) {
       return path.slice(this.current_directory.length + 1, path.length)
     },

commit 8dca7bee2a34611fdee930352af382b161fc8402
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Tue Aug 13 17:10:28 2019 +0100

    ray: [web-src] add index nav to PageFile, allow ListTrack to accept alternate value for creating index_ anchor

diff --git a/web-src/src/components/ListItemTrack.vue b/web-src/src/components/ListItemTrack.vue
index 86fe54ba..31c6d8f2 100644
--- a/web-src/src/components/ListItemTrack.vue
+++ b/web-src/src/components/ListItemTrack.vue
@@ -1,5 +1,5 @@
 <template functional>
-  <div class="media" :id="'index_' + props.track.title_sort.charAt(0).toUpperCase()" :class="{ 'with-progress': slots().progress }">
+  <div class="media" :id="'index_' + (props.alt_index_id === undefined ? props.track.title_sort : props.alt_index_id).charAt(0).toUpperCase()" :class="{ 'with-progress': slots().progress }">
     <figure class="media-left fd-has-action" v-if="slots().icon" @click="listeners.click">
       <slot name="icon"></slot>
     </figure>
@@ -18,7 +18,7 @@
 <script>
 export default {
   name: 'ListItemTrack',
-  props: ['track']
+  props: ['track', 'alt_index_id']
 }
 </script>
 
diff --git a/web-src/src/pages/PageFiles.vue b/web-src/src/pages/PageFiles.vue
index a9b5a218..e1727ed5 100644
--- a/web-src/src/pages/PageFiles.vue
+++ b/web-src/src/pages/PageFiles.vue
@@ -31,6 +31,8 @@
       </div>
     </section>
 
+    <index-list :index="index_list"></index-list>
+
     <content-with-heading>
       <template slot="heading-left">
         <p class="title is-4">Files</p>
@@ -87,7 +89,7 @@
         </div>
 
         <div v-show="view === 'file_view'">
-        <list-item-track v-for="(track, index) in files.tracks.items" :key="track.id" :track="track" @click="play_track(index)">
+        <list-item-track v-for="(track, index) in files.tracks.items" :key="track.id" :track="track" :alt_index_id="basename(track.path)" @click="play_track(index)">
           <template slot="icon">
             <span class="icon">
               <i class="mdi mdi-file-outline"></i>
@@ -118,6 +120,7 @@ import ListItemTrack from '@/components/ListItemTrack'
 import ModalDialogDirectory from '@/components/ModalDialogDirectory'
 import ModalDialogPlaylist from '@/components/ModalDialogPlaylist'
 import ModalDialogTrack from '@/components/ModalDialogTrack'
+import IndexList from '@/components/IndexList'
 import webapi from '@/webapi'
 
 const filesData = {
@@ -152,7 +155,7 @@ const filesData = {
 export default {
   name: 'PageFiles',
   mixins: [LoadDataBeforeEnterMixin(filesData)],
-  components: { ContentWithHeading, ListItemDirectory, ListItemPlaylist, ListItemTrack, ModalDialogDirectory, ModalDialogPlaylist, ModalDialogTrack },
+  components: { ContentWithHeading, ListItemDirectory, ListItemPlaylist, ListItemTrack, ModalDialogDirectory, ModalDialogPlaylist, ModalDialogTrack, IndexList },
 
   data () {
     return {
@@ -177,18 +180,13 @@ export default {
         return this.$route.query.directory
       }
       return '/'
-    }
+    },
 
-    /*
     index_list () {
       var items = []
 
-      if (this.view === 'dir_view') {
-        items = this.files.directories
-      } else if (this.view === 'file_view') {
+      if (this.view === 'file_view') {
         items = this.files.tracks.items
-      } else if (this.view === 'pls_view') {
-        items = this.files.playlists.items
       }
 
       if (items.length === 0) {
@@ -196,10 +194,8 @@ export default {
       }
 
       return [...new Set(items
-        .map(dirent => dirent.path.slice(this.current_directory.length + 1, dirent.path.length)
-          .charAt(0).toUpperCase()))]
+        .map(dirent => this.basename(dirent.path).charAt(0).toUpperCase()))]
     }
-    */
   },
 
   methods: {
@@ -221,6 +217,10 @@ export default {
       this.show_directory_details_modal = true
     },
 
+    basename: function (path) {
+      return path.slice(this.current_directory.length + 1, path.length)
+    },
+
     play: function () {
       webapi.player_play_expression('path starts with "' + this.current_directory + '" order by path asc', false)
     },

commit 81632d7fa58eb8f23063f1e28efbae0d5767f4d3
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Mon Aug 12 20:40:59 2019 +0100

    [web-src] add dir/track/playlist viewports for PageFiles

diff --git a/web-src/src/pages/PageFiles.vue b/web-src/src/pages/PageFiles.vue
index 22718988..a9b5a218 100644
--- a/web-src/src/pages/PageFiles.vue
+++ b/web-src/src/pages/PageFiles.vue
@@ -1,5 +1,36 @@
 <template>
   <div>
+    <section class="section fd-tabs-section">
+      <div class="container">
+        <div class="columns is-centered">
+          <div class="column is-four-fifths">
+            <div class="tabs is-centered is-small">
+              <ul>
+                <li :class="[ view === 'dir_view' ? 'is-active' : '']">
+                  <a @click="view='dir_view'">
+                    <span class="icon is-small"><i class="mdi mdi-folder"></i></span>
+                    <span>Directories</span>
+                  </a>
+                </li>
+                <li :class="[ view === 'file_view' ? 'is-active' : '']">
+                  <a @click="view='file_view'">
+                    <span class="icon is-small"><i class="mdi mdi-file"></i></span>
+                    <span>Files</span>
+                  </a>
+                </li>
+                <li :class="[ view === 'pls_view' ? 'is-active' : '']">
+                  <a @click="view='pls_view'">
+                    <span class="icon is-small"><i class="mdi mdi-library-music"></i></span>
+                    <span>Playlists</span>
+                  </a>
+                </li>
+              </ul>
+            </div>
+          </div>
+        </div>
+      </div>
+    </section>
+
     <content-with-heading>
       <template slot="heading-left">
         <p class="title is-4">Files</p>
@@ -30,6 +61,7 @@
           </div>
         </div>
 
+        <div v-show="view === 'dir_view'">
         <list-item-directory v-for="directory in files.directories" :key="directory.path" :directory="directory" @click="open_directory(directory)">
         <template slot="actions">
           <a @click="open_directory_dialog(directory)">
@@ -37,7 +69,9 @@
           </a>
         </template>
         </list-item-directory>
+        </div>
 
+        <div v-show="view === 'pls_view'">
         <list-item-playlist v-for="playlist in files.playlists.items" :key="playlist.id" :playlist="playlist" @click="open_playlist(playlist)">
           <template slot="icon">
             <span class="icon">
@@ -50,7 +84,9 @@
             </a>
           </template>
         </list-item-playlist>
+        </div>
 
+        <div v-show="view === 'file_view'">
         <list-item-track v-for="(track, index) in files.tracks.items" :key="track.id" :track="track" @click="play_track(index)">
           <template slot="icon">
             <span class="icon">
@@ -63,6 +99,7 @@
             </a>
           </template>
         </list-item-track>
+        </div>
 
         <modal-dialog-directory :show="show_directory_details_modal" :directory="selected_directory" @close="show_directory_details_modal = false" />
         <modal-dialog-playlist :show="show_playlist_details_modal" :playlist="selected_playlist" @close="show_playlist_details_modal = false" />
@@ -92,8 +129,16 @@ const filesData = {
   },
 
   set: function (vm, response) {
+    vm.view = 'file_view'
     if (response) {
       vm.files = response.data
+      if (vm.files.tracks.length > 0) {
+        vm.view = 'file_view'
+      } else if (vm.files.directories.length > 0) {
+        vm.view = 'dir_view'
+      } else if (vm.files.playlists.length > 0) {
+        vm.view = 'pls_view'
+      }
     } else {
       vm.files = {
         directories: vm.$store.state.config.directories.map(dir => { return { path: dir } }),
@@ -113,6 +158,8 @@ export default {
     return {
       files: { directories: [], tracks: { items: [] }, playlists: { items: [] } },
 
+      view: '',
+
       show_directory_details_modal: false,
       selected_directory: {},
 
@@ -131,6 +178,28 @@ export default {
       }
       return '/'
     }
+
+    /*
+    index_list () {
+      var items = []
+
+      if (this.view === 'dir_view') {
+        items = this.files.directories
+      } else if (this.view === 'file_view') {
+        items = this.files.tracks.items
+      } else if (this.view === 'pls_view') {
+        items = this.files.playlists.items
+      }
+
+      if (items.length === 0) {
+        return [...new Set()]
+      }
+
+      return [...new Set(items
+        .map(dirent => dirent.path.slice(this.current_directory.length + 1, dirent.path.length)
+          .charAt(0).toUpperCase()))]
+    }
+    */
   },
 
   methods: {

commit f1a5209989d090e61ec45dc41763159b05ad8b11
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Apr 21 13:19:30 2019 +0100

    ray: [web-src] fix queue page reorder/drag jumpiness

diff --git a/web-src/src/pages/PageQueue.vue b/web-src/src/pages/PageQueue.vue
index 9d0c9521..fd88aafc 100644
--- a/web-src/src/pages/PageQueue.vue
+++ b/web-src/src/pages/PageQueue.vue
@@ -42,7 +42,13 @@
       </div>
     </template>
     <template slot="content">
-      <draggable v-model="queue_items" handle=".handle" @end="move_item">
+      <draggable
+         v-model="queue_items"
+         handle=".handle"
+         v-bind="dragOptions"
+         @start="drag=true"
+         @update="move_item"
+         @end="drag=false">
         <list-item-queue-item v-for="(item, index) in queue_items"
           :key="item.id" :item="item" :position="index"
           :current_position="current_position"
@@ -84,6 +90,8 @@ export default {
   data () {
     return {
       edit_mode: false,
+      drag: false,
+      pre_move_queue_items: [],
 
       show_details_modal: false,
       show_url_modal: false,
@@ -104,7 +112,11 @@ export default {
     },
     queue_items: {
       get () { return this.$store.state.queue.items },
-      set (value) { /* Do nothing? Send move request in @end event */ }
+      set (value) {
+        this.pre_move_queue_items = this.$store.state.queue.items
+        this.$store.state.queue.items = value
+        this.$store.commit(types.UPDATE_QUEUE, this.$store.state.queue)
+      }
     },
     current_position () {
       const nowPlaying = this.$store.getters.now_playing
@@ -112,6 +124,14 @@ export default {
     },
     show_only_next_items () {
       return this.$store.state.show_only_next_items
+    },
+    dragOptions () {
+      return {
+        animation: 100,
+        group: 'description',
+        disabled: false,
+        ghostClass: 'ghost'
+      }
     }
   },
 
@@ -130,7 +150,8 @@ export default {
 
     move_item: function (e) {
       const oldPosition = !this.show_only_next_items ? e.oldIndex : e.oldIndex + this.current_position
-      const item = this.queue_items[oldPosition]
+      const item = this.pre_move_queue_items[oldPosition]
+      this.pre_move_queue_items = []
       const newPosition = item.position + (e.newIndex - e.oldIndex)
       if (newPosition !== oldPosition) {
         webapi.queue_move(item.id, newPosition)

commit 673a8bf8116f6d9321d16ff7053c5c1d22bd906c
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun May 19 13:53:51 2019 +0100

    ray: [web-src] add TabsMusic to PageQueue

diff --git a/web-src/package-lock.json b/web-src/package-lock.json
index b613a2ce..f99ce442 100644
--- a/web-src/package-lock.json
+++ b/web-src/package-lock.json
@@ -35194,6 +35194,14 @@
         "bezier-easing": "2.1.0"
       }
     },
+    "vue-scrollto": {
+      "version": "2.15.0",
+      "resolved": "https://registry.npmjs.org/vue-scrollto/-/vue-scrollto-2.15.0.tgz",
+      "integrity": "sha512-FmJncIrXvsqvyVAN55Trc2CQWVDyxuMgdQQp1Q9I9bhoEi7XXpvXXQonhbFBktzNggJf1rpfHpVqa8KLhPeePQ==",
+      "requires": {
+        "bezier-easing": "2.1.0"
+      }
+    },
     "vue-style-loader": {
       "version": "4.1.3",
       "resolved": "https://registry.npmjs.org/vue-style-loader/-/vue-style-loader-4.1.3.tgz",
diff --git a/web-src/src/pages/PageQueue.vue b/web-src/src/pages/PageQueue.vue
index 2b8057bc..9d0c9521 100644
--- a/web-src/src/pages/PageQueue.vue
+++ b/web-src/src/pages/PageQueue.vue
@@ -1,4 +1,7 @@
 <template>
+  <div>
+    <tabs-music></tabs-music>
+
   <content-with-heading>
     <template slot="heading-left">
       <p class="heading">{{ queue.count }} tracks</p>
@@ -60,10 +63,12 @@
       <modal-dialog-playlist-save v-if="is_queue_save_allowed" :show="show_pls_save_modal" @close="show_pls_save_modal = false" />
     </template>
   </content-with-heading>
+  </div>
 </template>
 
 <script>
 import ContentWithHeading from '@/templates/ContentWithHeading'
+import TabsMusic from '@/components/TabsMusic'
 import ListItemQueueItem from '@/components/ListItemQueueItem'
 import ModalDialogQueueItem from '@/components/ModalDialogQueueItem'
 import ModalDialogAddUrlStream from '@/components/ModalDialogAddUrlStream'
@@ -74,7 +79,7 @@ import draggable from 'vuedraggable'
 
 export default {
   name: 'PageQueue',
-  components: { ContentWithHeading, ListItemQueueItem, draggable, ModalDialogQueueItem, ModalDialogAddUrlStream, ModalDialogPlaylistSave },
+  components: { ContentWithHeading, TabsMusic, ListItemQueueItem, draggable, ModalDialogQueueItem, ModalDialogAddUrlStream, ModalDialogPlaylistSave },
 
   data () {
     return {

commit 28935f3b9f6591a7c82cef316854860aa6702479
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Mar 23 15:20:03 2019 +0000

    ray: [web-src] artist modal links to albums and tracks

diff --git a/web-src/src/components/ModalDialogArtist.vue b/web-src/src/components/ModalDialogArtist.vue
index 23ad7058..8103f780 100644
--- a/web-src/src/components/ModalDialogArtist.vue
+++ b/web-src/src/components/ModalDialogArtist.vue
@@ -12,11 +12,11 @@
               <div class="content is-small">
                 <p>
                   <span class="heading">Albums</span>
-                  <span class="title is-6">{{ artist.album_count }}</span>
+                  <a class="title is-6 has-text-link" @click="open_albums">{{ artist.album_count }}</a>
                 </p>
                 <p>
                   <span class="heading">Tracks</span>
-                  <span class="title is-6">{{ artist.track_count }}</span>
+                  <a class="title is-6 has-text-link" @click="open_tracks">{{ artist.track_count }}</a>
                 </p>
                 <p>
                   <span class="heading">Type</span>
@@ -73,6 +73,16 @@ export default {
     open_artist: function () {
       this.$emit('close')
       this.$router.push({ path: '/music/artists/' + this.artist.id })
+    },
+
+    open_albums: function () {
+      this.$emit('close')
+      this.$router.push({ path: '/music/artists/' + this.artist.id + '/ablums' })
+    },
+
+    open_tracks: function () {
+      this.$emit('close')
+      this.$router.push({ path: '/music/artists/' + this.artist.id + '/tracks' })
     }
   }
 }

commit d3f78191c5afa941f228763d432f0a77bc018c34
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Mar 17 15:40:04 2019 +0000

    ray: [web-src] NowPlaying: add stop button and reduce size of buttons

diff --git a/web-src/src/components/PlayerButtonStop.vue b/web-src/src/components/PlayerButtonStop.vue
new file mode 100644
index 00000000..32aec63f
--- /dev/null
+++ b/web-src/src/components/PlayerButtonStop.vue
@@ -0,0 +1,22 @@
+<template>
+  <a v-on:click="play_stop">
+    <span class="icon"><i class="mdi mdi-stop"></i></span>
+  </a>
+</template>
+
+<script>
+import webapi from '@/webapi'
+
+export default {
+  name: 'PlayerButtonStop',
+
+  methods: {
+    play_stop: function () {
+      webapi.player_stop()
+    }
+  }
+}
+</script>
+
+<style>
+</style>

commit d311aa0732b7eb2e85095d3b5b8b005547660630
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Thu Jan 24 18:30:46 2019 +0000

    ray: [web-src] counting items using [].reduce() instead of for()

diff --git a/web-src/src/pages/PageAlbums.vue b/web-src/src/pages/PageAlbums.vue
index 184d5a5b..f47765dc 100644
--- a/web-src/src/pages/PageAlbums.vue
+++ b/web-src/src/pages/PageAlbums.vue
@@ -61,6 +61,11 @@ const albumsData = {
 
   set: function (vm, response) {
     vm.albums = response.data
+    vm.tracks = vm.albums.items.reduce((acc, item) => {
+      acc += item.track_count
+      return acc
+    }, 0)
+
     vm.index_list = [...new Set(vm.albums.items
       .filter(album => !vm.$store.state.hide_singles || album.track_count > 2)
       .map(album => album.name_sort.charAt(0).toUpperCase()))]
diff --git a/web-src/src/pages/PageArtists.vue b/web-src/src/pages/PageArtists.vue
index 9f579eac..9a98d13d 100644
--- a/web-src/src/pages/PageArtists.vue
+++ b/web-src/src/pages/PageArtists.vue
@@ -61,6 +61,10 @@ const artistsData = {
 
   set: function (vm, response) {
     vm.artists = response.data
+    vm.albums = vm.artists.items.reduce((acc, item) => {
+      acc += item.album_count
+      return acc
+    }, 0)
   }
 }
 
diff --git a/web-src/src/pages/PageGenre.vue b/web-src/src/pages/PageGenre.vue
index d95fe0a7..d5d21704 100644
--- a/web-src/src/pages/PageGenre.vue
+++ b/web-src/src/pages/PageGenre.vue
@@ -42,6 +42,10 @@ const genreData = {
   set: function (vm, response) {
     vm.name = vm.$route.params.genre
     vm.genre_albums = response.data.albums
+    vm.tracks = vm.genre_albums.items.reduce((acc, item) => {
+      acc += item.track_count
+      return acc
+    }, 0)
   }
 }
 

commit 1661e64f846d52e8237bb1b2bafbe9d288d1b30d
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Apr 7 16:08:06 2019 +0100

    [jsonapi,web-src] name sync to previous json naming

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index 4a397529..d149a5d8 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -9,7 +9,7 @@
         </div>
       </template>
     <template slot="heading-left">
-      <p class="title is-4">{{ album_artist }}</p>
+      <p class="title is-4">{{ name }}</p>
     </template>
     <template slot="heading-right">
       <div class="buttons is-centered">
@@ -48,14 +48,14 @@ const artistData = {
   },
 
   set: function (vm, response) {
-    vm.album_artist = response[0].data.artist
-    vm.artist_id = vm.$route.params.artist_id
+    vm.name = response[0].data.name
+    vm.id = response[0].data.id
     vm.artist = response[0].data.items
     vm.albums = response[1].data
 
     vm.consolidated_artist = {
-      'id': vm.artist_id,
-      'name': vm.album_artist,
+      'id': vm.id,
+      'name': vm.name,
       'album_count': vm.albums.items.length,
       'track_count': vm.track_count,
       'uri': vm.albums.items.map(a => a.uri).join(',')
@@ -70,8 +70,8 @@ export default {
 
   data () {
     return {
-      album_artist: '',
-      artist_id: '',
+      name: '',
+      id: '',
       consolidated_artist: {},
       artist: [], // can be multiple entries if compilation album
       albums: { items: [] },
@@ -109,7 +109,7 @@ export default {
 
   methods: {
     open_tracks: function () {
-      this.$router.push({ path: '/music/artists/' + this.artist_id + '/tracks' })
+      this.$router.push({ path: '/music/artists/' + this.id + '/tracks' })
     },
 
     play: function () {
diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index ffc1bc5c..327a65a4 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -5,7 +5,7 @@
         <index-button-list :index="index_list"></index-button-list>
       </template>
       <template slot="heading-left">
-        <p class="title is-4">{{ album_artist }}</p>
+        <p class="title is-4">{{ name }}</p>
       </template>
       <template slot="heading-right">
         <div class="buttons is-centered">
@@ -57,8 +57,8 @@ export default {
 
   data () {
     return {
-      album_artist: '',
-      artist_id: '',
+      name: '',
+      id: '',
       artist: {},
       tracks: { items: [] },
 
@@ -88,7 +88,7 @@ export default {
   methods: {
     open_artist: function () {
       this.show_details_modal = false
-      this.$router.push({ path: '/music/artists/' + this.artist_id })
+      this.$router.push({ path: '/music/artists/' + this.id })
     },
 
     play: function () {

commit 9368991b8adca27520e8e7e22e84d2cd62eeaa1b
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sat Mar 30 17:13:48 2019 +0000

    [web-src] handle multiple artists for artist modal

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index 3ad19758..4a397529 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -52,6 +52,14 @@ const artistData = {
     vm.artist_id = vm.$route.params.artist_id
     vm.artist = response[0].data.items
     vm.albums = response[1].data
+
+    vm.consolidated_artist = {
+      'id': vm.artist_id,
+      'name': vm.album_artist,
+      'album_count': vm.albums.items.length,
+      'track_count': vm.track_count,
+      'uri': vm.albums.items.map(a => a.uri).join(',')
+    }
   }
 }
 
@@ -64,7 +72,8 @@ export default {
     return {
       album_artist: '',
       artist_id: '',
-      artist: {},
+      consolidated_artist: {},
+      artist: [], // can be multiple entries if compilation album
       albums: { items: [] },
 
       sort_options: ['Name', 'Release date'],

commit 835aee29e1931e1e5c13574d5cde30126b5e1cbe
Author: whatdoineed2do/Ray <whatdoineed2do@nospam.gmail.com>
Date:   Sun Jan 20 20:03:24 2019 +0000

    [web-src] sync with jsonapi for handling albums compilations

diff --git a/web-src/src/pages/PageArtist.vue b/web-src/src/pages/PageArtist.vue
index d048d58b..3ad19758 100644
--- a/web-src/src/pages/PageArtist.vue
+++ b/web-src/src/pages/PageArtist.vue
@@ -9,7 +9,7 @@
         </div>
       </template>
     <template slot="heading-left">
-      <p class="title is-4">{{ artist.name }}</p>
+      <p class="title is-4">{{ album_artist }}</p>
     </template>
     <template slot="heading-right">
       <div class="buttons is-centered">
@@ -22,7 +22,7 @@
       </div>
     </template>
     <template slot="content">
-      <p class="heading has-text-centered-mobile">{{ artist.album_count }} albums | <a class="has-text-link" @click="open_tracks">{{ artist.track_count }} tracks</a></p>
+      <p class="heading has-text-centered-mobile">{{ artist.album_count }} albums | <a class="has-text-link" @click="open_tracks">{{ track_count }} tracks</a></p>
       <list-albums :albums="albums_list"></list-albums>
       <modal-dialog-artist :show="show_artist_details_modal" :artist="artist" @close="show_artist_details_modal = false" />
     </template>
@@ -48,7 +48,9 @@ const artistData = {
   },
 
   set: function (vm, response) {
-    vm.artist = response[0].data
+    vm.album_artist = response[0].data.artist
+    vm.artist_id = vm.$route.params.artist_id
+    vm.artist = response[0].data.items
     vm.albums = response[1].data
   }
 }
@@ -60,6 +62,8 @@ export default {
 
   data () {
     return {
+      album_artist: '',
+      artist_id: '',
       artist: {},
       albums: { items: [] },
 
@@ -69,6 +73,14 @@ export default {
   },
 
   computed: {
+    track_count () {
+      var n = 0
+      return this.albums.items.reduce((acc, item) => {
+        acc += item.track_count
+        return acc
+      }, 0)
+    },
+
     albums_list () {
       return new Albums(this.albums.items, {
         sort: this.sort,
@@ -88,7 +100,7 @@ export default {
 
   methods: {
     open_tracks: function () {
-      this.$router.push({ path: '/music/artists/' + this.artist.id + '/tracks' })
+      this.$router.push({ path: '/music/artists/' + this.artist_id + '/tracks' })
     },
 
     play: function () {
diff --git a/web-src/src/pages/PageArtistTracks.vue b/web-src/src/pages/PageArtistTracks.vue
index aa727996..ffc1bc5c 100644
--- a/web-src/src/pages/PageArtistTracks.vue
+++ b/web-src/src/pages/PageArtistTracks.vue
@@ -5,7 +5,7 @@
         <index-button-list :index="index_list"></index-button-list>
       </template>
       <template slot="heading-left">
-        <p class="title is-4">{{ artist.name }}</p>
+        <p class="title is-4">{{ album_artist }}</p>
       </template>
       <template slot="heading-right">
         <div class="buttons is-centered">
@@ -43,6 +43,8 @@ const tracksData = {
   },
 
   set: function (vm, response) {
+    vm.name = response[0].data.name
+    vm.id = response[0].data.id
     vm.artist = response[0].data
     vm.tracks = response[1].data.tracks
   }
@@ -55,6 +57,8 @@ export default {
 
   data () {
     return {
+      album_artist: '',
+      artist_id: '',
       artist: {},
       tracks: { items: [] },
 
@@ -63,6 +67,14 @@ export default {
   },
 
   computed: {
+    track_count () {
+      return this.tracks.items.length
+    },
+
+    album_count () {
+      return new Set(this.tracks.items.map(track => track.album_id)).size
+    },
+
     index_list () {
       return [...new Set(this.tracks.items
         .map(track => track.title_sort.charAt(0).toUpperCase()))]
@@ -76,7 +88,7 @@ export default {
   methods: {
     open_artist: function () {
       this.show_details_modal = false
-      this.$router.push({ path: '/music/artists/' + this.artist.id })
+      this.$router.push({ path: '/music/artists/' + this.artist_id })
     },
 
     play: function () {
